/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var t={};e.r(t),e.d(t,{FirebaseError:()=>b,SDK_VERSION:()=>et,_DEFAULT_ENTRY_NAME:()=>Ue,_addComponent:()=>ze,_addOrOverwriteComponent:()=>Ge,_apps:()=>qe,_clearComponents:()=>Je,_components:()=>je,_getProvider:()=>$e,_isFirebaseApp:()=>We,_isFirebaseServerApp:()=>Qe,_registerComponent:()=>Ke,_removeServiceInstance:()=>He,_serverApps:()=>Be,deleteApp:()=>st,getApp:()=>rt,getApps:()=>it,initializeApp:()=>tt,initializeServerApp:()=>nt,onLog:()=>at,registerVersion:()=>ot,setLogLevel:()=>ct});var n={};e.r(n);var r={};e.r(r);const i=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=i>>2,l=(3&i)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(i(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0;++t;const a=t<e.length?n[e.charAt(t)]:64;++t;const c=t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==c)throw new o;const u=i<<2|s>>4;if(r.push(u),64!==a){const e=s<<4&240|a>>2;if(r.push(e),64!==c){const e=a<<6&192|c;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class o extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const a=function(e){return function(e){const t=i(e);return s.encodeByteArray(t,!0)}(e).replace(/\./g,"")},c=function(e){try{return s.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function u(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=u(e[n],t[n]));return e}const l=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e.g)return e.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&c(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},h=()=>{var e;return null===(e=l())||void 0===e?void 0:e.config};class d{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function f(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function p(){var t;const n=null===(t=l())||void 0===t?void 0:t.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}function m(){return"undefined"!=typeof window||g()}function g(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function y(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function v(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function w(){const e=f();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function _(){return!p()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function I(){try{return"object"==typeof indexedDB}catch(e){return!1}}class b extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,b.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,T.prototype.create)}}class T{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(E,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new b(r,o,n)}}const E=/\{\$([^}]+)}/g;function S(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function k(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(C(n)&&C(s)){if(!k(n,s))return!1}else if(n!==s)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function C(e){return null!==e&&"object"==typeof e}function A(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function N(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function D(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function R(e,t){const n=new x(e,t);return n.subscribe.bind(n)}class x{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=P),void 0===r.error&&(r.error=P),void 0===r.complete&&(r.complete=P);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function P(){}function O(e){return e&&e._delegate?e._delegate:e}class L{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const M="[DEFAULT]";class F{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new d;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:M})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=M){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=M){return this.instances.has(e)}getOptions(e=M){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===M?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=M){return this.component?this.component.multipleInstances?e:M:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class U{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new F(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const V=[];var q;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(q||(q={}));const B={debug:q.DEBUG,verbose:q.VERBOSE,info:q.INFO,warn:q.WARN,error:q.ERROR,silent:q.SILENT},j=q.INFO,z={[q.DEBUG]:"log",[q.VERBOSE]:"log",[q.INFO]:"info",[q.WARN]:"warn",[q.ERROR]:"error"},G=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=z[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class K{constructor(e){this.name=e,this._logLevel=j,this._logHandler=G,this._userLogHandler=null,V.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in q))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?B[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,q.DEBUG,...e),this._logHandler(this,q.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,q.VERBOSE,...e),this._logHandler(this,q.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,q.INFO,...e),this._logHandler(this,q.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,q.WARN,...e),this._logHandler(this,q.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,q.ERROR,...e),this._logHandler(this,q.ERROR,...e)}}const $=(e,t)=>t.some((t=>e instanceof t));let H,W;const Q=new WeakMap,J=new WeakMap,Y=new WeakMap,X=new WeakMap,Z=new WeakMap;let ee={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return J.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Y.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ne(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function te(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(W||(W=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(re(this),e),ne(Q.get(this))}:function(...e){return ne(t.apply(re(this),e))}:function(e,...n){const r=t.call(re(this),e,...n);return Y.set(r,e.sort?e.sort():[e]),ne(r)}:(e instanceof IDBTransaction&&function(e){if(J.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));J.set(e,t)}(e),$(e,H||(H=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,ee):e);var t}function ne(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(ne(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&Q.set(t,e)})).catch((()=>{})),Z.set(t,e),t}(e);if(X.has(e))return X.get(e);const t=te(e);return t!==e&&(X.set(e,t),Z.set(t,e)),t}const re=e=>Z.get(e),ie=["get","getKey","getAll","getAllKeys","count"],se=["put","add","delete","clear"],oe=new Map;function ae(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(oe.get(t))return oe.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=se.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!ie.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return oe.set(t,s),s}var ce;ce=ee,ee={...ce,get:(e,t,n)=>ae(e,t)||ce.get(e,t,n),has:(e,t)=>!!ae(e,t)||ce.has(e,t)};class ue{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const le="@firebase/app",he="0.10.6",de=new K("@firebase/app"),fe="@firebase/app-compat",pe="@firebase/analytics-compat",me="@firebase/analytics",ge="@firebase/app-check-compat",ye="@firebase/app-check",ve="@firebase/auth",we="@firebase/auth-compat",_e="@firebase/database",Ie="@firebase/database-compat",be="@firebase/functions",Te="@firebase/functions-compat",Ee="@firebase/installations",Se="@firebase/installations-compat",ke="@firebase/messaging",Ce="@firebase/messaging-compat",Ae="@firebase/performance",Ne="@firebase/performance-compat",De="@firebase/remote-config",Re="@firebase/remote-config-compat",xe="@firebase/storage",Pe="@firebase/storage-compat",Oe="@firebase/firestore",Le="@firebase/vertexai-preview",Me="@firebase/firestore-compat",Fe="firebase",Ue="[DEFAULT]",Ve={[le]:"fire-core",[fe]:"fire-core-compat",[me]:"fire-analytics",[pe]:"fire-analytics-compat",[ye]:"fire-app-check",[ge]:"fire-app-check-compat",[ve]:"fire-auth",[we]:"fire-auth-compat",[_e]:"fire-rtdb",[Ie]:"fire-rtdb-compat",[be]:"fire-fn",[Te]:"fire-fn-compat",[Ee]:"fire-iid",[Se]:"fire-iid-compat",[ke]:"fire-fcm",[Ce]:"fire-fcm-compat",[Ae]:"fire-perf",[Ne]:"fire-perf-compat",[De]:"fire-rc",[Re]:"fire-rc-compat",[xe]:"fire-gcs",[Pe]:"fire-gcs-compat",[Oe]:"fire-fst",[Me]:"fire-fst-compat",[Le]:"fire-vertex","fire-js":"fire-js",[Fe]:"fire-js-all"},qe=new Map,Be=new Map,je=new Map;function ze(e,t){try{e.container.addComponent(t)}catch(n){de.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function Ge(e,t){e.container.addOrOverwriteComponent(t)}function Ke(e){const t=e.name;if(je.has(t))return de.debug(`There were multiple attempts to register component ${t}.`),!1;je.set(t,e);for(const t of qe.values())ze(t,e);for(const t of Be.values())ze(t,e);return!0}function $e(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function He(e,t,n=Ue){$e(e,t).clearInstance(n)}function We(e){return void 0!==e.options}function Qe(e){return void 0!==e.settings}function Je(){je.clear()}const Ye=new T("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Xe{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new L("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ye.create("app-deleted",{appName:this._name})}}class Ze extends Xe{constructor(e,t,n,r){const i=void 0!==t.automaticDataCollectionEnabled&&t.automaticDataCollectionEnabled,s={name:n,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,r):super(e.options,s,r),this._serverConfig=Object.assign({automaticDataCollectionEnabled:i},t),this._finalizationRegistry=null,"undefined"!=typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry((()=>{this.automaticCleanup()}))),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,ot(le,he,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){st(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw Ye.create("server-app-deleted")}}const et="10.12.3";function tt(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const r=Object.assign({name:Ue,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!=typeof i||!i)throw Ye.create("bad-app-name",{appName:String(i)});if(n||(n=h()),!n)throw Ye.create("no-options");const s=qe.get(i);if(s){if(k(n,s.options)&&k(r,s.config))return s;throw Ye.create("duplicate-app",{appName:i})}const o=new U(i);for(const e of je.values())o.addComponent(e);const a=new Xe(n,r,o);return qe.set(i,a),a}function nt(e,t){if(m()&&!g())throw Ye.create("invalid-server-app-environment");let n;void 0===t.automaticDataCollectionEnabled&&(t.automaticDataCollectionEnabled=!1),n=We(e)?e.options:e;const r=Object.assign(Object.assign({},t),n);if(void 0!==r.releaseOnDeref&&delete r.releaseOnDeref,void 0!==t.releaseOnDeref&&"undefined"==typeof FinalizationRegistry)throw Ye.create("finalization-registry-not-supported",{});const i=""+(s=JSON.stringify(r),[...s].reduce(((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0),0));var s;const o=Be.get(i);if(o)return o.incRefCount(t.releaseOnDeref),o;const a=new U(i);for(const e of je.values())a.addComponent(e);const c=new Ze(n,t,i,a);return Be.set(i,c),c}function rt(e=Ue){const t=qe.get(e);if(!t&&e===Ue&&h())return tt();if(!t)throw Ye.create("no-app",{appName:e});return t}function it(){return Array.from(qe.values())}async function st(e){let t=!1;const n=e.name;qe.has(n)?(t=!0,qe.delete(n)):Be.has(n)&&e.decRefCount()<=0&&(Be.delete(n),t=!0),t&&(await Promise.all(e.container.getProviders().map((e=>e.delete()))),e.isDeleted=!0)}function ot(e,t,n){var r;let i=null!==(r=Ve[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void de.warn(e.join(" "))}Ke(new L(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}function at(e,t){if(null!==e&&"function"!=typeof e)throw Ye.create("invalid-log-argument");!function(e,t){for(const n of V){let r=null;t&&t.level&&(r=B[t.level]),n.userLogHandler=null===e?null:(t,n,...i)=>{const s=i.map((e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}})).filter((e=>e)).join(" ");n>=(null!=r?r:t.logLevel)&&e({level:q[n].toLowerCase(),message:s,args:i,type:t.name})}}}(e,t)}function ct(e){var t;t=e,V.forEach((e=>{e.setLogLevel(t)}))}const ut="firebase-heartbeat-database",lt=1,ht="firebase-heartbeat-store";let dt=null;function ft(){return dt||(dt=function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=ne(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(ne(o.result),e.oldVersion,e.newVersion,ne(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}(ut,lt,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(ht)}catch(e){console.warn(e)}}}).catch((e=>{throw Ye.create("idb-open",{originalErrorMessage:e.message})}))),dt}async function pt(e,t){try{const n=(await ft()).transaction(ht,"readwrite"),r=n.objectStore(ht);await r.put(t,mt(e)),await n.done}catch(e){if(e instanceof b)de.warn(e.message);else{const t=Ye.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});de.warn(t.message)}}}function mt(e){return`${e.name}!${e.options.appId}`}class gt{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new vt(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=yt();if((null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some((e=>e.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=yt(),{heartbeatsToSend:n,unsentEntries:r}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),wt(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),wt(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=a(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function yt(){return(new Date).toISOString().substring(0,10)}class vt{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!I()&&new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await ft()).transaction(ht),n=await t.objectStore(ht).get(mt(e));return await t.done,n}catch(e){if(e instanceof b)de.warn(e.message);else{const t=Ye.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});de.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return pt(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return pt(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function wt(e){return a(JSON.stringify({version:2,heartbeats:e})).length}Ke(new L("platform-logger",(e=>new ue(e)),"PRIVATE")),Ke(new L("heartbeat",(e=>new gt(e)),"PRIVATE")),ot(le,he,""),ot(le,he,"esm2017"),ot("fire-js","");class _t{constructor(e,t){this._delegate=e,this.firebase=t,ze(e,new L("app-compat",(()=>this),"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise((e=>{this._delegate.checkDestroyed(),e()})).then((()=>(this.firebase.INTERNAL.removeApp(this.name),st(this._delegate))))}_getService(e,t=Ue){var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=Ue){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){ze(this._delegate,e)}_addOrOverwriteComponent(e){Ge(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const It=new T("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."}),bt=function e(){const n=function(e){const n={},r={__esModule:!0,initializeApp:function(t,i={}){const s=tt(t,i);if(S(n,s.name))return n[s.name];const o=new e(s,r);return n[s.name]=o,o},app:i,registerVersion:ot,setLogLevel:ct,onLog:at,apps:null,SDK_VERSION:et,INTERNAL:{registerComponent:function(t){const n=t.name,s=n.replace("-compat","");if(Ke(t)&&"PUBLIC"===t.type){const o=(e=i())=>{if("function"!=typeof e[s])throw It.create("invalid-app-argument",{appName:n});return e[s]()};void 0!==t.serviceProps&&u(o,t.serviceProps),r[s]=o,e.prototype[s]=function(...e){return this._getService.bind(this,n).apply(this,t.multipleInstances?e:[])}}return"PUBLIC"===t.type?r[s]:null},removeApp:function(e){delete n[e]},useAsService:function(e,t){return"serverAuth"===t?null:t},modularAPIs:t}};function i(e){if(!S(n,e=e||Ue))throw It.create("no-app",{appName:e});return n[e]}return r.default=r,Object.defineProperty(r,"apps",{get:function(){return Object.keys(n).map((e=>n[e]))}}),i.App=e,r}(_t);return n.INTERNAL=Object.assign(Object.assign({},n.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){u(n,e)},createSubscribe:R,ErrorFactory:T,deepExtend:u}),n}(),Tt=new K("@firebase/app-compat");if(m()&&void 0!==self.firebase){Tt.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const e=self.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&Tt.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const Et=bt;function St(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}ot("@firebase/app-compat","0.2.36",void 0),Et.registerVersion("firebase","10.12.3","app-compat"),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;const kt={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"};const Ct=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}},At=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},Nt=new T("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Dt=new K("@firebase/auth");function Rt(e,...t){Dt.logLevel<=q.ERROR&&Dt.error(`Auth (${et}): ${e}`,...t)}function xt(e,...t){throw Ft(e,...t)}function Pt(e,...t){return Ft(e,...t)}function Ot(e,t,n){const r=Object.assign(Object.assign({},At()),{[t]:n});return new T("auth","Firebase",r).create(t,{appName:e.name})}function Lt(e){return Ot(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Mt(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&xt(e,"argument-error"),Ot(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Ft(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return Nt.create(e,...t)}function Ut(e,t,...n){if(!e)throw Ft(t,...n)}function Vt(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Rt(t),new Error(t)}function qt(e,t){e||Vt(t)}function Bt(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function jt(){return"http:"===zt()||"https:"===zt()}function zt(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class Gt{constructor(e,t){this.shortDelay=e,this.longDelay=t,qt(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(f())||v()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(jt()||y()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function Kt(e,t){qt(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class $t{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void Vt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void Vt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void Vt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Ht={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Wt=new Gt(3e4,6e4);function Qt(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Jt(e,t,n,r,i={}){return Yt(e,i,(async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const o=A(Object.assign({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),$t.fetch()(Zt(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},i))}))}async function Yt(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},Ht),t);try{const t=new tn(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw nn(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw nn(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw nn(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw nn(e,"user-disabled",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw Ot(e,a,o);xt(e,a)}}catch(t){if(t instanceof b)throw t;xt(e,"network-request-failed",{message:String(t)})}}async function Xt(e,t,n,r,i={}){const s=await Jt(e,t,n,r,i);return"mfaPendingCredential"in s&&xt(e,"multi-factor-auth-required",{_serverResponse:s}),s}function Zt(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?Kt(e.config,i):`${e.config.apiScheme}://${i}`}function en(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class tn{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(Pt(this.auth,"network-request-failed"))),Wt.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function nn(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Pt(e,t,r);return i.customData._tokenResponse=n,i}function rn(e){return void 0!==e&&void 0!==e.getResponse}function sn(e){return void 0!==e&&void 0!==e.enterprise}class on{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return en(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}async function an(e,t){return Jt(e,"POST","/v1/accounts:lookup",t)}function cn(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function un(e){return 1e3*Number(e)}function ln(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return Rt("JWT malformed, contained fewer than 3 sections"),null;try{const e=c(n);return e?JSON.parse(e):(Rt("Failed to decode base64 JWT payload"),null)}catch(e){return Rt("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function hn(e){const t=ln(e);return Ut(t,"internal-error"),Ut(void 0!==t.exp,"internal-error"),Ut(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function dn(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof b&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class fn{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class pn{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=cn(this.lastLoginAt),this.creationTime=cn(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function mn(e){var t;const n=e.auth,r=await e.getIdToken(),i=await dn(e,an(n,{idToken:r}));Ut(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?gn(s.providerUserInfo):[],a=(c=e.providerData,u=o,[...c.filter((e=>!u.some((t=>t.providerId===e.providerId)))),...u]);var c,u;const l=e.isAnonymous,h=!(e.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!l&&h,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new pn(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,f)}function gn(e){return e.map((e=>{var{providerId:t}=e,n=St(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}))}class yn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ut(e.idToken,"internal-error"),Ut(void 0!==e.idToken,"internal-error"),Ut(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):hn(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Ut(0!==e.length,"internal-error");const t=hn(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(Ut(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await Yt(e,{},(async()=>{const n=A({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=Zt(e,r,"/v1/token",`key=${i}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",$t.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new yn;return n&&(Ut("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(Ut("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(Ut("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new yn,this.toJSON())}_performRefresh(){return Vt("not implemented")}}function vn(e,t){Ut("string"==typeof e||void 0===e,"internal-error",{appName:t})}class wn{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=St(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new fn(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new pn(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await dn(this,this.stsTokenManager.getToken(this.auth,e));return Ut(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=O(e),r=await n.getIdToken(t),i=ln(r);Ut(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:cn(un(i.auth_time)),issuedAtTime:cn(un(i.iat)),expirationTime:cn(un(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=O(e);await mn(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Ut(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new wn(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Ut(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await mn(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Qe(this.auth.app))return Promise.reject(Lt(this.auth));const e=await this.getIdToken();return await dn(this,async function(e,t){return Jt(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,u;const l=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:_,providerData:I,stsTokenManager:b}=t;Ut(v&&b,e,"internal-error");const T=yn.fromJSON(this.name,b);Ut("string"==typeof v,e,"internal-error"),vn(l,e.name),vn(h,e.name),Ut("boolean"==typeof w,e,"internal-error"),Ut("boolean"==typeof _,e,"internal-error"),vn(d,e.name),vn(f,e.name),vn(p,e.name),vn(m,e.name),vn(g,e.name),vn(y,e.name);const E=new wn({uid:v,auth:e,email:h,emailVerified:w,displayName:l,isAnonymous:_,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:T,createdAt:g,lastLoginAt:y});return I&&Array.isArray(I)&&(E.providerData=I.map((e=>Object.assign({},e)))),m&&(E._redirectEventId=m),E}static async _fromIdTokenResponse(e,t,n=!1){const r=new yn;r.updateFromServerResponse(t);const i=new wn({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await mn(i),i}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];Ut(void 0!==r.localId,"internal-error");const i=void 0!==r.providerUserInfo?gn(r.providerUserInfo):[],s=!(r.email&&r.passwordHash||(null==i?void 0:i.length)),o=new yn;o.updateFromIdToken(n);const a=new wn({uid:r.localId,auth:e,stsTokenManager:o,isAnonymous:s}),c={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new pn(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash||(null==i?void 0:i.length))};return Object.assign(a,c),a}}const _n=new Map;function In(e){qt(e instanceof Function,"Expected a class definition");let t=_n.get(e);return t?(qt(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,_n.set(e,t),t)}class bn{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}bn.type="NONE";const Tn=bn;function En(e,t,n){return`firebase:${e}:${t}:${n}`}class Sn{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=En(this.userKey,r.apiKey,i),this.fullPersistenceKey=En("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?wn._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Sn(In(Tn),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||In(Tn);const s=En(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(s);if(t){const r=wn._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch(e){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new Sn(i,e,n)):new Sn(i,e,n)}}function kn(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Dn(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Cn(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(xn(t))return"Blackberry";if(Pn(t))return"Webos";if(An(t))return"Safari";if((t.includes("chrome/")||Nn(t))&&!t.includes("edge/"))return"Chrome";if(Rn(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function Cn(e=f()){return/firefox\//i.test(e)}function An(e=f()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Nn(e=f()){return/crios\//i.test(e)}function Dn(e=f()){return/iemobile/i.test(e)}function Rn(e=f()){return/android/i.test(e)}function xn(e=f()){return/blackberry/i.test(e)}function Pn(e=f()){return/webos/i.test(e)}function On(e=f()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Ln(e=f()){return On(e)||Rn(e)||Pn(e)||xn(e)||/windows phone/i.test(e)||Dn(e)}function Mn(e,t=[]){let n;switch(e){case"Browser":n=kn(f());break;case"Worker":n=`${kn(f())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${et}/${r}`}class Fn{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(e){r(e)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class Un{constructor(e){var t,n,r,i;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=s.minPasswordLength)&&void 0!==t?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,i,s,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(r=a.containsLowercaseLetter)||void 0===r||r),a.isValid&&(a.isValid=null===(i=a.containsUppercaseLetter)||void 0===i||i),a.isValid&&(a.isValid=null===(s=a.containsNumericCharacter)||void 0===s||s),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class Vn{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Bn(this),this.idTokenSubscription=new Bn(this),this.beforeStateQueue=new Fn(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Nt,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=In(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await Sn.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await an(this,{idToken:e}),n=await wn._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Qe(this.app)){const e=this.app.settings.authIdToken;return e?new Promise((t=>{setTimeout((()=>this.initializeCurrentUserFromIdToken(e).then(t,t)))})):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(r=o.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Ut(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await mn(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Qe(this.app))return Promise.reject(Lt(this));const t=e?O(e):null;return t&&Ut(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Ut(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return Qe(this.app)?Promise.reject(Lt(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Qe(this.app)?Promise.reject(Lt(this)):this.queue((async()=>{await this.assertedPersistence.setPersistence(In(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return Jt(e,"GET","/v2/passwordPolicy",Qt(e,t))}(this),t=new Un(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new T("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return Jt(e,"POST","/v2/accounts:revokeToken",Qt(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&In(e)||this._popupRedirectResolver;Ut(t,this,"argument-error"),this.redirectPersistenceManager=await Sn.create(this,[In(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t);let s=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ut(o,this,"internal-error"),o.then((()=>{s||i(this.currentUser)})),"function"==typeof t){const i=e.addObserver(t,n,r);return()=>{s=!0,i()}}{const n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ut(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Mn(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){Dt.logLevel<=q.WARN&&Dt.warn(`Auth (${et}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function qn(e){return O(e)}class Bn{constructor(e){this.auth=e,this.observer=null,this.addObserver=R((e=>this.observer=e))}get next(){return Ut(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let jn={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function zn(e){return jn.loadJS(e)}function Gn(e){return`__${e}${Math.floor(1e6*Math.random())}`}class Kn{constructor(e){this.type="recaptcha-enterprise",this.auth=qn(e)}async verify(e="verify",t=!1){function n(t,n,r){const i=window.grecaptcha;sn(i)?i.enterprise.ready((()=>{i.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n("NO_RECAPTCHA")}))})):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{(async function(e,t){return Jt(e,"GET","/v2/recaptchaConfig",Qt(e,t))})(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((r=>{if(void 0!==r.recaptchaKey){const n=new on(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((i=>{if(!t&&sn(window.grecaptcha))n(i,e,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=jn.recaptchaEnterpriseScript;0!==t.length&&(t+=i),zn(t).then((()=>{n(i,e,r)})).catch((e=>{r(e)}))}})).catch((e=>{r(e)}))}))}}async function $n(e,t,n,r=!1){const i=new Kn(e);let s;try{s=await i.verify(n)}catch(e){s=await i.verify(n,!0)}const o=Object.assign({},t);return r?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Hn(e,t,n,r){var i;if(null===(i=e._getRecaptchaConfig())||void 0===i?void 0:i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await $n(e,t,n,"getOobCode"===n);return r(e,i)}return r(e,t).catch((async i=>{if("auth/missing-recaptcha-token"===i.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const i=await $n(e,t,n,"getOobCode"===n);return r(e,i)}return Promise.reject(i)}))}function Wn(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Qn(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Jn{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Vt("not implemented")}_getIdTokenResponse(e){return Vt("not implemented")}_linkToIdToken(e,t){return Vt("not implemented")}_getReauthenticationResolver(e){return Vt("not implemented")}}async function Yn(e,t){return Jt(e,"POST","/v1/accounts:resetPassword",Qt(e,t))}async function Xn(e,t){return Jt(e,"POST","/v1/accounts:signUp",t)}async function Zn(e,t){return Xt(e,"POST","/v1/accounts:signInWithPassword",Qt(e,t))}async function er(e,t){return Jt(e,"POST","/v1/accounts:sendOobCode",Qt(e,t))}async function tr(e,t){return er(e,t)}async function nr(e,t){return er(e,t)}class rr extends Jn{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new rr(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new rr(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Hn(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Zn);case"emailLink":return async function(e,t){return Xt(e,"POST","/v1/accounts:signInWithEmailLink",Qt(e,t))}(e,{email:this._email,oobCode:this._password});default:xt(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Hn(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Xn);case"emailLink":return async function(e,t){return Xt(e,"POST","/v1/accounts:signInWithEmailLink",Qt(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:xt(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function ir(e,t){return Xt(e,"POST","/v1/accounts:signInWithIdp",Qt(e,t))}class sr extends Jn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new sr(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):xt("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=St(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new sr(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return ir(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,ir(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ir(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=A(t)}return e}}const or={USER_NOT_FOUND:"user-not-found"};class ar extends Jn{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new ar({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new ar({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Xt(e,"POST","/v1/accounts:signInWithPhoneNumber",Qt(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await Xt(e,"POST","/v1/accounts:signInWithPhoneNumber",Qt(e,t));if(n.temporaryProof)throw nn(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Xt(e,"POST","/v1/accounts:signInWithPhoneNumber",Qt(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),or)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new ar({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class cr{constructor(e){var t,n,r,i,s,o;const a=N(D(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,l=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);Ut(c&&u&&l,"argument-error"),this.apiKey=c,this.operation=l,this.code=u,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=N(D(e)).link,n=t?N(D(t)).deep_link_id:null,r=N(D(e)).deep_link_id;return(r?N(D(r)).link:null)||r||n||t||e}(e);try{return new cr(t)}catch(e){return null}}}class ur{constructor(){this.providerId=ur.PROVIDER_ID}static credential(e,t){return rr._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=cr.parseLink(t);return Ut(n,"argument-error"),rr._fromEmailAndCode(e,n.code,n.tenantId)}}ur.PROVIDER_ID="password",ur.EMAIL_PASSWORD_SIGN_IN_METHOD="password",ur.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class lr{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class hr extends lr{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class dr extends hr{static credentialFromJSON(e){const t="string"==typeof e?JSON.parse(e):e;return Ut("providerId"in t&&"signInMethod"in t,"argument-error"),sr._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return Ut(e.idToken||e.accessToken,"argument-error"),sr._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return dr.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return dr.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:o}=e;if(!(n||r||t||i))return null;if(!o)return null;try{return new dr(o)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(e){return null}}}class fr extends hr{constructor(){super("facebook.com")}static credential(e){return sr._fromParams({providerId:fr.PROVIDER_ID,signInMethod:fr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return fr.credentialFromTaggedObject(e)}static credentialFromError(e){return fr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return fr.credential(e.oauthAccessToken)}catch(e){return null}}}fr.FACEBOOK_SIGN_IN_METHOD="facebook.com",fr.PROVIDER_ID="facebook.com";class pr extends hr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return sr._fromParams({providerId:pr.PROVIDER_ID,signInMethod:pr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return pr.credentialFromTaggedObject(e)}static credentialFromError(e){return pr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return pr.credential(t,n)}catch(e){return null}}}pr.GOOGLE_SIGN_IN_METHOD="google.com",pr.PROVIDER_ID="google.com";class mr extends hr{constructor(){super("github.com")}static credential(e){return sr._fromParams({providerId:mr.PROVIDER_ID,signInMethod:mr.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return mr.credentialFromTaggedObject(e)}static credentialFromError(e){return mr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return mr.credential(e.oauthAccessToken)}catch(e){return null}}}mr.GITHUB_SIGN_IN_METHOD="github.com",mr.PROVIDER_ID="github.com";class gr extends Jn{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return ir(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,ir(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ir(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r,pendingToken:i}=t;return n&&r&&i&&n===r?new gr(n,i):null}static _create(e,t){return new gr(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class yr extends lr{constructor(e){Ut(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return yr.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return yr.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=gr.fromJSON(e);return Ut(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return gr._create(n,t)}catch(e){return null}}}class vr extends hr{constructor(){super("twitter.com")}static credential(e,t){return sr._fromParams({providerId:vr.PROVIDER_ID,signInMethod:vr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return vr.credentialFromTaggedObject(e)}static credentialFromError(e){return vr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return vr.credential(t,n)}catch(e){return null}}}async function wr(e,t){return Xt(e,"POST","/v1/accounts:signUp",Qt(e,t))}vr.TWITTER_SIGN_IN_METHOD="twitter.com",vr.PROVIDER_ID="twitter.com";class _r{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await wn._fromIdTokenResponse(e,n,r),s=Ir(n);return new _r({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=Ir(n);return new _r({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Ir(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class br extends b{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,br.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new br(e,t,n,r)}}function Tr(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw br._fromErrorAndOperation(e,n,t,r);throw n}))}function Er(e){return new Set(e.map((({providerId:e})=>e)).filter((e=>!!e)))}async function Sr(e,t,n=!1){const r=await dn(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return _r._forOperation(e,"link",r)}async function kr(e,t,n){await mn(t);const r=!1===e?"provider-already-linked":"no-such-provider";Ut(Er(t.providerData).has(n)===e,t.auth,r)}async function Cr(e,t,n=!1){const{auth:r}=e;if(Qe(r.app))return Promise.reject(Lt(r));const i="reauthenticate";try{const s=await dn(e,Tr(r,i,t,e),n);Ut(s.idToken,r,"internal-error");const o=ln(s.idToken);Ut(o,r,"internal-error");const{sub:a}=o;return Ut(e.uid===a,r,"user-mismatch"),_r._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&xt(r,"user-mismatch"),e}}async function Ar(e,t,n=!1){if(Qe(e.app))return Promise.reject(Lt(e));const r="signIn",i=await Tr(e,r,t),s=await _r._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}async function Nr(e,t){return Ar(qn(e),t)}async function Dr(e,t){const n=O(e);return await kr(!1,n,t.providerId),Sr(n,t)}async function Rr(e,t){return Cr(O(e),t)}class xr{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Pr._fromServerResponse(e,t):"totpInfo"in t?Or._fromServerResponse(e,t):xt(e,"internal-error")}}class Pr extends xr{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Pr(t)}}class Or extends xr{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Or(t)}}function Lr(e,t,n){var r;Ut((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),Ut(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(Ut(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(Ut(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function Mr(e){const t=qn(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function Fr(e,t){const n=O(e),r=await Yn(n,{oobCode:t}),i=r.requestType;switch(Ut(i,n,"internal-error"),i){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":Ut(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":Ut(r.mfaInfo,n,"internal-error");default:Ut(r.email,n,"internal-error")}let s=null;return r.mfaInfo&&(s=xr._fromServerResponse(qn(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:s},operation:i}}async function Ur(e,t,n){const{auth:r}=e,i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);const s=await dn(e,async function(e,t){return Jt(e,"POST","/v1/accounts:update",t)}(r,i));await e._updateTokensIfNecessary(s,!0)}class Vr{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class qr extends Vr{constructor(e,t,n,r){super(e,t,n),this.username=r}}class Br extends Vr{constructor(e,t){super(e,"facebook.com",t)}}class jr extends qr{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class zr extends Vr{constructor(e,t){super(e,"google.com",t)}}class Gr extends qr{constructor(e,t,n){super(e,"twitter.com",t,n)}}function Kr(e){const{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){var t,n;if(!e)return null;const{providerId:r}=e,i=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},s=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!r&&(null==e?void 0:e.idToken)){const r=null===(n=null===(t=ln(e.idToken))||void 0===t?void 0:t.firebase)||void 0===n?void 0:n.sign_in_provider;if(r)return new Vr(s,"anonymous"!==r&&"custom"!==r?r:null)}if(!r)return null;switch(r){case"facebook.com":return new Br(s,i);case"github.com":return new jr(s,i);case"google.com":return new zr(s,i);case"twitter.com":return new Gr(s,i,e.screenName||null);case"custom":case"anonymous":return new Vr(s,null);default:return new Vr(s,r,i)}}(n)}class $r{constructor(e,t,n){this.type=e,this.credential=t,this.user=n}static _fromIdtoken(e,t){return new $r("enroll",e,t)}static _fromMfaPendingCredential(e){return new $r("signin",e)}toJSON(){const e="enroll"===this.type?"idToken":"pendingCredential";return{multiFactorSession:{[e]:this.credential}}}static fromJSON(e){var t,n;if(null==e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return $r._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(n=e.multiFactorSession)||void 0===n?void 0:n.idToken)return $r._fromIdtoken(e.multiFactorSession.idToken)}return null}}class Hr{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){const n=qn(e),r=t.customData._serverResponse,i=(r.mfaInfo||[]).map((e=>xr._fromServerResponse(n,e)));Ut(r.mfaPendingCredential,n,"internal-error");const s=$r._fromMfaPendingCredential(r.mfaPendingCredential);return new Hr(s,i,(async e=>{const i=await e._process(n,s);delete r.mfaInfo,delete r.mfaPendingCredential;const o=Object.assign(Object.assign({},r),{idToken:i.idToken,refreshToken:i.refreshToken});switch(t.operationType){case"signIn":const e=await _r._fromIdTokenResponse(n,t.operationType,o);return await n._updateCurrentUser(e.user),e;case"reauthenticate":return Ut(t.user,n,"internal-error"),_r._forOperation(t.user,t.operationType,o);default:xt(n,"internal-error")}}))}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}class Wr{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload((t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map((t=>xr._fromServerResponse(e.auth,t))))}))}static _fromUser(e){return new Wr(e)}async getSession(){return $r._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const n=e,r=await this.getSession(),i=await dn(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid,n=await this.user.getIdToken();try{const e=await dn(this.user,function(e,t){return Jt(e,"POST","/v2/accounts/mfaEnrollment:withdraw",Qt(e,t))}(this.user.auth,{idToken:n,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter((({uid:e})=>e!==t)),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(e){throw e}}}const Qr=new WeakMap,Jr="__sak";class Yr{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Jr,"1"),this.storage.removeItem(Jr),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Xr extends Yr{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=f();return An(e)||On(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=Ln(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);w()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Xr.type="LOCAL";const Zr=Xr;class ei extends Yr{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}ei.type="SESSION";const ti=ei;class ni{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new ni(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function ri(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}ni.receivers=[];class ii{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((o,a)=>{const c=ri("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function si(){return window}function oi(){return void 0!==si().WorkerGlobalScope&&"function"==typeof si().importScripts}const ai="firebaseLocalStorageDb",ci="firebaseLocalStorage",ui="fbase_key";class li{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function hi(e,t){return e.transaction([ci],t?"readwrite":"readonly").objectStore(ci)}function di(){const e=indexedDB.open(ai,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(ci,{keyPath:ui})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(ci)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(ai);return new li(e).toPromise()}(),t(await di()))}))}))}async function fi(e,t,n){const r=hi(e,!0).put({[ui]:t,value:n});return new li(r).toPromise()}function pi(e,t){const n=hi(e,!0).delete(t);return new li(n).toPromise()}class mi{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await di()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return oi()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ni._getInstance(oi()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new ii(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await di();return await fi(e,Jr,"1"),await pi(e,Jr),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>fi(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=hi(e,!1).get(t),r=await new li(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>pi(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=hi(e,!1).getAll();return new li(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}mi.type="LOCAL";const gi=mi,yi=1e12;class vi{constructor(e){this.auth=e,this.counter=yi,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new wi(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;const n=e||yi;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;const n=e||yi;return(null===(t=this._widgets.get(n))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;const n=e||yi;return null===(t=this._widgets.get(n))||void 0===t||t.execute(),""}}class wi{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r="string"==typeof e?document.getElementById(e):e;Ut(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout((()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let e=0;e<50;e++)t.push(n.charAt(Math.floor(62*Math.random())));return t.join("")}();const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout((()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()}),6e4)}),500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const _i=Gn("rcb"),Ii=new Gt(3e4,6e4);class bi{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(null===(e=si().grecaptcha)||void 0===e?void 0:e.render)}load(e,t=""){return Ut(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(t),e,"argument-error"),this.shouldResolveImmediately(t)&&rn(si().grecaptcha)?Promise.resolve(si().grecaptcha):new Promise(((n,r)=>{const i=si().setTimeout((()=>{r(Pt(e,"network-request-failed"))}),Ii.get());si()[_i]=()=>{si().clearTimeout(i),delete si()[_i];const s=si().grecaptcha;if(!s||!rn(s))return void r(Pt(e,"internal-error"));const o=s.render;s.render=(e,t)=>{const n=o(e,t);return this.counter++,n},this.hostLanguage=t,n(s)},zn(`${jn.recaptchaV2Script}?${A({onload:_i,render:"explicit",hl:t})}`).catch((()=>{clearTimeout(i),r(Pt(e,"internal-error"))}))}))}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(null===(t=si().grecaptcha)||void 0===t?void 0:t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class Ti{async load(e){return new vi(e)}clearedOneInstance(){}}const Ei="recaptcha",Si={theme:"light",type:"image"};class ki{constructor(e,t,n=Object.assign({},Si)){this.parameters=n,this.type=Ei,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=qn(e),this.isInvisible="invisible"===this.parameters.size,Ut("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const r="string"==typeof t?document.getElementById(t):t;Ut(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Ti:new bi,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha();return t.getResponse(e)||new Promise((n=>{const r=e=>{e&&(this.tokenChangeListeners.delete(r),n(e))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)}))}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch((e=>{throw this.renderPromise=null,e}))),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach((e=>{this.container.removeChild(e)}))}validateStartingState(){Ut(!this.parameters.sitekey,this.auth,"argument-error"),Ut(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Ut("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach((e=>e(t))),"function"==typeof e)e(t);else if("string"==typeof e){const n=si()[e];"function"==typeof n&&n(t)}}}assertNotDestroyed(){Ut(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){Ut(jt()&&!oi(),this.auth,"internal-error"),await function(){let e=null;return new Promise((t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()})).catch((t=>{throw e&&window.removeEventListener("load",e),t}))}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await async function(e){return(await Jt(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}(this.auth);Ut(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return Ut(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Ci{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=ar._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function Ai(e,t,n){var r;const i=await n.verify();try{let s;if(Ut("string"==typeof i,e,"argument-error"),Ut(n.type===Ei,e,"argument-error"),s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){Ut("enroll"===t.type,e,"internal-error");const n=await function(e,t){return Jt(e,"POST","/v2/accounts/mfaEnrollment:start",Qt(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}});return n.phoneSessionInfo.sessionInfo}{Ut("signin"===t.type,e,"internal-error");const n=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;Ut(n,e,"missing-multi-factor-info");const o=await function(e,t){return Jt(e,"POST","/v2/accounts/mfaSignIn:start",Qt(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return Jt(e,"POST","/v1/accounts:sendVerificationCode",Qt(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}class Ni{constructor(e){this.providerId=Ni.PROVIDER_ID,this.auth=qn(e)}verifyPhoneNumber(e,t){return Ai(this.auth,e,O(t))}static credential(e,t){return ar._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Ni.credentialFromTaggedObject(t)}static credentialFromError(e){return Ni.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?ar._fromTokenResponse(t,n):null}}function Di(e,t){return t?In(t):(Ut(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Ni.PROVIDER_ID="phone",Ni.PHONE_SIGN_IN_METHOD="phone";class Ri extends Jn{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ir(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ir(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ir(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function xi(e){return Ar(e.auth,new Ri(e),e.bypassAuthState)}function Pi(e){const{auth:t,user:n}=e;return Ut(n,t,"internal-error"),Cr(n,new Ri(e),e.bypassAuthState)}async function Oi(e){const{auth:t,user:n}=e;return Ut(n,t,"internal-error"),Sr(n,new Ri(e),e.bypassAuthState)}class Li{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return xi;case"linkViaPopup":case"linkViaRedirect":return Oi;case"reauthViaPopup":case"reauthViaRedirect":return Pi;default:xt(this.auth,"internal-error")}}resolve(e){qt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){qt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Mi=new Gt(2e3,1e4);class Fi extends Li{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,Fi.currentPopupAction&&Fi.currentPopupAction.cancel(),Fi.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ut(e,this.auth,"internal-error"),e}async onExecution(){qt(1===this.filter.length,"Popup operations only handle one event");const e=ri();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(Pt(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Pt(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Fi.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(Pt(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,Mi.get())};e()}}Fi.currentPopupAction=null;const Ui="pendingRedirect",Vi=new Map;class qi extends Li{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Vi.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=Gi(t),r=zi(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}Vi.set(this.auth._key(),e)}return this.bypassAuthState||Vi.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function Bi(e,t){return zi(e)._set(Gi(t),"true")}function ji(e,t){Vi.set(e._key(),t)}function zi(e){return In(e._redirectPersistence)}function Gi(e){return En(Ui,e.config.apiKey,e.name)}async function Ki(e,t,n=!1){if(Qe(e.app))return Promise.reject(Lt(e));const r=qn(e),i=Di(r,t),s=new qi(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}async function $i(e){const t=ri(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class Hi{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Qi(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Qi(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(Pt(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Wi(e))}saveEventToCache(e){this.cachedEventUids.add(Wi(e)),this.lastProcessedEventTime=Date.now()}}function Wi(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function Qi({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function Ji(e,t={}){return Jt(e,"GET","/v1/projects",t)}const Yi=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Xi=/^https?/;function Zi(e){const t=Bt(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!Xi.test(n))return!1;if(Yi.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const es=new Gt(3e4,6e4);function ts(){const e=si().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}function ns(e){return new Promise(((t,n)=>{var r,i,s;function o(){ts(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{ts(),n(Pt(e,"network-request-failed"))},timeout:es.get()})}if(null===(i=null===(r=si().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=si().gapi)||void 0===s?void 0:s.load)){const t=Gn("iframefcb");return si()[t]=()=>{gapi.load?o():n(Pt(e,"network-request-failed"))},zn(`${jn.gapiScript}?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw rs=null,e}))}let rs=null;const is=new Gt(5e3,15e3),ss="__/auth/iframe",os="emulator/auth/iframe",as={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},cs=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function us(e){const t=e.config;Ut(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?Kt(t,os):`https://${e.config.authDomain}/${ss}`,r={apiKey:t.apiKey,appName:e.name,v:et},i=cs.get(e.config.apiHost);i&&(r.eid=i);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${A(r).slice(1)}`}const ls={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class hs{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const ds="__/auth/handler",fs="emulator/auth/handler",ps=encodeURIComponent("fac");async function ms(e,t,n,r,i,s){Ut(e.config.authDomain,e,"auth-domain-config-required"),Ut(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:et,eventId:i};if(t instanceof lr){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof hr){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];const c=await e._getAppCheckToken(),u=c?`#${ps}=${encodeURIComponent(c)}`:"";return`${function({config:e}){return e.emulator?Kt(e,fs):`https://${e.authDomain}/${ds}`}(e)}?${A(a).slice(1)}${u}`}const gs="webStorageSupport",ys=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ti,this._completeRedirectFn=Ki,this._overrideRedirectResult=ji}async _openPopup(e,t,n,r){var i;return qt(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),function(e,t,n,r=500,i=600){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},ls),{width:r.toString(),height:i.toString(),top:s,left:o}),u=f().toLowerCase();n&&(a=Nn(u)?"_blank":n),Cn(u)&&(t=t||"http://localhost",c.scrollbars="yes");const l=Object.entries(c).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=f()){var t;return On(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(u)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new hs(null);const h=window.open(t||"",a,l);Ut(h,e,"popup-blocked");try{h.focus()}catch(e){}return new hs(h)}(e,await ms(e,t,n,Bt(),r),ri())}async _openRedirect(e,t,n,r){return await this._originValidation(e),i=await ms(e,t,n,Bt(),r),si().location.href=i,new Promise((()=>{}));var i}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(qt(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await function(e){return rs=rs||ns(e),rs}(e),n=si().gapi;return Ut(n,e,"internal-error"),t.open({where:document.body,url:us(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:as,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=Pt(e,"network-request-failed"),s=si().setTimeout((()=>{r(i)}),is.get());function o(){si().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{r(i)}))}))))}(e),n=new Hi(e);return t.register("authEvent",(t=>(Ut(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(gs,{type:gs},(n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[gs];void 0!==i&&t(!!i),xt(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await Ji(e);for(const e of t)try{if(Zi(e))return}catch(e){}xt(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Ln()||An()||On()}};class vs{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return Vt("unexpected MultiFactorSessionType")}}}class ws extends vs{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new ws(e)}_finalizeEnroll(e,t,n){return function(e,t){return Jt(e,"POST","/v2/accounts/mfaEnrollment:finalize",Qt(e,t))}(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return function(e,t){return Jt(e,"POST","/v2/accounts/mfaSignIn:finalize",Qt(e,t))}(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class _s{constructor(){}static assertion(e){return ws._fromCredential(e)}}_s.FACTOR_ID="phone";var Is,bs,Ts,Es="@firebase/auth",Ss="1.7.5";class ks{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ut(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Cs(){return window}null===(Is=l())||void 0===Is||Is._authIdTokenMaxAge,bs={loadJS:e=>new Promise(((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=Pt("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},jn=bs,Ts="Browser",Ke(new L("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=n.options;Ut(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:s,authDomain:o,clientPlatform:Ts,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Mn(Ts)},c=new Vn(n,r,i,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(In);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(c,t),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),Ke(new L("auth-internal",(e=>(e=>new ks(e))(qn(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),ot(Es,Ss,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Ts)),ot(Es,Ss,"esm2017");class As extends Hi{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise((e=>{this.resolveInialized=e}))}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach((t=>t(e))),super.onEvent(e)}async initialized(){await this.initPromise}}async function Ns(e){const t=await Rs()._get(xs(e));return t&&await Rs()._remove(xs(e)),t}function Ds(){const e=[];for(let t=0;t<20;t++){const t=Math.floor(62*Math.random());e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(t))}return e.join("")}function Rs(){return In(Zr)}function xs(e){return En("authEvent",e.config.apiKey,e.name)}function Ps(e){if(!(null==e?void 0:e.includes("?")))return{};const[t,...n]=e.split("?");return N(n.join("?"))}const Os=class{constructor(){this._redirectPersistence=ti,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Ki,this._overrideRedirectResult=ji}async _initialize(e){const t=e._key();let n=this.eventManagers.get(t);return n||(n=new As(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){xt(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){!function(e){var t,n,r,i,s,o,a,c,u,l;const h=Cs();Ut("function"==typeof(null===(t=null==h?void 0:h.universalLinks)||void 0===t?void 0:t.subscribe),e,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),Ut(void 0!==(null===(n=null==h?void 0:h.BuildInfo)||void 0===n?void 0:n.packageName),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),Ut("function"==typeof(null===(s=null===(i=null===(r=null==h?void 0:h.cordova)||void 0===r?void 0:r.plugins)||void 0===i?void 0:i.browsertab)||void 0===s?void 0:s.openUrl),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),Ut("function"==typeof(null===(c=null===(a=null===(o=null==h?void 0:h.cordova)||void 0===o?void 0:o.plugins)||void 0===a?void 0:a.browsertab)||void 0===c?void 0:c.isAvailable),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),Ut("function"==typeof(null===(l=null===(u=null==h?void 0:h.cordova)||void 0===u?void 0:u.InAppBrowser)||void 0===l?void 0:l.open),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(e);const i=await this._initialize(e);await i.initialized(),i.resetRedirect(),Vi.clear(),await this._originValidation(e);const s=function(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:Ds(),postBody:null,tenantId:e.tenantId,error:Pt(e,"no-auth-event")}}(e,n,r);await function(e,t){return Rs()._set(xs(e),t)}(e,s);const o=await async function(e,t,n){var r;const{BuildInfo:i}=Cs();qt(t.sessionId,"AuthEvent did not contain a session ID");const s=await async function(e){const t=function(e){if(qt(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return n}(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}(t.sessionId),o={};return On()?o.ibi=i.packageName:Rn()?o.apn=i.packageName:xt(e,"operation-not-supported-in-this-environment"),i.displayName&&(o.appDisplayName=i.displayName),o.sessionId=s,ms(e,n,t.type,void 0,null!==(r=t.eventId)&&void 0!==r?r:void 0,o)}(e,s,t);return async function(e,t,n){const{cordova:r}=Cs();let i=()=>{};try{await new Promise(((s,o)=>{let a=null;function c(){var e;s();const t=null===(e=r.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==n?void 0:n.close)&&n.close()}function u(){a||(a=window.setTimeout((()=>{o(Pt(e,"redirect-cancelled-by-user"))}),2e3))}function l(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&u()}t.addPassiveListener(c),document.addEventListener("resume",u,!1),Rn()&&document.addEventListener("visibilitychange",l,!1),i=()=>{t.removePassiveListener(c),document.removeEventListener("resume",u,!1),document.removeEventListener("visibilitychange",l,!1),a&&window.clearTimeout(a)}}))}finally{i()}}(e,i,await function(e){const{cordova:t}=Cs();return new Promise((n=>{t.plugins.browsertab.isAvailable((r=>{let i=null;r?t.plugins.browsertab.openUrl(e):i=t.InAppBrowser.open(e,function(e=f()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)}()?"_blank":"_system","location=yes"),n(i)}))}))}(o))}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){const{BuildInfo:t}=Cs(),n={};On()?n.iosBundleId=t.packageName:Rn()?n.androidPackageName=t.packageName:xt(e,"operation-not-supported-in-this-environment"),await Ji(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:n,handleOpenURL:r,BuildInfo:i}=Cs(),s=setTimeout((async()=>{await Ns(e),t.onEvent(Ls())}),500),o=async n=>{clearTimeout(s);const r=await Ns(e);let i=null;r&&(null==n?void 0:n.url)&&(i=function(e,t){var n,r;const i=function(e){const t=Ps(e),n=t.link?decodeURIComponent(t.link):void 0,r=Ps(n).link,i=t.deep_link_id?decodeURIComponent(t.deep_link_id):void 0;return Ps(i).link||i||r||n||e}(t);if(i.includes("/__/auth/callback")){const t=Ps(i),s=t.firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(t.firebaseError)):null,o=null===(r=null===(n=null==s?void 0:s.code)||void 0===n?void 0:n.split("auth/"))||void 0===r?void 0:r[1],a=o?Pt(o):null;return a?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:a,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:i,postBody:null}}return null}(r,n.url)),t.onEvent(i||Ls())};void 0!==n&&"function"==typeof n.subscribe&&n.subscribe(null,o);const a=r,c=`${i.packageName.toLowerCase()}://`;Cs().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&o({url:e}),"function"==typeof a)try{a(e)}catch(e){console.error(e)}}}};function Ls(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:Pt("no-auth-event")}}function Ms(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function Fs(e=f()){return!("file:"!==Ms()&&"ionic:"!==Ms()&&"capacitor:"!==Ms()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function Us(){try{const e=self.localStorage,t=ri();if(e)return e.setItem(t,"1"),e.removeItem(t),!function(e=f()){return w()&&11===(null===document||void 0===document?void 0:document.documentMode)||function(e=f()){return/Edge\/\d+/.test(e)}(e)}()||I()}catch(e){return Vs()&&I()}return!1}function Vs(){return void 0!==e.g&&"WorkerGlobalScope"in e.g&&"importScripts"in e.g}function qs(){return("http:"===Ms()||"https:"===Ms()||y()||Fs())&&!(v()||p())&&Us()&&!Vs()}function Bs(){return Fs()&&"undefined"!=typeof document}const js={LOCAL:"local",NONE:"none",SESSION:"session"},zs=Ut,Gs="persistence";async function Ks(e){await e._initializationPromise;const t=$s(),n=En(Gs,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function $s(){var e;try{return(null===(e="undefined"!=typeof window?window:null)||void 0===e?void 0:e.sessionStorage)||null}catch(e){return null}}const Hs=Ut;class Ws{constructor(){this.browserResolver=In(ys),this.cordovaResolver=In(Os),this.underlyingResolver=null,this._redirectPersistence=ti,this._completeRedirectFn=Ki,this._overrideRedirectResult=ji}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return Bs()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Hs(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await async function(){return!!Bs()&&new Promise((e=>{const t=setTimeout((()=>{e(!1)}),1e3);document.addEventListener("deviceready",(()=>{clearTimeout(t),e(!0)}))}))}();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function Qs(e){return e.unwrap()}function Js(e){const{_tokenResponse:t}=e instanceof b?e.customData:e;if(!t)return null;if(!(e instanceof b)&&"temporaryProof"in t&&"phoneNumber"in t)return Ni.credentialFromResult(e);const n=t.providerId;if(!n||n===kt.PASSWORD)return null;let r;switch(n){case kt.GOOGLE:r=pr;break;case kt.FACEBOOK:r=fr;break;case kt.GITHUB:r=mr;break;case kt.TWITTER:r=vr;break;default:const{oauthIdToken:e,oauthAccessToken:i,oauthTokenSecret:s,pendingToken:o,nonce:a}=t;return i||s||e||o?o?n.startsWith("saml.")?gr._create(n,o):sr._fromParams({providerId:n,signInMethod:n,pendingToken:o,idToken:e,accessToken:i}):new dr(n).credential({idToken:e,accessToken:i,rawNonce:a}):null}return e instanceof b?r.credentialFromError(e):r.credentialFromResult(e)}function Ys(e,t){return t.catch((t=>{throw t instanceof b&&function(e,t){var n;const r=null===(n=t.customData)||void 0===n?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===(null==t?void 0:t.code))t.resolver=new Zs(e,function(e,t){var n;const r=O(e),i=t;return Ut(t.customData.operationType,r,"argument-error"),Ut(null===(n=i.customData._serverResponse)||void 0===n?void 0:n.mfaPendingCredential,r,"argument-error"),Hr._fromError(r,i)}(e,t));else if(r){const e=Js(t),n=t;e&&(n.credential=e,n.tenantId=r.tenantId||void 0,n.email=r.email||void 0,n.phoneNumber=r.phoneNumber||void 0)}}(e,t),t})).then((e=>{const t=e.operationType,n=e.user;return{operationType:t,credential:(r=e,Js(r)),additionalUserInfo:Kr(e),user:eo.getOrCreate(n)};var r}))}async function Xs(e,t){const n=await t;return{verificationId:n.verificationId,confirm:t=>Ys(e,n.confirm(t))}}class Zs{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return Ys(Qs(this.auth),this.resolver.resolveSignIn(e))}}class eo{constructor(e){this._delegate=e,this.multiFactor=function(e){const t=O(e);return Qr.has(t)||Qr.set(t,Wr._fromUser(t)),Qr.get(t)}(e)}static getOrCreate(e){return eo.USER_MAP.has(e)||eo.USER_MAP.set(e,new eo(e)),eo.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return Ys(this.auth,Dr(this._delegate,e))}async linkWithPhoneNumber(e,t){return Xs(this.auth,async function(e,t,n){const r=O(e);await kr(!1,r,"phone");const i=await Ai(r.auth,t,O(n));return new Ci(i,(e=>Dr(r,e)))}(this._delegate,e,t))}async linkWithPopup(e){return Ys(this.auth,async function(e,t,n){const r=O(e);Mt(r.auth,t,lr);const i=Di(r.auth,n);return new Fi(r.auth,"linkViaPopup",t,i,r).executeNotNull()}(this._delegate,e,Ws))}async linkWithRedirect(e){return await Ks(qn(this.auth)),function(e,t,n){return async function(e,t,n){const r=O(e);Mt(r.auth,t,lr),await r.auth._initializationPromise;const i=Di(r.auth,n);await kr(!1,r,t.providerId),await Bi(i,r.auth);const s=await $i(r);return i._openRedirect(r.auth,t,"linkViaRedirect",s)}(e,t,n)}(this._delegate,e,Ws)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return Ys(this.auth,Rr(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return Xs(this.auth,async function(e,t,n){const r=O(e);if(Qe(r.auth.app))return Promise.reject(Lt(r.auth));const i=await Ai(r.auth,t,O(n));return new Ci(i,(e=>Rr(r,e)))}(this._delegate,e,t))}reauthenticateWithPopup(e){return Ys(this.auth,async function(e,t,n){const r=O(e);if(Qe(r.auth.app))return Promise.reject(Pt(r.auth,"operation-not-supported-in-this-environment"));Mt(r.auth,t,lr);const i=Di(r.auth,n);return new Fi(r.auth,"reauthViaPopup",t,i,r).executeNotNull()}(this._delegate,e,Ws))}async reauthenticateWithRedirect(e){return await Ks(qn(this.auth)),function(e,t,n){return async function(e,t,n){const r=O(e);if(Mt(r.auth,t,lr),Qe(r.auth.app))return Promise.reject(Lt(r.auth));await r.auth._initializationPromise;const i=Di(r.auth,n);await Bi(i,r.auth);const s=await $i(r);return i._openRedirect(r.auth,t,"reauthViaRedirect",s)}(e,t,n)}(this._delegate,e,Ws)}sendEmailVerification(e){return async function(e,t){const n=O(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&Lr(n.auth,r,t);const{email:i}=await async function(e,t){return er(e,t)}(n.auth,r);i!==e.email&&await e.reload()}(this._delegate,e)}async unlink(e){return await async function(e,t){const n=O(e);await kr(!0,n,t);const{providerUserInfo:r}=await async function(e,t){return Jt(e,"POST","/v1/accounts:update",t)}(n.auth,{idToken:await n.getIdToken(),deleteProvider:[t]}),i=Er(r||[]);return n.providerData=n.providerData.filter((e=>i.has(e.providerId))),i.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}(this._delegate,e),this}updateEmail(e){return function(e,t){const n=O(e);return Qe(n.auth.app)?Promise.reject(Lt(n.auth)):Ur(n,t,null)}(this._delegate,e)}updatePassword(e){return function(e,t){return Ur(O(e),null,t)}(this._delegate,e)}updatePhoneNumber(e){return async function(e,t){const n=O(e);if(Qe(n.auth.app))return Promise.reject(Lt(n.auth));await Sr(n,t)}(this._delegate,e)}updateProfile(e){return async function(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const r=O(e),i={idToken:await r.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},s=await dn(r,async function(e,t){return Jt(e,"POST","/v1/accounts:update",t)}(r.auth,i));r.displayName=s.displayName||null,r.photoURL=s.photoUrl||null;const o=r.providerData.find((({providerId:e})=>"password"===e));o&&(o.displayName=r.displayName,o.photoURL=r.photoURL),await r._updateTokensIfNecessary(s)}(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return async function(e,t,n){const r=O(e),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&Lr(r.auth,i,n);const{email:s}=await async function(e,t){return er(e,t)}(r.auth,i);s!==e.email&&await e.reload()}(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}eo.USER_MAP=new WeakMap;const to=Ut;class no{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:n}=e.options;to(n,"invalid-api-key",{appName:e.name}),to(n,"invalid-api-key",{appName:e.name});const r="undefined"!=typeof window?Ws:void 0;this._delegate=t.initialize({options:{persistence:io(n,e.name),popupRedirectResolver:r}}),this._delegate._updateErrorMap(Ct),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?eo.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){!function(e,t,n){const r=qn(e);Ut(r._canInitEmulator,r,"emulator-config-failed"),Ut(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=Wn(t),{host:o,port:a}=function(e){const t=Wn(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:Qn(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Qn(t)}}}(t),c=null===a?"":`:${a}`;r.config.emulator={url:`${s}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(this._delegate,e,t)}applyActionCode(e){return async function(e,t){await async function(e,t){return Jt(e,"POST","/v1/accounts:update",Qt(e,t))}(O(e),{oobCode:t})}(this._delegate,e)}checkActionCode(e){return Fr(this._delegate,e)}confirmPasswordReset(e,t){return async function(e,t,n){await Yn(O(e),{oobCode:t,newPassword:n}).catch((async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&Mr(e),t}))}(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return Ys(this._delegate,async function(e,t,n){if(Qe(e.app))return Promise.reject(Lt(e));const r=qn(e),i=Hn(r,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",wr),s=await i.catch((t=>{throw"auth/password-does-not-meet-requirements"===t.code&&Mr(e),t})),o=await _r._fromIdTokenResponse(r,"signIn",s);return await r._updateCurrentUser(o.user),o}(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return async function(e,t){const n={identifier:t,continueUri:jt()?Bt():"http://localhost"},{signinMethods:r}=await async function(e,t){return Jt(e,"POST","/v1/accounts:createAuthUri",Qt(e,t))}(O(e),n);return r||[]}(this._delegate,e)}isSignInWithEmailLink(e){return function(e,t){const n=cr.parseLink(t);return"EMAIL_SIGNIN"===(null==n?void 0:n.operation)}(this._delegate,e)}async getRedirectResult(){to(qs(),this._delegate,"operation-not-supported-in-this-environment");const e=await async function(e,t){return await qn(e)._initializationPromise,Ki(e,t,!1)}(this._delegate,Ws);return e?Ys(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){!function(e,t){qn(e)._logFramework(t)}(this._delegate,e)}onAuthStateChanged(e,t,n){const{next:r,error:i,complete:s}=ro(e,t,n);return this._delegate.onAuthStateChanged(r,i,s)}onIdTokenChanged(e,t,n){const{next:r,error:i,complete:s}=ro(e,t,n);return this._delegate.onIdTokenChanged(r,i,s)}sendSignInLinkToEmail(e,t){return async function(e,t,n){const r=qn(e),i={requestType:"EMAIL_SIGNIN",email:t,clientType:"CLIENT_TYPE_WEB"};!function(e,t){Ut(t.handleCodeInApp,r,"argument-error"),t&&Lr(r,e,t)}(i,n),await Hn(r,i,"getOobCode",nr)}(this._delegate,e,t)}sendPasswordResetEmail(e,t){return async function(e,t,n){const r=qn(e),i={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};n&&Lr(r,i,n),await Hn(r,i,"getOobCode",tr)}(this._delegate,e,t||void 0)}async setPersistence(e){let t;switch(function(e,t){zs(Object.values(js).includes(t),e,"invalid-persistence-type"),v()?zs(t!==js.SESSION,e,"unsupported-persistence-type"):p()?zs(t===js.NONE,e,"unsupported-persistence-type"):Vs()?zs(t===js.NONE||t===js.LOCAL&&I(),e,"unsupported-persistence-type"):zs(t===js.NONE||Us(),e,"unsupported-persistence-type")}(this._delegate,e),e){case js.SESSION:t=ti;break;case js.LOCAL:t=await In(gi)._isAvailable()?gi:Zr;break;case js.NONE:t=Tn;break;default:return xt("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return Ys(this._delegate,async function(e){var t;if(Qe(e.app))return Promise.reject(Lt(e));const n=qn(e);if(await n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new _r({user:n.currentUser,providerId:null,operationType:"signIn"});const r=await wr(n,{returnSecureToken:!0}),i=await _r._fromIdTokenResponse(n,"signIn",r,!0);return await n._updateCurrentUser(i.user),i}(this._delegate))}signInWithCredential(e){return Ys(this._delegate,Nr(this._delegate,e))}signInWithCustomToken(e){return Ys(this._delegate,async function(e,t){if(Qe(e.app))return Promise.reject(Lt(e));const n=qn(e),r=await async function(e,t){return Xt(e,"POST","/v1/accounts:signInWithCustomToken",Qt(e,t))}(n,{token:t,returnSecureToken:!0}),i=await _r._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(i.user),i}(this._delegate,e))}signInWithEmailAndPassword(e,t){return Ys(this._delegate,function(e,t,n){return Qe(e.app)?Promise.reject(Lt(e)):Nr(O(e),ur.credential(t,n)).catch((async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&Mr(e),t}))}(this._delegate,e,t))}signInWithEmailLink(e,t){return Ys(this._delegate,async function(e,t,n){if(Qe(e.app))return Promise.reject(Lt(e));const r=O(e),i=ur.credentialWithLink(t,n||Bt());return Ut(i._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Nr(r,i)}(this._delegate,e,t))}signInWithPhoneNumber(e,t){return Xs(this._delegate,async function(e,t,n){if(Qe(e.app))return Promise.reject(Lt(e));const r=qn(e),i=await Ai(r,t,O(n));return new Ci(i,(e=>Nr(r,e)))}(this._delegate,e,t))}async signInWithPopup(e){return to(qs(),this._delegate,"operation-not-supported-in-this-environment"),Ys(this._delegate,async function(e,t,n){if(Qe(e.app))return Promise.reject(Pt(e,"operation-not-supported-in-this-environment"));const r=qn(e);Mt(e,t,lr);const i=Di(r,n);return new Fi(r,"signInViaPopup",t,i).executeNotNull()}(this._delegate,e,Ws))}async signInWithRedirect(e){return to(qs(),this._delegate,"operation-not-supported-in-this-environment"),await Ks(this._delegate),function(e,t,n){return async function(e,t,n){if(Qe(e.app))return Promise.reject(Lt(e));const r=qn(e);Mt(e,t,lr),await r._initializationPromise;const i=Di(r,n);return await Bi(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}(this._delegate,e,Ws)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return async function(e,t){const{data:n}=await Fr(O(e),t);return n.email}(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function ro(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&eo.getOrCreate(e)),error:t,complete:n}}function io(e,t){const n=function(e,t){const n=$s();if(!n)return[];const r=En(Gs,e,t);switch(n.getItem(r)){case js.NONE:return[Tn];case js.LOCAL:return[gi,ti];case js.SESSION:return[ti];default:return[]}}(e,t);if("undefined"==typeof self||n.includes(gi)||n.push(gi),"undefined"!=typeof window)for(const e of[Zr,ti])n.includes(e)||n.push(e);return n.includes(Tn)||n.push(Tn),n}no.Persistence=js;class so{constructor(){this.providerId="phone",this._delegate=new Ni(Qs(Et.auth()))}static credential(e,t){return Ni.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}so.PHONE_SIGN_IN_METHOD=Ni.PHONE_SIGN_IN_METHOD,so.PROVIDER_ID=Ni.PROVIDER_ID;const oo=Ut;var ao;(ao=Et).INTERNAL.registerComponent(new L("auth-compat",(e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new no(t,n)}),"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:ur,FacebookAuthProvider:fr,GithubAuthProvider:mr,GoogleAuthProvider:pr,OAuthProvider:dr,SAMLAuthProvider:yr,PhoneAuthProvider:so,PhoneMultiFactorGenerator:_s,RecaptchaVerifier:class{constructor(e,t,n=Et.app()){var r;oo(null===(r=n.options)||void 0===r?void 0:r.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new ki(n.auth(),e,t),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}},TwitterAuthProvider:vr,Auth:no,AuthCredential:Jn,Error:b}).setInstantiationMode("LAZY").setMultipleInstances(!1)),ao.registerVersion("@firebase/auth-compat","0.5.10");var co,uo,lo="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ho={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],o=t+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+(o<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(t=n+((o=t+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(t^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function r(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}(t,(function(){this.blockSize=-1})),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var r=t-this.blockSize,i=this.B,s=this.h,o=0;o<t;){if(0==s)for(;o<=r;)n(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(i[s++]=e.charCodeAt(o++),s==this.blockSize){n(this,i),s=0;break}}else for(;o<t;)if(i[s++]=e[o++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var i={};function s(e){return-128<=e&&128>e?function(e,t){var n=i;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=function(e){return new r([0|e],0>e?-1:0)}(e)}(e):new r([0|e],0>e?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return a;if(0>e)return d(o(-e));for(var t=[],n=1,i=0;e>=n;i++)t[i]=e/n|0,n*=4294967296;return new r(t,0)}var a=s(0),c=s(1),u=s(16777216);function l(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function h(e){return-1==e.h}function d(e){for(var t=e.g.length,n=[],i=0;i<t;i++)n[i]=~e.g[i];return new r(n,~e.h).add(c)}function f(e,t){return e.add(d(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function m(e,t){this.g=e,this.h=t}function g(e,t){if(l(t))throw Error("division by zero");if(l(e))return new m(a,a);if(h(e))return t=g(d(e),t),new m(d(t.g),d(t.h));if(h(t))return t=g(e,d(t)),new m(d(t.g),t.h);if(30<e.g.length){if(h(e)||h(t))throw Error("slowDivide_ only works with positive integers.");for(var n=c,r=t;0>=r.l(e);)n=y(n),r=y(r);var i=v(n,1),s=v(r,1);for(r=v(r,2),n=v(n,2);!l(r);){var u=s.add(r);0>=u.l(e)&&(i=i.add(n),s=u),r=v(r,1),n=v(n,1)}return t=f(e,i.j(t)),new m(i,t)}for(i=a;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),u=(s=o(n)).j(t);h(u)||0<u.l(e);)u=(s=o(n-=r)).j(t);l(s)&&(s=c),i=i.add(s),e=f(e,u)}return new m(i,e)}function y(e){for(var t=e.g.length+1,n=[],i=0;i<t;i++)n[i]=e.i(i)<<1|e.i(i-1)>>>31;return new r(n,e.h)}function v(e,t){var n=t>>5;t%=32;for(var i=e.g.length-n,s=[],o=0;o<i;o++)s[o]=0<t?e.i(o+n)>>>t|e.i(o+n+1)<<32-t:e.i(o+n);return new r(s,e.h)}(e=r.prototype).m=function(){if(h(this))return-d(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(l(this))return"0";if(h(this))return"-"+d(this).toString(e);for(var t=o(Math.pow(e,6)),n=this,r="";;){var i=g(n,t).g,s=((0<(n=f(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(l(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return h(e=f(this,e))?-1:l(e)?0:1},e.abs=function(){return h(this)?d(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0,s=0;s<=t;s++){var o=i+(65535&this.i(s))+(65535&e.i(s)),a=(o>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);i=a>>>16,o&=65535,a&=65535,n[s]=a<<16|o}return new r(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(l(this)||l(e))return a;if(h(this))return h(e)?d(this).j(d(e)):d(d(this).j(e));if(h(e))return d(this.j(d(e)));if(0>this.l(u)&&0>e.l(u))return o(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var s=0;s<e.g.length;s++){var c=this.i(i)>>>16,f=65535&this.i(i),m=e.i(s)>>>16,g=65535&e.i(s);n[2*i+2*s]+=f*g,p(n,2*i+2*s),n[2*i+2*s+1]+=c*g,p(n,2*i+2*s+1),n[2*i+2*s+1]+=f*m,p(n,2*i+2*s+1),n[2*i+2*s+2]+=c*m,p(n,2*i+2*s+2)}for(i=0;i<t;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=t;i<2*t;i++)n[i]=0;return new r(n,0)},e.A=function(e){return g(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)&e.i(i);return new r(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)|e.i(i);return new r(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)^e.i(i);return new r(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,uo=ho.Md5=t,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.A,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=o,r.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return d(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=o(Math.pow(n,8)),i=a,s=0;s<t.length;s+=8){var c=Math.min(8,t.length-s),u=parseInt(t.substring(s,s+c),n);8>c?(c=o(Math.pow(n,c)),i=i.j(c).add(o(u))):i=(i=i.j(r)).add(o(u))}return i},co=ho.Integer=r}).apply(void 0!==lo?lo:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var fo,po,mo,go,yo,vo,wo,_o,Io,bo="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},To={};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof bo&&bo];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,r){if(r)e:{var i=n;e=e.split(".");for(var s=0;s<e.length-1;s++){var o=e[s];if(!(o in i))break e;i=i[o]}(r=r(s=i[e=e[e.length-1]]))!=s&&null!=r&&t(i,e,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(0,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(e,t){return t}))}}));var r=r||{},i=this||self;function s(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e,t,n){return e.call.apply(e.bind,arguments)}function c(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function u(e,t,n){return(u=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:c).apply(null,arguments)}function l(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function h(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function d(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function f(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(s(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function p(e){return/^[\s\xa0]*$/.test(e)}function m(){var e=i.navigator;return e&&(e=e.userAgent)?e:""}function g(e){return g[" "](e),e}g[" "]=function(){};var y=!(-1==m().indexOf("Gecko")||-1!=m().toLowerCase().indexOf("webkit")&&-1==m().indexOf("Edge")||-1!=m().indexOf("Trident")||-1!=m().indexOf("MSIE")||-1!=m().indexOf("Edge"));function v(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function w(e){const t={};for(const n in e)t[n]=e[n];return t}const _="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function I(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<_.length;t++)n=_[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function b(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function T(e){i.setTimeout((()=>{throw e}),0)}function E(){var e=N;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var S=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new k),(e=>e.reset()));class k{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let C,A=!1,N=new class{constructor(){this.h=this.g=null}add(e,t){const n=S.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},D=()=>{const e=i.Promise.resolve(void 0);C=()=>{e.then(R)}};var R=()=>{for(var e;e=E();){try{e.h.call(e.g)}catch(e){T(e)}var t=S;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}A=!1};function x(){this.s=this.s,this.C=this.C}function P(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}x.prototype.s=!1,x.prototype.ma=function(){this.s||(this.s=!0,this.N())},x.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},P.prototype.h=function(){this.defaultPrevented=!0};var O=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};i.addEventListener("test",e,t),i.removeEventListener("test",e,t)}catch(e){}return e}();function L(e,t){if(P.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(y){e:{try{g(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:M[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&L.aa.h.call(this)}}h(L,P);var M={2:"touch",3:"pen",4:"mouse"};L.prototype.h=function(){L.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var F="closure_listenable_"+(1e6*Math.random()|0),U=0;function V(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++U,this.da=this.fa=!1}function q(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function B(e){this.src=e,this.g={},this.h=0}function j(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(q(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function z(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.da&&s.listener==t&&s.capture==!!n&&s.ha==r)return i}return-1}B.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=z(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new V(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var G="closure_lm_"+(1e6*Math.random()|0),K={};function $(e,t,n,r,i){if(r&&r.once)return W(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)$(e,t[s],n,r,i);return null}return n=te(n),e&&e[F]?e.K(t,n,o(r)?!!r.capture:!!r,i):H(e,t,n,!1,r,i)}function H(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=o(i)?!!i.capture:!!i,c=Z(e);if(c||(e[G]=c=new B(e)),(n=c.add(t,n,r,a,s)).proxy)return n;if(r=function(){const e=X;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)O||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Y(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function W(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)W(e,t[s],n,r,i);return null}return n=te(n),e&&e[F]?e.L(t,n,o(r)?!!r.capture:!!r,i):H(e,t,n,!0,r,i)}function Q(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)Q(e,t[s],n,r,i);else r=o(r)?!!r.capture:!!r,n=te(n),e&&e[F]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=z(s=e.g[t],n,r,i))&&(q(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=Z(e))&&(t=e.g[t.toString()],e=-1,t&&(e=z(t,n,r,i)),(n=-1<e?t[e]:null)&&J(n))}function J(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[F])j(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Y(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Z(t))?(j(n,e),0==n.h&&(n.src=null,t[G]=null)):q(e)}}}function Y(e){return e in K?K[e]:K[e]="on"+e}function X(e,t){if(e.da)e=!0;else{t=new L(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&J(e),e=n.call(r,t)}return e}function Z(e){return(e=e[G])instanceof B?e:null}var ee="__closure_events_fn_"+(1e9*Math.random()>>>0);function te(e){return"function"==typeof e?e:(e[ee]||(e[ee]=function(t){return e.handleEvent(t)}),e[ee])}function ne(){x.call(this),this.i=new B(this),this.M=this,this.F=null}function re(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"==typeof t)t=new P(t,e);else if(t instanceof P)t.target=t.target||e;else{var i=t;I(t=new P(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=ie(o,r,!0,t)&&i}if(i=ie(o=t.g=e,r,!0,t)&&i,i=ie(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=ie(o=t.g=n[s],r,!1,t)&&i}function ie(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.da&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.fa&&j(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}function se(e,t,n){if("function"==typeof e)n&&(e=u(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=u(e.handleEvent,e)}return 2147483647<Number(t)?-1:i.setTimeout(e,t||0)}function oe(e){e.g=se((()=>{e.g=null,e.i&&(e.i=!1,oe(e))}),e.l);const t=e.h;e.h=null,e.m.apply(null,t)}h(ne,x),ne.prototype[F]=!0,ne.prototype.removeEventListener=function(e,t,n,r){Q(this,e,t,n,r)},ne.prototype.N=function(){if(ne.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)q(n[r]);delete t.g[e],t.h--}}this.F=null},ne.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ne.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class ae extends x{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:oe(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ce(e){x.call(this),this.h=e,this.g={}}h(ce,x);var ue=[];function le(e){v(e.g,(function(e,t){this.g.hasOwnProperty(t)&&J(e)}),e),e.g={}}ce.prototype.N=function(){ce.aa.N.call(this),le(this)},ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var he=i.JSON.stringify,de=i.JSON.parse,fe=class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}};function pe(){}function me(e){return e.h||(e.h=e.i())}function ge(){}pe.prototype.h=null;var ye={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ve(){P.call(this,"d")}function we(){P.call(this,"c")}h(ve,P),h(we,P);var _e={},Ie=null;function be(){return Ie=Ie||new ne}function Te(e){P.call(this,_e.La,e)}function Ee(e){const t=be();re(t,new Te(t))}function Se(e,t){P.call(this,_e.STAT_EVENT,e),this.stat=t}function ke(e){const t=be();re(t,new Se(t,e))}function Ce(e,t){P.call(this,_e.Ma,e),this.size=t}function Ae(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout((function(){e()}),t)}function Ne(){this.g=!0}function De(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return he(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}_e.La="serverreachability",h(Te,P),_e.STAT_EVENT="statevent",h(Se,P),_e.Ma="timingevent",h(Ce,P),Ne.prototype.xa=function(){this.g=!1},Ne.prototype.info=function(){};var Re,xe={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Pe={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Oe(){}function Le(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new ce(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Me}function Me(){this.i=null,this.g="",this.h=!1}h(Oe,pe),Oe.prototype.g=function(){return new XMLHttpRequest},Oe.prototype.i=function(){return{}},Re=new Oe;var Fe={},Ue={};function Ve(e,t,n){e.L=1,e.v=ht(ot(t)),e.m=n,e.P=!0,qe(e,null)}function qe(e,t){e.F=Date.now(),ze(e),e.A=ot(e.v);var n=e.A,r=e.R;Array.isArray(r)||(r=[String(r)]),St(n.i,"t",r),e.C=0,n=e.j.J,e.h=new Me,e.g=fn(e.j,n?t:null,!e.m),0<e.O&&(e.M=new ae(u(e.Y,e,e.g),e.O)),t=e.U,n=e.g,r=e.ca;var i="readystatechange";Array.isArray(i)||(i&&(ue[0]=i.toString()),i=ue);for(var s=0;s<i.length;s++){var o=$(n,i[s],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}t=e.H?w(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Ee(),function(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.i,e.u,e.A,e.l,e.R,e.m)}function Be(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function je(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Ue:(n=Number(t.substring(n,r)),isNaN(n)?Fe:(r+=1)+n>t.length?Ue:(t=t.slice(r,r+n),e.C=r+n,t))}function ze(e){e.S=Date.now()+e.I,Ge(e,e.I)}function Ge(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Ae(u(e.ba,e),t)}function Ke(e){e.B&&(i.clearTimeout(e.B),e.B=null)}function $e(e){0==e.j.G||e.J||cn(e.j,e)}function He(e){Ke(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,le(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function We(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||Ze(n.h,e)))if(!e.K&&Ze(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;an(n),Jt(n)}rn(n),ke(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=Ae(u(n.Za,n),6e3));if(1>=Xe(n.h)&&n.ca){try{n.ca()}catch(e){}n.ca=void 0}}else ln(n,11)}else if((e.K||n.g==e)&&an(n),!p(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.T=u[0],u=u[1],2==n.G)if("c"==u[0]){n.K=u[1],n.ia=u[2];const t=u[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const i=u[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(et(s,s.h),s.h=null))}if(r.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,lt(r.I,r.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var o=e;if((r=n).qa=dn(r,r.J?r.ia:null,r.W),o.K){tt(r.h,o);var a=o,c=r.L;c&&(a.I=c),a.B&&(Ke(a),ze(a)),r.g=o}else nn(r);0<n.i.length&&Xt(n)}else"stop"!=u[0]&&"close"!=u[0]||ln(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?ln(n,7):Qt(n):"noop"!=u[0]&&n.l&&n.l.ta(u),n.v=0)}Ee()}catch(e){}}Le.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==Kt(e)?t.j():this.Y(e)},Le.prototype.Y=function(e){try{if(e==this.g)e:{const d=Kt(this.g);var t=this.g.Ba();if(this.g.Z(),!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||$t(this.g)))){this.J||4!=d||7==t||Ee(),Ke(this);var n=this.g.Z();this.X=n;t:if(Be(this)){var r=$t(this.g);e="";var s=r.length,o=4==Kt(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){He(this),$e(this);var a="";break t}this.h.i=new i.TextDecoder}for(t=0;t<s;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(o&&t==s-1)});r.length=0,this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,function(e,t,n,r,i,s,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.i,this.u,this.A,this.l,this.R,d,n),this.o){if(this.T&&!this.K){t:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!p(c)){var l=c;break t}}l=null}if(!(n=l)){this.o=!1,this.s=3,ke(12),He(this),$e(this);break e}De(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,We(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<a.length;){if(e=je(this,a),e==Ue){4==d&&(this.s=4,ke(14),n=!1),De(this.i,this.l,null,"[Incomplete Response]");break}if(e==Fe){this.s=4,ke(15),De(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}De(this.i,this.l,e,null),We(this,e)}if(Be(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=a.length||this.h.h||(this.s=1,ke(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var h=this.j;h.g==this&&h.ba&&!h.M&&(h.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),sn(h),h.M=!0,ke(11))}}else De(this.i,this.l,a,"[Invalid Chunked Response]"),He(this),$e(this)}else De(this.i,this.l,a,null),We(this,a);4==d&&He(this),this.o&&!this.J&&(4==d?cn(this.j,this):(this.o=!1,ze(this)))}else(function(e){const t={};e=(e.g&&2<=Kt(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(p(e[r]))continue;var n=b(e[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=t[i]||[];t[i]=s,s.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,ke(12)):(this.s=0,ke(13)),He(this),$e(this)}}}catch(e){}},Le.prototype.cancel=function(){this.J=!0,He(this)},Le.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.i,this.A),2!=this.L&&(Ee(),ke(17)),He(this),this.s=2,$e(this)):Ge(this,this.S-e)};var Qe=class{constructor(e,t){this.g=e,this.map=t}};function Je(e){this.l=e||10,e=i.PerformanceNavigationTiming?0<(e=i.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ye(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Xe(e){return e.h?1:e.g?e.g.size:0}function Ze(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function et(e,t){e.g?e.g.add(t):e.h=t}function tt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function nt(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return d(e.i)}function rt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(s(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(s(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(s(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,o=0;o<i;o++)t.call(void 0,r[o],n&&n[o],e)}Je.prototype.cancel=function(){if(this.i=nt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var it=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function st(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof st){this.h=e.h,at(this,e.j),this.o=e.o,this.g=e.g,ct(this,e.s),this.l=e.l;var t=e.i,n=new It;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),ut(this,n),this.m=e.m}else e&&(t=String(e).match(it))?(this.h=!1,at(this,t[1]||"",!0),this.o=dt(t[2]||""),this.g=dt(t[3]||"",!0),ct(this,t[4]),this.l=dt(t[5]||"",!0),ut(this,t[6]||"",!0),this.m=dt(t[7]||"")):(this.h=!1,this.i=new It(null,this.h))}function ot(e){return new st(e)}function at(e,t,n){e.j=n?dt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ct(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function ut(e,t,n){t instanceof It?(e.i=t,function(e,t){t&&!e.j&&(bt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(Tt(this,t),St(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=ft(t,wt)),e.i=new It(t,e.h))}function lt(e,t,n){e.i.set(t,n)}function ht(e){return lt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function dt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ft(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,pt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function pt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}st.prototype.toString=function(){var e=[],t=this.j;t&&e.push(ft(t,gt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(ft(t,gt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(ft(n,"/"==n.charAt(0)?vt:yt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",ft(n,_t)),e.join("")};var mt,gt=/[#\/\?@]/g,yt=/[#\?:]/g,vt=/[#\?]/g,wt=/[#\?@]/g,_t=/#/g;function It(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function bt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function Tt(e,t){bt(e),t=kt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Et(e,t){return bt(e),t=kt(e,t),e.g.has(t)}function St(e,t,n){Tt(e,t),0<n.length&&(e.i=null,e.g.set(kt(e,t),d(n)),e.h+=n.length)}function kt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Ct(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(e){}}function At(){this.g=new fe}function Nt(e,t,n){const r=n||"";try{rt(e,(function(e,n){let i=e;o(e)&&(i=he(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function Dt(e){this.l=e.Ub||null,this.j=e.eb||!1}function Rt(e,t){ne.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function xt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function Pt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Ot(e)}function Ot(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Lt(e){let t="";return v(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Mt(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Lt(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):lt(e,t,n))}function Ft(e){ne.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=It.prototype).add=function(e,t){bt(this),this.i=null,e=kt(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){bt(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},e.na=function(){bt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},e.V=function(e){bt(this);let t=[];if("string"==typeof e)Et(this,e)&&(t=t.concat(this.g.get(kt(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return bt(this),this.i=null,Et(this,e=kt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),o=this.V(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")},h(Dt,pe),Dt.prototype.g=function(){return new Rt(this.l,this.j)},Dt.prototype.i=(mt={},function(){return mt}),h(Rt,ne),(e=Rt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Ot(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||i).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Pt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Ot(this)),this.g&&(this.readyState=3,Ot(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;xt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Pt(this):Ot(this),3==this.readyState&&xt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,Pt(this))},e.Qa=function(e){this.g&&(this.response=e,Pt(this))},e.ga=function(){this.g&&Pt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Rt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),h(Ft,ne);var Ut=/^https?$/i,Vt=["POST","PUT"];function qt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Bt(e),zt(e)}function Bt(e){e.A||(e.A=!0,re(e,"complete"),re(e,"error"))}function jt(e){if(e.h&&void 0!==r&&(!e.v[1]||4!=Kt(e)||2!=e.Z()))if(e.u&&4==Kt(e))se(e.Ea,0,e);else if(re(e,"readystatechange"),4==Kt(e)){e.h=!1;try{const r=e.Z();e:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var s;if(s=0===r){var o=String(e.D).match(it)[1]||null;!o&&i.self&&i.self.location&&(o=i.self.location.protocol.slice(0,-1)),s=!Ut.test(o?o.toLowerCase():"")}n=s}if(n)re(e,"complete"),re(e,"success");else{e.m=6;try{var a=2<Kt(e)?e.g.statusText:""}catch(e){a=""}e.l=a+" ["+e.Z()+"]",Bt(e)}}finally{zt(e)}}}function zt(e,t){if(e.g){Gt(e);const n=e.g,r=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||re(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function Gt(e){e.I&&(i.clearTimeout(e.I),e.I=null)}function Kt(e){return e.g?e.g.readyState:0}function $t(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Ht(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Wt(e){this.Aa=0,this.i=[],this.j=new Ne,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ht("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ht("baseRetryDelayMs",5e3,e),this.cb=Ht("retryDelaySeedMs",1e4,e),this.Wa=Ht("forwardChannelMaxRetries",2,e),this.wa=Ht("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new Je(e&&e.concurrentRequestLimit),this.Da=new At,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Qt(e){if(Yt(e),3==e.G){var t=e.U++,n=ot(e.I);if(lt(n,"SID",e.K),lt(n,"RID",t),lt(n,"TYPE","terminate"),en(e,n),(t=new Le(e,e.j,t)).L=2,t.v=ht(ot(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&i.Image&&((new Image).src=t.v,n=!0),n||(t.g=fn(t.j,null),t.g.ea(t.v)),t.F=Date.now(),ze(t)}hn(e)}function Jt(e){e.g&&(sn(e),e.g.cancel(),e.g=null)}function Yt(e){Jt(e),e.u&&(i.clearTimeout(e.u),e.u=null),an(e),e.h.cancel(),e.s&&("number"==typeof e.s&&i.clearTimeout(e.s),e.s=null)}function Xt(e){if(!Ye(e.h)&&!e.s){e.s=!0;var t=e.Ga;C||D(),A||(C(),A=!0),N.add(t,e),e.B=0}}function Zt(e,t){var n;n=t?t.l:e.U++;const r=ot(e.I);lt(r,"SID",e.K),lt(r,"RID",n),lt(r,"AID",e.T),en(e,r),e.m&&e.o&&Mt(r,e.m,e.o),n=new Le(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=tn(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),et(e.h,n),Ve(n,r,t)}function en(e,t){e.H&&v(e.H,(function(e,n){lt(t,n,e)})),e.l&&rt({},(function(e,n){lt(t,n,e)}))}function tn(e,t,n){n=Math.min(e.i.length,n);var r=e.l?u(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=t,0>n)t=Math.max(0,i[o].g-100),s=!1;else try{Nt(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function nn(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;C||D(),A||(C(),A=!0),N.add(t,e),e.v=0}}function rn(e){return!(e.g||e.u||3<=e.v||(e.Y++,e.u=Ae(u(e.Fa,e),un(e,e.v)),e.v++,0))}function sn(e){null!=e.A&&(i.clearTimeout(e.A),e.A=null)}function on(e){e.g=new Le(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=ot(e.qa);lt(t,"RID","rpc"),lt(t,"SID",e.K),lt(t,"AID",e.T),lt(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&lt(t,"TO",e.ja),lt(t,"TYPE","xmlhttp"),en(e,t),e.m&&e.o&&Mt(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=ht(ot(t)),n.m=null,n.P=!0,qe(n,e)}function an(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function cn(e,t){var n=null;if(e.g==t){an(e),sn(e),e.g=null;var r=2}else{if(!Ze(e.h,t))return;n=t.D,tt(e.h,t),r=1}if(0!=e.G)if(t.o)if(1==r){n=t.m?t.m.length:0,t=Date.now()-t.F;var i=e.B;re(r=be(),new Ce(r,n)),Xt(e)}else nn(e);else if(3==(i=t.s)||0==i&&0<t.X||!(1==r&&function(e,t){return!(Xe(e.h)>=e.h.j-(e.s?1:0)||(e.s?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa)||(e.s=Ae(u(e.Ga,e,t),un(e,e.B)),e.B++,0)))}(e,t)||2==r&&rn(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:ln(e,5);break;case 4:ln(e,10);break;case 3:ln(e,6);break;default:ln(e,2)}}function un(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function ln(e,t){if(e.j.info("Error code "+t),2==t){var n=u(e.fb,e),r=e.Xa;const t=!r;r=new st(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||at(r,"https"),ht(r),t?function(e,t){const n=new Ne;if(i.Image){const r=new Image;r.onload=l(Ct,n,"TestLoadImage: loaded",!0,t,r),r.onerror=l(Ct,n,"TestLoadImage: error",!1,t,r),r.onabort=l(Ct,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=l(Ct,n,"TestLoadImage: timeout",!1,t,r),i.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){new Ne;const n=new AbortController,r=setTimeout((()=>{n.abort(),Ct(0,0,!1,t)}),1e4);fetch(e,{signal:n.signal}).then((e=>{clearTimeout(r),e.ok?Ct(0,0,!0,t):Ct(0,0,!1,t)})).catch((()=>{clearTimeout(r),Ct(0,0,!1,t)}))}(r.toString(),n)}else ke(2);e.G=0,e.l&&e.l.sa(t),hn(e),Yt(e)}function hn(e){if(e.G=0,e.ka=[],e.l){const t=nt(e.h);0==t.length&&0==e.i.length||(f(e.ka,t),f(e.ka,e.i),e.h.i.length=0,d(e.i),e.i.length=0),e.l.ra()}}function dn(e,t,n){var r=n instanceof st?ot(n):new st(n);if(""!=r.g)t&&(r.g=t+"."+r.g),ct(r,r.s);else{var s=i.location;r=s.protocol,t=t?t+"."+s.hostname:s.hostname,s=+s.port;var o=new st(null);r&&at(o,r),t&&(o.g=t),s&&ct(o,s),n&&(o.l=n),r=o}return n=e.D,t=e.ya,n&&t&&lt(r,n,t),lt(r,"VER",e.la),en(e,r),r}function fn(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Ft(new Dt({eb:n})):new Ft(e.pa)).Ha(e.J),t}function pn(){}function mn(){}function gn(e,t){ne.call(this),this.g=new Wt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!p(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!p(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new wn(this)}function yn(e){ve.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function vn(){we.call(this),this.status=1}function wn(e){this.g=e}(e=Ft.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Re.g(),this.v=this.o?me(this.o):me(Re),this.g.onreadystatechange=u(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(e){return void qt(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),s=i.FormData&&e instanceof i.FormData,!(0<=Array.prototype.indexOf.call(Vt,t,void 0))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Gt(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){qt(this,e)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,re(this,"complete"),re(this,"abort"),zt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),zt(this,!0)),Ft.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?jt(this):this.bb())},e.bb=function(){jt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<Kt(this)?this.g.status:-1}catch(e){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),de(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=Wt.prototype).la=8,e.G=1,e.connect=function(e,t,n,r){ke(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=dn(this,null,this.W),Xt(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const i=new Le(this,this.j,e);let s=this.o;if(this.S&&(s?(s=w(s),I(s,this.S)):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tn(this,i,t),lt(n=ot(this.I),"RID",e),lt(n,"CVER",22),this.D&&lt(n,"X-HTTP-Session-Id",this.D),en(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(Lt(s)))+"&"+t:this.m&&Mt(n,this.m,s)),et(this.h,i),this.Ua&&lt(n,"TYPE","init"),this.P?(lt(n,"$req",t),lt(n,"SID","null"),i.T=!0,Ve(i,n,null)):Ve(i,n,t),this.G=2}}else 3==this.G&&(e?Zt(this,e):0==this.i.length||Ye(this.h)||Zt(this))},e.Fa=function(){if(this.u=null,on(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Ae(u(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ke(10),Jt(this),on(this))},e.Za=function(){null!=this.C&&(this.C=null,Jt(this),rn(this),ke(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),ke(2)):(this.j.info("Failed to ping google.com"),ke(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=pn.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},mn.prototype.g=function(e,t){return new gn(e,t)},h(gn,ne),gn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},gn.prototype.close=function(){Qt(this.g)},gn.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=he(e),e=n);t.i.push(new Qe(t.Ya++,e)),3==t.G&&Xt(t)},gn.prototype.N=function(){this.g.l=null,delete this.j,Qt(this.g),delete this.g,gn.aa.N.call(this)},h(yn,ve),h(vn,we),h(wn,pn),wn.prototype.ua=function(){re(this.g,"a")},wn.prototype.ta=function(e){re(this.g,new yn(e))},wn.prototype.sa=function(e){re(this.g,new vn)},wn.prototype.ra=function(){re(this.g,"b")},mn.prototype.createWebChannel=mn.prototype.g,gn.prototype.send=gn.prototype.o,gn.prototype.open=gn.prototype.m,gn.prototype.close=gn.prototype.close,Io=To.createWebChannelTransport=function(){return new mn},_o=To.getStatEventTarget=function(){return be()},wo=To.Event=_e,vo=To.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},xe.NO_ERROR=0,xe.TIMEOUT=8,xe.HTTP_ERROR=6,yo=To.ErrorCode=xe,Pe.COMPLETE="complete",go=To.EventType=Pe,ge.EventType=ye,ye.OPEN="a",ye.CLOSE="b",ye.ERROR="c",ye.MESSAGE="d",ne.prototype.listen=ne.prototype.K,mo=To.WebChannel=ge,po=To.FetchXmlHttpFactory=Dt,Ft.prototype.listenOnce=Ft.prototype.L,Ft.prototype.getLastError=Ft.prototype.Ka,Ft.prototype.getLastErrorCode=Ft.prototype.Ba,Ft.prototype.getStatus=Ft.prototype.Z,Ft.prototype.getResponseJson=Ft.prototype.Oa,Ft.prototype.getResponseText=Ft.prototype.oa,Ft.prototype.send=Ft.prototype.ea,Ft.prototype.setWithCredentials=Ft.prototype.Ha,fo=To.XhrIo=Ft}).apply(void 0!==bo?bo:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const Eo="@firebase/firestore";class So{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}So.UNAUTHENTICATED=new So(null),So.GOOGLE_CREDENTIALS=new So("google-credentials-uid"),So.FIRST_PARTY=new So("first-party-uid"),So.MOCK_USER=new So("mock-user");let ko="10.12.3";const Co=new K("@firebase/firestore");function Ao(){return Co.logLevel}function No(e,...t){if(Co.logLevel<=q.DEBUG){const n=t.map(xo);Co.debug(`Firestore (${ko}): ${e}`,...n)}}function Do(e,...t){if(Co.logLevel<=q.ERROR){const n=t.map(xo);Co.error(`Firestore (${ko}): ${e}`,...n)}}function Ro(e,...t){if(Co.logLevel<=q.WARN){const n=t.map(xo);Co.warn(`Firestore (${ko}): ${e}`,...n)}}function xo(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function Po(e="Unexpected state"){const t=`FIRESTORE (${ko}) INTERNAL ASSERTION FAILED: `+e;throw Do(t),new Error(t)}function Oo(e,t){e||Po()}function Lo(e,t){return e}const Mo={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Fo extends b{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Uo{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Vo{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class qo{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(So.UNAUTHENTICATED)))}shutdown(){}}class Bo{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class jo{constructor(e){this.t=e,this.currentUser=So.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new Uo;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Uo,e.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{No("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(No("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Uo)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(No("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Oo("string"==typeof t.accessToken),new Vo(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Oo(null===e||"string"==typeof e),new So(e)}}class zo{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=So.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Go{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new zo(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(So.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Ko{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class $o{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=e=>{null!=e.error&&No("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.R;return this.R=e.token,No("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{No("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.A.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?r(e):No("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(Oo("string"==typeof e.token),this.R=e.token,new Ko(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Ho(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class Wo{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=Ho(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function Qo(e,t){return e<t?-1:e>t?1:0}function Jo(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}function Yo(e){return e+"\0"}class Xo{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Fo(Mo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Fo(Mo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Fo(Mo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Fo(Mo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Xo.fromMillis(Date.now())}static fromDate(e){return Xo.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Xo(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Qo(this.nanoseconds,e.nanoseconds):Qo(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Zo{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Zo(e)}static min(){return new Zo(new Xo(0,0))}static max(){return new Zo(new Xo(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ea{constructor(e,t,n){void 0===t?t=0:t>e.length&&Po(),void 0===n?n=e.length-t:n>e.length-t&&Po(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ea.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ea?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ta extends ea{construct(e,t,n){return new ta(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Fo(Mo.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new ta(t)}static emptyPath(){return new ta([])}}const na=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ra extends ea{construct(e,t,n){return new ra(e,t,n)}static isValidIdentifier(e){return na.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ra.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ra(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Fo(Mo.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new Fo(Mo.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Fo(Mo.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new Fo(Mo.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ra(t)}static emptyPath(){return new ra([])}}class ia{constructor(e){this.path=e}static fromPath(e){return new ia(ta.fromString(e))}static fromName(e){return new ia(ta.fromString(e).popFirst(5))}static empty(){return new ia(ta.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ta.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ta.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ia(new ta(e.slice()))}}class sa{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function oa(e){return e.fields.find((e=>2===e.kind))}function aa(e){return e.fields.filter((e=>2!==e.kind))}sa.UNKNOWN_ID=-1;class ca{constructor(e,t){this.fieldPath=e,this.kind=t}}class ua{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new ua(0,da.min())}}function la(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=Zo.fromTimestamp(1e9===r?new Xo(n+1,0):new Xo(n,r));return new da(i,ia.empty(),t)}function ha(e){return new da(e.readTime,e.key,-1)}class da{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new da(Zo.min(),ia.empty(),-1)}static max(){return new da(Zo.max(),ia.empty(),-1)}}function fa(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=ia.comparator(e.documentKey,t.documentKey),0!==n?n:Qo(e.largestBatchId,t.largestBatchId))}const pa="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ma{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function ga(e){if(e.code!==Mo.FAILED_PRECONDITION||e.message!==pa)throw e;No("LocalStore","Unexpectedly lost primary lease")}class ya{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Po(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ya(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof ya?t:ya.resolve(t)}catch(e){return ya.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):ya.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):ya.reject(t)}static resolve(e){return new ya(((t,n)=>{t(e)}))}static reject(e){return new ya(((t,n)=>{n(e)}))}static waitFor(e){return new ya(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=ya.resolve(!1);for(const n of e)t=t.next((e=>e?ya.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new ya(((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;t(e[c]).next((e=>{s[c]=e,++o,o===i&&n(s)}),(e=>r(e)))}}))}static doWhile(e,t){return new ya(((n,r)=>{const i=()=>{!0===e()?t().next((()=>{i()}),r):n()};i()}))}}class va{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Uo,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new ba(e,t.error)):this.V.resolve()},this.transaction.onerror=t=>{const n=Ca(t.target.error);this.V.reject(new ba(e,n))}}static open(e,t,n,r){try{return new va(t,e.transaction(r,n))}catch(e){throw new ba(t,e)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(No("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Ea(t)}}class wa{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===wa.S(f())&&Do("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return No("SimpleDb","Removing database:",e),Sa(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!I())return!1;if(wa.C())return!0;const e=f(),t=wa.S(e),n=0<t&&t<10,r=_a(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static C(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.v)}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}async M(e){return this.db||(No("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new ba(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new Fo(Mo.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new Fo(Mo.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new ba(e,r))},r.onupgradeneeded=e=>{No("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.p.O(t,r.transaction,e.oldVersion,this.version).next((()=>{No("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.N&&(this.db.onversionchange=e=>this.N(e)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.M(e);const t=va.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next((e=>(t.g(),e))).catch((e=>(t.abort(e),ya.reject(e)))).toPromise();return s.catch((()=>{})),await t.m,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(No("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function _a(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}class Ia{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Sa(this.B.delete())}}class ba extends Fo{constructor(e,t){super(Mo.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Ta(e){return"IndexedDbTransactionError"===e.name}class Ea{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(No("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(No("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Sa(n)}add(e){return No("SimpleDb","ADD",this.store.name,e,e),Sa(this.store.add(e))}get(e){return Sa(this.store.get(e)).next((t=>(void 0===t&&(t=null),No("SimpleDb","GET",this.store.name,e,t),t)))}delete(e){return No("SimpleDb","DELETE",this.store.name,e),Sa(this.store.delete(e))}count(){return No("SimpleDb","COUNT",this.store.name),Sa(this.store.count())}U(e,t){const n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const e=r.getAll(n.range);return new ya(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}{const e=this.cursor(n),t=[];return this.W(e,((e,n)=>{t.push(n)})).next((()=>t))}}G(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new ya(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}j(e,t){No("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.H=!1;const r=this.cursor(n);return this.W(r,((e,t,n)=>n.delete()))}J(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.W(r,t)}Y(e){const t=this.cursor({});return new ya(((n,r)=>{t.onerror=e=>{const t=Ca(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}W(e,t){const n=[];return new ya(((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new Ia(i),o=t(i.primaryKey,i.value,s);if(o instanceof ya){const e=o.catch((e=>(s.done(),ya.reject(e))));n.push(e)}s.isDone?r():null===s.K?i.continue():i.continue(s.K)}})).next((()=>ya.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Sa(e){return new ya(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=Ca(e.target.error);n(t)}}))}let ka=!1;function Ca(e){const t=wa.S(f());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new Fo("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ka||(ka=!0,setTimeout((()=>{throw e}),0)),e}}return e}class Aa{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}X(e){No("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{No("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(e){Ta(e)?No("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e):await ga(e)}await this.X(6e4)}))}}class Na{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.te(t,e)))}te(e,t){const n=new Set;let r=t,i=!0;return ya.doWhile((()=>!0===i&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((t=>{if(null!==t&&!n.has(t))return No("IndexBackfiller",`Processing collection: ${t}`),this.ne(e,t,r).next((e=>{r-=e,n.add(t)}));i=!1})))).next((()=>t-r))}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next((n=>{const i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next((()=>this.re(r,n))).next((n=>(No("IndexBackfiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n)))).next((()=>i.size))}))))}re(e,t){let n=e;return t.changes.forEach(((e,t)=>{const r=ha(t);fa(r,n)>0&&(n=r)})),new da(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class Da{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ie(e),this.se=e=>t.writeSequenceNumber(e))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}function Ra(e){return null==e}function xa(e){return 0===e&&1/e==-1/0}function Pa(e){return"number"==typeof e&&Number.isInteger(e)&&!xa(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function Oa(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=Ma(t)),t=La(e.get(n),t);return Ma(t)}function La(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function Ma(e){return e+""}function Fa(e){const t=e.length;if(Oo(t>=2),2===t)return Oo(""===e.charAt(0)&&""===e.charAt(1)),ta.emptyPath();const n=t-2,r=[];let i="";for(let s=0;s<t;){const t=e.indexOf("",s);switch((t<0||t>n)&&Po(),e.charAt(t+1)){case"":const n=e.substring(s,t);let o;0===i.length?o=n:(i+=n,o=i,i=""),r.push(o);break;case"":i+=e.substring(s,t),i+="\0";break;case"":i+=e.substring(s,t+1);break;default:Po()}s=t+2}return new ta(r)}Da.oe=-1;const Ua=["userId","batchId"];function Va(e,t){return[e,Oa(t)]}function qa(e,t,n){return[e,Oa(t),n]}const Ba={},ja=["prefixPath","collectionGroup","readTime","documentId"],za=["prefixPath","collectionGroup","documentId"],Ga=["collectionGroup","readTime","prefixPath","documentId"],Ka=["canonicalId","targetId"],$a=["targetId","path"],Ha=["path","targetId"],Wa=["collectionId","parent"],Qa=["indexId","uid"],Ja=["uid","sequenceNumber"],Ya=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Xa=["indexId","uid","orderedDocumentKey"],Za=["userId","collectionPath","documentId"],ec=["userId","collectionPath","largestBatchId"],tc=["userId","collectionGroup","largestBatchId"],nc=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],rc=[...nc,"documentOverlays"],ic=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],sc=ic,oc=[...sc,"indexConfiguration","indexState","indexEntries"],ac=oc;class cc extends ma{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function uc(e,t){const n=Lo(e);return wa.F(n._e,t)}function lc(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function hc(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function dc(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class fc{constructor(e,t){this.comparator=e,this.root=t||mc.EMPTY}insert(e,t){return new fc(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,mc.BLACK,null,null))}remove(e){return new fc(this.comparator,this.root.remove(e,this.comparator).copy(null,null,mc.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new pc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new pc(this.root,e,this.comparator,!1)}getReverseIterator(){return new pc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new pc(this.root,e,this.comparator,!0)}}class pc{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class mc{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:mc.RED,this.left=null!=r?r:mc.EMPTY,this.right=null!=i?i:mc.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new mc(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return mc.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return mc.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,mc.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,mc.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Po();if(this.right.isRed())throw Po();const e=this.left.check();if(e!==this.right.check())throw Po();return e+(this.isRed()?0:1)}}mc.EMPTY=null,mc.RED=!0,mc.BLACK=!1,mc.EMPTY=new class{constructor(){this.size=0}get key(){throw Po()}get value(){throw Po()}get color(){throw Po()}get left(){throw Po()}get right(){throw Po()}copy(e,t,n,r,i){return this}insert(e,t,n){return new mc(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class gc{constructor(e){this.comparator=e,this.data=new fc(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new yc(this.data.getIterator())}getIteratorFrom(e){return new yc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof gc))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new gc(this.comparator);return t.data=e,t}}class yc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function vc(e){return e.hasNext()?e.getNext():void 0}class wc{constructor(e){this.fields=e,e.sort(ra.comparator)}static empty(){return new wc([])}unionWith(e){let t=new gc(ra.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new wc(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Jo(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class _c extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ic{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new _c("Invalid base64 string: "+e):e}}(e);return new Ic(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Ic(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Qo(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ic.EMPTY_BYTE_STRING=new Ic("");const bc=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Tc(e){if(Oo(!!e),"string"==typeof e){let t=0;const n=bc.exec(e);if(Oo(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Ec(e.seconds),nanos:Ec(e.nanos)}}function Ec(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Sc(e){return"string"==typeof e?Ic.fromBase64String(e):Ic.fromUint8Array(e)}function kc(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Cc(e){const t=e.mapValue.fields.__previous_value__;return kc(t)?Cc(t):t}function Ac(e){const t=Tc(e.mapValue.fields.__local_write_time__.timestampValue);return new Xo(t.seconds,t.nanos)}class Nc{constructor(e,t,n,r,i,s,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class Dc{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Dc("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Dc&&e.projectId===this.projectId&&e.database===this.database}}const Rc={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},xc={nullValue:"NULL_VALUE"};function Pc(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?kc(e)?4:Hc(e)?9007199254740991:10:Po()}function Oc(e,t){if(e===t)return!0;const n=Pc(e);if(n!==Pc(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Ac(e).isEqual(Ac(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Tc(e.timestampValue),r=Tc(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Sc(e.bytesValue).isEqual(Sc(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Ec(e.geoPointValue.latitude)===Ec(t.geoPointValue.latitude)&&Ec(e.geoPointValue.longitude)===Ec(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Ec(e.integerValue)===Ec(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Ec(e.doubleValue),r=Ec(t.doubleValue);return n===r?xa(n)===xa(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return Jo(e.arrayValue.values||[],t.arrayValue.values||[],Oc);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(lc(n)!==lc(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!Oc(n[e],r[e])))return!1;return!0}(e,t);default:return Po()}}function Lc(e,t){return void 0!==(e.values||[]).find((e=>Oc(e,t)))}function Mc(e,t){if(e===t)return 0;const n=Pc(e),r=Pc(t);if(n!==r)return Qo(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Qo(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Ec(e.integerValue||e.doubleValue),r=Ec(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Fc(e.timestampValue,t.timestampValue);case 4:return Fc(Ac(e),Ac(t));case 5:return Qo(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Sc(e),r=Sc(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=Qo(n[e],r[e]);if(0!==t)return t}return Qo(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Qo(Ec(e.latitude),Ec(t.latitude));return 0!==n?n:Qo(Ec(e.longitude),Ec(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=Mc(n[e],r[e]);if(t)return t}return Qo(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===Rc.mapValue&&t===Rc.mapValue)return 0;if(e===Rc.mapValue)return 1;if(t===Rc.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=Qo(r[e],s[e]);if(0!==t)return t;const o=Mc(n[r[e]],i[s[e]]);if(0!==o)return o}return Qo(r.length,s.length)}(e.mapValue,t.mapValue);default:throw Po()}}function Fc(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Qo(e,t);const n=Tc(e),r=Tc(t),i=Qo(n.seconds,r.seconds);return 0!==i?i:Qo(n.nanos,r.nanos)}function Uc(e){return Vc(e)}function Vc(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Tc(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return Sc(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return ia.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=Vc(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${Vc(e.fields[i])}`;return n+"}"}(e.mapValue):Po()}function qc(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Bc(e){return!!e&&"integerValue"in e}function jc(e){return!!e&&"arrayValue"in e}function zc(e){return!!e&&"nullValue"in e}function Gc(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Kc(e){return!!e&&"mapValue"in e}function $c(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return hc(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=$c(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=$c(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Hc(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function Wc(e){return"nullValue"in e?xc:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?qc(Dc.empty(),ia.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?{mapValue:{}}:Po()}function Qc(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?qc(Dc.empty(),ia.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?{mapValue:{}}:"mapValue"in e?Rc:Po()}function Jc(e,t){const n=Mc(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Yc(e,t){const n=Mc(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class Xc{constructor(e){this.value=e}static empty(){return new Xc({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Kc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=$c(t)}setAll(e){let t=ra.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=$c(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Kc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Oc(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Kc(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){hc(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new Xc($c(this.value))}}function Zc(e){const t=[];return hc(e.fields,((e,n)=>{const r=new ra([e]);if(Kc(n)){const e=Zc(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new wc(t)}class eu{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new eu(e,0,Zo.min(),Zo.min(),Zo.min(),Xc.empty(),0)}static newFoundDocument(e,t,n,r){return new eu(e,1,t,Zo.min(),n,r,0)}static newNoDocument(e,t){return new eu(e,2,t,Zo.min(),Zo.min(),Xc.empty(),0)}static newUnknownDocument(e,t){return new eu(e,3,t,Zo.min(),Zo.min(),Xc.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Zo.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Xc.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Xc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Zo.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof eu&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new eu(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class tu{constructor(e,t){this.position=e,this.inclusive=t}}function nu(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?ia.comparator(ia.fromName(o.referenceValue),n.key):Mc(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function ru(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Oc(e.position[n],t.position[n]))return!1;return!0}class iu{constructor(e,t="asc"){this.field=e,this.dir=t}}function su(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class ou{}class au extends ou{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new yu(e,t,n):"array-contains"===t?new Iu(e,n):"in"===t?new bu(e,n):"not-in"===t?new Tu(e,n):"array-contains-any"===t?new Eu(e,n):new au(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new vu(e,n):new wu(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Mc(t,this.value)):null!==t&&Pc(this.value)===Pc(t)&&this.matchesComparison(Mc(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Po()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class cu extends ou{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new cu(e,t)}matches(e){return uu(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function uu(e){return"and"===e.op}function lu(e){return"or"===e.op}function hu(e){return du(e)&&uu(e)}function du(e){for(const t of e.filters)if(t instanceof cu)return!1;return!0}function fu(e){if(e instanceof au)return e.field.canonicalString()+e.op.toString()+Uc(e.value);if(hu(e))return e.filters.map((e=>fu(e))).join(",");{const t=e.filters.map((e=>fu(e))).join(",");return`${e.op}(${t})`}}function pu(e,t){return e instanceof au?function(e,t){return t instanceof au&&e.op===t.op&&e.field.isEqual(t.field)&&Oc(e.value,t.value)}(e,t):e instanceof cu?function(e,t){return t instanceof cu&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&pu(n,t.filters[r])),!0)}(e,t):void Po()}function mu(e,t){const n=e.filters.concat(t);return cu.create(n,e.op)}function gu(e){return e instanceof au?function(e){return`${e.field.canonicalString()} ${e.op} ${Uc(e.value)}`}(e):e instanceof cu?function(e){return e.op.toString()+" {"+e.getFilters().map(gu).join(" ,")+"}"}(e):"Filter"}class yu extends au{constructor(e,t,n){super(e,t,n),this.key=ia.fromName(n.referenceValue)}matches(e){const t=ia.comparator(e.key,this.key);return this.matchesComparison(t)}}class vu extends au{constructor(e,t){super(e,"in",t),this.keys=_u(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class wu extends au{constructor(e,t){super(e,"not-in",t),this.keys=_u(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function _u(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>ia.fromName(e.referenceValue)))}class Iu extends au{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return jc(t)&&Lc(t.arrayValue,this.value)}}class bu extends au{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Lc(this.value.arrayValue,t)}}class Tu extends au{constructor(e,t){super(e,"not-in",t)}matches(e){if(Lc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Lc(this.value.arrayValue,t)}}class Eu extends au{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!jc(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Lc(this.value.arrayValue,e)))}}class Su{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.ue=null}}function ku(e,t=null,n=[],r=[],i=null,s=null,o=null){return new Su(e,t,n,r,i,s,o)}function Cu(e){const t=Lo(e);if(null===t.ue){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>fu(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),Ra(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>Uc(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>Uc(e))).join(",")),t.ue=e}return t.ue}function Au(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!su(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!pu(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!ru(e.startAt,t.startAt)&&ru(e.endAt,t.endAt)}function Nu(e){return ia.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function Du(e,t){return e.filters.filter((e=>e instanceof au&&e.field.isEqual(t)))}function Ru(e,t,n){let r=xc,i=!0;for(const n of Du(e,t)){let e=xc,t=!0;switch(n.op){case"<":case"<=":e=Wc(n.value);break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=xc}Jc({value:r,inclusive:i},{value:e,inclusive:t})<0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];Jc({value:r,inclusive:i},{value:e,inclusive:n.inclusive})<0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}function xu(e,t,n){let r=Rc,i=!0;for(const n of Du(e,t)){let e=Rc,t=!0;switch(n.op){case">=":case">":e=Qc(n.value),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=Rc}Yc({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];Yc({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}class Pu{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Ou(e,t,n,r,i,s,o,a){return new Pu(e,t,n,r,i,s,o,a)}function Lu(e){return new Pu(e)}function Mu(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Fu(e){return null!==e.collectionGroup}function Uu(e){const t=Lo(e);if(null===t.ce){t.ce=[];const e=new Set;for(const n of t.explicitOrderBy)t.ce.push(n),e.add(n.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new gc(ra.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t}(t);r.forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.ce.push(new iu(r,n))})),e.has(ra.keyField().canonicalString())||t.ce.push(new iu(ra.keyField(),n))}return t.ce}function Vu(e){const t=Lo(e);return t.le||(t.le=function(e,t){if("F"===e.limitType)return ku(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new iu(e.field,t)}));const n=e.endAt?new tu(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new tu(e.startAt.position,e.startAt.inclusive):null;return ku(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(t,Uu(e))),t.le}function qu(e,t){const n=e.filters.concat([t]);return new Pu(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Bu(e,t,n){return new Pu(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function ju(e,t){return Au(Vu(e),Vu(t))&&e.limitType===t.limitType}function zu(e){return`${Cu(Vu(e))}|lt:${e.limitType}`}function Gu(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>gu(e))).join(", ")}]`),Ra(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>Uc(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>Uc(e))).join(",")),`Target(${t})`}(Vu(e))}; limitType=${e.limitType})`}function Ku(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):ia.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Uu(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=nu(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Uu(e),t)||e.endAt&&!function(e,t,n){const r=nu(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Uu(e),t))}(e,t)}function $u(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Hu(e){return(t,n)=>{let r=!1;for(const i of Uu(e)){const e=Wu(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function Wu(e,t,n){const r=e.field.isKeyField()?ia.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Mc(r,i):Po()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Po()}}class Qu{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){hc(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return dc(this.inner)}size(){return this.innerSize}}const Ju=new fc(ia.comparator);function Yu(){return Ju}const Xu=new fc(ia.comparator);function Zu(...e){let t=Xu;for(const n of e)t=t.insert(n.key,n);return t}function el(e){let t=Xu;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function tl(){return rl()}function nl(){return rl()}function rl(){return new Qu((e=>e.toString()),((e,t)=>e.isEqual(t)))}const il=new fc(ia.comparator),sl=new gc(ia.comparator);function ol(...e){let t=sl;for(const n of e)t=t.add(n);return t}const al=new gc(Qo);function cl(){return al}function ul(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:xa(t)?"-0":t}}function ll(e){return{integerValue:""+e}}function hl(e,t){return Pa(t)?ll(t):ul(e,t)}class dl{constructor(){this._=void 0}}function fl(e,t,n){return e instanceof gl?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&kc(t)&&(t=Cc(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof yl?vl(e,t):e instanceof wl?_l(e,t):function(e,t){const n=ml(e,t),r=bl(n)+bl(e.Pe);return Bc(n)&&Bc(e.Pe)?ll(r):ul(e.serializer,r)}(e,t)}function pl(e,t,n){return e instanceof yl?vl(e,t):e instanceof wl?_l(e,t):n}function ml(e,t){return e instanceof Il?function(e){return Bc(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class gl extends dl{}class yl extends dl{constructor(e){super(),this.elements=e}}function vl(e,t){const n=Tl(t);for(const t of e.elements)n.some((e=>Oc(e,t)))||n.push(t);return{arrayValue:{values:n}}}class wl extends dl{constructor(e){super(),this.elements=e}}function _l(e,t){let n=Tl(t);for(const t of e.elements)n=n.filter((e=>!Oc(e,t)));return{arrayValue:{values:n}}}class Il extends dl{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function bl(e){return Ec(e.integerValue||e.doubleValue)}function Tl(e){return jc(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class El{constructor(e,t){this.field=e,this.transform=t}}class Sl{constructor(e,t){this.version=e,this.transformResults=t}}class kl{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new kl}static exists(e){return new kl(void 0,e)}static updateTime(e){return new kl(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Cl(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Al{}function Nl(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Vl(e.key,kl.none()):new Ol(e.key,e.data,kl.none());{const n=e.data,r=Xc.empty();let i=new gc(ra.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new Ll(e.key,r,new wc(i.toArray()),kl.none())}}function Dl(e,t,n){e instanceof Ol?function(e,t,n){const r=e.value.clone(),i=Fl(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Ll?function(e,t,n){if(!Cl(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Fl(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Ml(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Rl(e,t,n,r){return e instanceof Ol?function(e,t,n,r){if(!Cl(e.precondition,t))return n;const i=e.value.clone(),s=Ul(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Ll?function(e,t,n,r){if(!Cl(e.precondition,t))return n;const i=Ul(e.fieldTransforms,r,t),s=t.data;return s.setAll(Ml(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return Cl(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function xl(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=ml(r.transform,e||null);null!=i&&(null===n&&(n=Xc.empty()),n.set(r.field,i))}return n||null}function Pl(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Jo(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof yl&&t instanceof yl||e instanceof wl&&t instanceof wl?Jo(e.elements,t.elements,Oc):e instanceof Il&&t instanceof Il?Oc(e.Pe,t.Pe):e instanceof gl&&t instanceof gl}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Ol extends Al{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Ll extends Al{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Ml(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function Fl(e,t,n){const r=new Map;Oo(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,pl(o,a,n[i]))}return r}function Ul(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,fl(e,s,t))}return r}class Vl extends Al{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ql extends Al{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Bl{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&Dl(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Rl(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Rl(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=nl();return this.mutations.forEach((r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const a=Nl(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(Zo.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),ol())}isEqual(e){return this.batchId===e.batchId&&Jo(this.mutations,e.mutations,((e,t)=>Pl(e,t)))&&Jo(this.baseMutations,e.baseMutations,((e,t)=>Pl(e,t)))}}class jl{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Oo(e.mutations.length===n.length);let r=il;const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new jl(e,t,n,r)}}class zl{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Gl{constructor(e,t){this.count=e,this.unchangedNames=t}}var Kl,$l;function Hl(e){switch(e){default:return Po();case Mo.CANCELLED:case Mo.UNKNOWN:case Mo.DEADLINE_EXCEEDED:case Mo.RESOURCE_EXHAUSTED:case Mo.INTERNAL:case Mo.UNAVAILABLE:case Mo.UNAUTHENTICATED:return!1;case Mo.INVALID_ARGUMENT:case Mo.NOT_FOUND:case Mo.ALREADY_EXISTS:case Mo.PERMISSION_DENIED:case Mo.FAILED_PRECONDITION:case Mo.ABORTED:case Mo.OUT_OF_RANGE:case Mo.UNIMPLEMENTED:case Mo.DATA_LOSS:return!0}}function Wl(e){if(void 0===e)return Do("GRPC error has no .code"),Mo.UNKNOWN;switch(e){case Kl.OK:return Mo.OK;case Kl.CANCELLED:return Mo.CANCELLED;case Kl.UNKNOWN:return Mo.UNKNOWN;case Kl.DEADLINE_EXCEEDED:return Mo.DEADLINE_EXCEEDED;case Kl.RESOURCE_EXHAUSTED:return Mo.RESOURCE_EXHAUSTED;case Kl.INTERNAL:return Mo.INTERNAL;case Kl.UNAVAILABLE:return Mo.UNAVAILABLE;case Kl.UNAUTHENTICATED:return Mo.UNAUTHENTICATED;case Kl.INVALID_ARGUMENT:return Mo.INVALID_ARGUMENT;case Kl.NOT_FOUND:return Mo.NOT_FOUND;case Kl.ALREADY_EXISTS:return Mo.ALREADY_EXISTS;case Kl.PERMISSION_DENIED:return Mo.PERMISSION_DENIED;case Kl.FAILED_PRECONDITION:return Mo.FAILED_PRECONDITION;case Kl.ABORTED:return Mo.ABORTED;case Kl.OUT_OF_RANGE:return Mo.OUT_OF_RANGE;case Kl.UNIMPLEMENTED:return Mo.UNIMPLEMENTED;case Kl.DATA_LOSS:return Mo.DATA_LOSS;default:return Po()}}($l=Kl||(Kl={}))[$l.OK=0]="OK",$l[$l.CANCELLED=1]="CANCELLED",$l[$l.UNKNOWN=2]="UNKNOWN",$l[$l.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",$l[$l.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",$l[$l.NOT_FOUND=5]="NOT_FOUND",$l[$l.ALREADY_EXISTS=6]="ALREADY_EXISTS",$l[$l.PERMISSION_DENIED=7]="PERMISSION_DENIED",$l[$l.UNAUTHENTICATED=16]="UNAUTHENTICATED",$l[$l.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",$l[$l.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",$l[$l.ABORTED=10]="ABORTED",$l[$l.OUT_OF_RANGE=11]="OUT_OF_RANGE",$l[$l.UNIMPLEMENTED=12]="UNIMPLEMENTED",$l[$l.INTERNAL=13]="INTERNAL",$l[$l.UNAVAILABLE=14]="UNAVAILABLE",$l[$l.DATA_LOSS=15]="DATA_LOSS";function Ql(){return new TextEncoder}const Jl=new co([4294967295,4294967295],0);function Yl(e){const t=Ql().encode(e),n=new uo;return n.update(t),new Uint8Array(n.digest())}function Xl(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new co([n,r],0),new co([i,s],0)]}class Zl{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new eh(`Invalid padding: ${t}`);if(n<0)throw new eh(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new eh(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new eh(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=co.fromNumber(this.Ie)}Ee(e,t,n){let r=e.add(t.multiply(co.fromNumber(n)));return 1===r.compare(Jl)&&(r=new co([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Te).toNumber()}de(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=Yl(e),[n,r]=Xl(t);for(let e=0;e<this.hashCount;e++){const t=this.Ee(n,r,e);if(!this.de(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new Zl(i,r,t);return n.forEach((e=>s.insert(e))),s}insert(e){if(0===this.Ie)return;const t=Yl(e),[n,r]=Xl(t);for(let e=0;e<this.hashCount;e++){const t=this.Ee(n,r,e);this.Ae(t)}}Ae(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class eh extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class th{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,nh.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new th(Zo.min(),r,new fc(Qo),Yu(),ol())}}class nh{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new nh(n,t,ol(),ol(),ol())}}class rh{constructor(e,t,n,r){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=r}}class ih{constructor(e,t){this.targetId=e,this.me=t}}class sh{constructor(e,t,n=Ic.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class oh{constructor(){this.fe=0,this.ge=uh(),this.pe=Ic.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=ol(),t=ol(),n=ol();return this.ge.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Po()}})),new nh(this.pe,this.ye,e,t,n)}ve(){this.we=!1,this.ge=uh()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Oo(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class ah{constructor(e){this.Le=e,this.Be=new Map,this.ke=Yu(),this.qe=ch(),this.Qe=new fc(Qo)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,(t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.ve(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:Po()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach(((e,n)=>{this.ze(n)&&t(n)}))}He(e){const t=e.targetId,n=e.me.count,r=this.Je(t);if(r){const i=r.target;if(Nu(i))if(0===n){const e=new ia(i.path);this.Ue(t,e,eu.newNoDocument(e,Zo.min()))}else Oo(1===n);else{const r=this.Ye(t);if(r!==n){const n=this.Ze(e),i=n?this.Xe(n,e,r):1;if(0!==i){this.je(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,e)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let s,o;try{s=Sc(n).toUint8Array()}catch(e){if(e instanceof _c)return Ro("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new Zl(s,r,i)}catch(e){return Ro(e instanceof eh?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.Ie?null:o}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let r=0;return n.forEach((n=>{const i=this.Le.tt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.Ue(t,n,null),r++)})),r}rt(e){const t=new Map;this.Be.forEach(((n,r)=>{const i=this.Je(r);if(i){if(n.current&&Nu(i.target)){const t=new ia(i.target.path);null!==this.ke.get(t)||this.it(r,t)||this.Ue(r,t,eu.newNoDocument(t,e))}n.be&&(t.set(r,n.Ce()),n.ve())}}));let n=ol();this.qe.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.Je(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.ke.forEach(((t,n)=>n.setReadTime(e)));const r=new th(e,t,this.Qe,this.ke,n);return this.ke=Yu(),this.qe=ch(),this.Qe=new fc(Qo),r}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const r=this.Ge(e);this.it(e,t)?r.Fe(t,1):r.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new oh,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new gc(Qo),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||No("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new oh),this.Le.getRemoteKeysForTarget(e).forEach((t=>{this.Ue(e,t,null)}))}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function ch(){return new fc(ia.comparator)}function uh(){return new fc(ia.comparator)}const lh={asc:"ASCENDING",desc:"DESCENDING"},hh={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},dh={and:"AND",or:"OR"};class fh{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ph(e,t){return e.useProto3Json||Ra(t)?t:{value:t}}function mh(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function gh(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function yh(e,t){return mh(e,t.toTimestamp())}function vh(e){return Oo(!!e),Zo.fromTimestamp(function(e){const t=Tc(e);return new Xo(t.seconds,t.nanos)}(e))}function wh(e,t){return _h(e,t).canonicalString()}function _h(e,t){const n=function(e){return new ta(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function Ih(e){const t=ta.fromString(e);return Oo(zh(t)),t}function bh(e,t){return wh(e.databaseId,t.path)}function Th(e,t){const n=Ih(t);if(n.get(1)!==e.databaseId.projectId)throw new Fo(Mo.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Fo(Mo.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ia(Ch(n))}function Eh(e,t){return wh(e.databaseId,t)}function Sh(e){const t=Ih(e);return 4===t.length?ta.emptyPath():Ch(t)}function kh(e){return new ta(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Ch(e){return Oo(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Ah(e,t,n){return{name:bh(e,t),fields:n.value.mapValue.fields}}function Nh(e,t,n){const r=Th(e,t.name),i=vh(t.updateTime),s=t.createTime?vh(t.createTime):Zo.min(),o=new Xc({mapValue:{fields:t.fields}}),a=eu.newFoundDocument(r,i,s,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function Dh(e,t){let n;if(t instanceof Ol)n={update:Ah(e,t.key,t.value)};else if(t instanceof Vl)n={delete:bh(e,t.key)};else if(t instanceof Ll)n={update:Ah(e,t.key,t.data),updateMask:jh(t.fieldMask)};else{if(!(t instanceof ql))return Po();n={verify:bh(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof gl)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof yl)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof wl)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Il)return{fieldPath:t.field.canonicalString(),increment:n.Pe};throw Po()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:yh(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Po()}(e,t.precondition)),n}function Rh(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?kl.updateTime(vh(e.updateTime)):void 0!==e.exists?kl.exists(e.exists):kl.none()}(t.currentDocument):kl.none(),r=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)Oo("REQUEST_TIME"===t.setToServerValue),n=new gl;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new yl(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new wl(e)}else"increment"in t?n=new Il(e,t.increment):Po();const r=ra.fromServerFormat(t.fieldPath);return new El(r,n)}(e,t))):[];if(t.update){t.update.name;const i=Th(e,t.update.name),s=new Xc({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new wc(t.map((e=>ra.fromServerFormat(e))))}(t.updateMask);return new Ll(i,s,e,n,r)}return new Ol(i,s,n,r)}if(t.delete){const r=Th(e,t.delete);return new Vl(r,n)}if(t.verify){const r=Th(e,t.verify);return new ql(r,n)}return Po()}function xh(e,t){return{documents:[Eh(e,t.path)]}}function Ph(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Eh(e,i);const s=function(e){if(0!==e.length)return Bh(cu.create(e,"and"))}(t.filters);s&&(n.structuredQuery.where=s);const o=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Vh(e.field),direction:Mh(e.dir)}}(e)))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const a=ph(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{_t:n,parent:i}}function Oh(e){let t=Sh(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Oo(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=Lh(e);return t instanceof cu&&hu(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map((e=>function(e){return new iu(qh(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)))}(n.orderBy));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Ra(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new tu(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new tu(n,t)}(n.endAt)),Ou(t,i,o,s,a,"F",c,u)}function Lh(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=qh(e.unaryFilter.field);return au.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=qh(e.unaryFilter.field);return au.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=qh(e.unaryFilter.field);return au.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=qh(e.unaryFilter.field);return au.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Po()}}(e):void 0!==e.fieldFilter?function(e){return au.create(qh(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Po()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return cu.create(e.compositeFilter.filters.map((e=>Lh(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Po()}}(e.compositeFilter.op))}(e):Po()}function Mh(e){return lh[e]}function Fh(e){return hh[e]}function Uh(e){return dh[e]}function Vh(e){return{fieldPath:e.canonicalString()}}function qh(e){return ra.fromServerFormat(e.fieldPath)}function Bh(e){return e instanceof au?function(e){if("=="===e.op){if(Gc(e.value))return{unaryFilter:{field:Vh(e.field),op:"IS_NAN"}};if(zc(e.value))return{unaryFilter:{field:Vh(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Gc(e.value))return{unaryFilter:{field:Vh(e.field),op:"IS_NOT_NAN"}};if(zc(e.value))return{unaryFilter:{field:Vh(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Vh(e.field),op:Fh(e.op),value:e.value}}}(e):e instanceof cu?function(e){const t=e.getFilters().map((e=>Bh(e)));return 1===t.length?t[0]:{compositeFilter:{op:Uh(e.op),filters:t}}}(e):Po()}function jh(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function zh(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Gh{constructor(e,t,n,r,i=Zo.min(),s=Zo.min(),o=Ic.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new Gh(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Gh(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Gh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Gh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Kh{constructor(e){this.ct=e}}function $h(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Hh(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:bh(e,t.key),fields:t.data.value.mapValue.fields,updateTime:mh(e,t.version.toTimestamp()),createTime:mh(e,t.createTime.toTimestamp())}}(e.ct,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Wh(t.version)};else{if(!t.isUnknownDocument())return Po();r.unknownDocument={path:n.path.toArray(),version:Wh(t.version)}}return r}function Hh(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Wh(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Qh(e){const t=new Xo(e.seconds,e.nanoseconds);return Zo.fromTimestamp(t)}function Jh(e,t){const n=(t.baseMutations||[]).map((t=>Rh(e.ct,t)));for(let e=0;e<t.mutations.length-1;++e){const n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){const r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}const r=t.mutations.map((t=>Rh(e.ct,t))),i=Xo.fromMillis(t.localWriteTimeMs);return new Bl(t.batchId,i,n,r)}function Yh(e){const t=Qh(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?Qh(e.lastLimboFreeSnapshotVersion):Zo.min();let r;return r=function(e){return void 0!==e.documents}(e.query)?function(e){return Oo(1===e.documents.length),Vu(Lu(Sh(e.documents[0])))}(e.query):function(e){return Vu(Oh(e))}(e.query),new Gh(r,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,n,Ic.fromBase64String(e.resumeToken))}function Xh(e,t){const n=Wh(t.snapshotVersion),r=Wh(t.lastLimboFreeSnapshotVersion);let i;i=Nu(t.target)?xh(e.ct,t.target):Ph(e.ct,t.target)._t;const s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Cu(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Zh(e){const t=Oh({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Bu(t,t.limit,"L"):t}function ed(e,t){return new zl(t.largestBatchId,Rh(e.ct,t.overlayMutation))}function td(e,t){const n=t.path.lastSegment();return[e,Oa(t.path.popLast()),n]}function nd(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:Wh(r.readTime),documentKey:Oa(r.documentKey.path),largestBatchId:r.largestBatchId}}class rd{getBundleMetadata(e,t){return id(e).get(t).next((e=>{if(e)return function(e){return{id:e.bundleId,createTime:Qh(e.createTime),version:e.version}}(e)}))}saveBundleMetadata(e,t){return id(e).put(function(e){return{bundleId:e.id,createTime:Wh(vh(e.createTime)),version:e.version}}(t))}getNamedQuery(e,t){return sd(e).get(t).next((e=>{if(e)return function(e){return{name:e.name,query:Zh(e.bundledQuery),readTime:Qh(e.readTime)}}(e)}))}saveNamedQuery(e,t){return sd(e).put(function(e){return{name:e.name,readTime:Wh(vh(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function id(e){return uc(e,"bundles")}function sd(e){return uc(e,"namedQueries")}class od{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const n=t.uid||"";return new od(e,n)}getOverlay(e,t){return ad(e).get(td(this.userId,t)).next((e=>e?ed(this.serializer,e):null))}getOverlays(e,t){const n=tl();return ya.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){const r=[];return n.forEach(((n,i)=>{const s=new zl(t,i);r.push(this.ht(e,s))})),ya.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach((e=>r.add(Oa(e.getCollectionPath()))));const i=[];return r.forEach((t=>{const r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(ad(e).j("collectionPathOverlayIndex",r))})),ya.waitFor(i)}getOverlaysForCollection(e,t,n){const r=tl(),i=Oa(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return ad(e).U("collectionPathOverlayIndex",s).next((e=>{for(const t of e){const e=ed(this.serializer,t);r.set(e.getKey(),e)}return r}))}getOverlaysForCollectionGroup(e,t,n,r){const i=tl();let s;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return ad(e).J({index:"collectionGroupOverlayIndex",range:o},((e,t,n)=>{const o=ed(this.serializer,t);i.size()<r||o.largestBatchId===s?(i.set(o.getKey(),o),s=o.largestBatchId):n.done()})).next((()=>i))}ht(e,t){return ad(e).put(function(e,t,n){const[r,i,s]=td(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Dh(e.ct,n.mutation)}}(this.serializer,this.userId,t))}}function ad(e){return uc(e,"documentOverlays")}class cd{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(Ec(e.integerValue));else if("doubleValue"in e){const n=Ec(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),xa(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Et(t,20),"string"==typeof n&&(n=Tc(n)),t.At(`${n.seconds||""}`),t.dt(n.nanos||0)}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(Sc(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Et(t,45),t.dt(n.latitude||0),t.dt(n.longitude||0)}else"mapValue"in e?Hc(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):Po()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){const n=e.fields||{};this.Et(t,55);for(const e of Object.keys(n))this.Rt(e,t),this.It(n[e],t)}wt(e,t){const n=e.values||[];this.Et(t,50);for(const e of n)this.It(e,t)}gt(e,t){this.Et(t,37),ia.fromName(e).path.forEach((e=>{this.Et(t,60),this.St(e,t)}))}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}function ud(e){if(0===e)return 8;let t=0;return!(e>>4)&&(t+=4,e<<=4),!(e>>6)&&(t+=2,e<<=2),!(e>>7)&&(t+=1),t}function ld(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const r=ud(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}cd.bt=new cd;class hd{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ct(n.value),n=t.next();this.vt()}Ft(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Mt(n.value),n=t.next();this.xt()}Ot(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ct(e);else if(e<2048)this.Ct(960|e>>>6),this.Ct(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ct(480|e>>>12),this.Ct(128|63&e>>>6),this.Ct(128|63&e);else{const e=t.codePointAt(0);this.Ct(240|e>>>18),this.Ct(128|63&e>>>12),this.Ct(128|63&e>>>6),this.Ct(128|63&e)}}this.vt()}Nt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Mt(e);else if(e<2048)this.Mt(960|e>>>6),this.Mt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Mt(480|e>>>12),this.Mt(128|63&e>>>6),this.Mt(128|63&e);else{const e=t.codePointAt(0);this.Mt(240|e>>>18),this.Mt(128|63&e>>>12),this.Mt(128|63&e>>>6),this.Mt(128|63&e)}}this.xt()}Lt(e){const t=this.Bt(e),n=ld(t);this.kt(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}qt(e){const t=this.Bt(e),n=ld(t);this.kt(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Wt(){return this.buffer.slice(0,this.position)}Bt(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}Ct(e){const t=255&e;0===t?(this.Kt(0),this.Kt(255)):255===t?(this.Kt(255),this.Kt(0)):this.Kt(t)}Mt(e){const t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(e)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(e){this.kt(1),this.buffer[this.position++]=e}Ut(e){this.kt(1),this.buffer[this.position++]=~e}kt(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class dd{constructor(e){this.Gt=e}ft(e){this.Gt.Dt(e)}At(e){this.Gt.Ot(e)}dt(e){this.Gt.Lt(e)}Tt(){this.Gt.Qt()}}class fd{constructor(e){this.Gt=e}ft(e){this.Gt.Ft(e)}At(e){this.Gt.Nt(e)}dt(e){this.Gt.qt(e)}Tt(){this.Gt.$t()}}class pd{constructor(){this.Gt=new hd,this.zt=new dd(this.Gt),this.jt=new fd(this.Gt)}seed(e){this.Gt.seed(e)}Ht(e){return 0===e?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}}class md{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Jt(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new md(this.indexId,this.documentKey,this.arrayValue,n)}}function gd(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=yd(e.arrayValue,t.arrayValue),0!==n?n:(n=yd(e.directionalValue,t.directionalValue),0!==n?n:ia.comparator(e.documentKey,t.documentKey)))}function yd(e,t){for(let n=0;n<e.length&&n<t.length;++n){const r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class vd{constructor(e){this.Yt=new gc(((e,t)=>ra.comparator(e.field,t.field))),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Zt=e.orderBy,this.Xt=[];for(const t of e.filters){const e=t;e.isInequality()?this.Yt=this.Yt.add(e):this.Xt.push(e)}}get en(){return this.Yt.size>1}tn(e){if(Oo(e.collectionGroup===this.collectionId),this.en)return!1;const t=oa(e);if(void 0!==t&&!this.nn(t))return!1;const n=aa(e);let r=new Set,i=0,s=0;for(;i<n.length&&this.nn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.Yt.size>0){const e=this.Yt.getIterator().getNext();if(!r.has(e.field.canonicalString())){const t=n[i];if(!this.rn(e,t)||!this.sn(this.Zt[s++],t))return!1}++i}for(;i<n.length;++i){const e=n[i];if(s>=this.Zt.length||!this.sn(this.Zt[s++],e))return!1}return!0}on(){if(this.en)return null;let e=new gc(ra.comparator);const t=[];for(const n of this.Xt)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new ca(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new ca(n.field,0))}for(const n of this.Zt)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new ca(n.field,"asc"===n.dir?0:1)));return new sa(sa.UNKNOWN_ID,this.collectionId,t,ua.empty())}nn(e){for(const t of this.Xt)if(this.rn(t,e))return!0;return!1}rn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function wd(e){var t,n;if(Oo(e instanceof au||e instanceof cu),e instanceof au){if(e instanceof bu){const r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map((t=>au.create(e.field,"==",t))))||[];return cu.create(r,"or")}return e}const r=e.filters.map((e=>wd(e)));return cu.create(r,e.op)}function _d(e){if(0===e.getFilters().length)return[];const t=Ed(wd(e));return Oo(Td(t)),Id(t)||bd(t)?[t]:t.getFilters()}function Id(e){return e instanceof au}function bd(e){return e instanceof cu&&hu(e)}function Td(e){return Id(e)||bd(e)||function(e){if(e instanceof cu&&lu(e)){for(const t of e.getFilters())if(!Id(t)&&!bd(t))return!1;return!0}return!1}(e)}function Ed(e){if(Oo(e instanceof au||e instanceof cu),e instanceof au)return e;if(1===e.filters.length)return Ed(e.filters[0]);const t=e.filters.map((e=>Ed(e)));let n=cu.create(t,e.op);return n=Cd(n),Td(n)?n:(Oo(n instanceof cu),Oo(uu(n)),Oo(n.filters.length>1),n.filters.reduce(((e,t)=>Sd(e,t))))}function Sd(e,t){let n;return Oo(e instanceof au||e instanceof cu),Oo(t instanceof au||t instanceof cu),n=e instanceof au?t instanceof au?function(e,t){return cu.create([e,t],"and")}(e,t):kd(e,t):t instanceof au?kd(t,e):function(e,t){if(Oo(e.filters.length>0&&t.filters.length>0),uu(e)&&uu(t))return mu(e,t.getFilters());const n=lu(e)?e:t,r=lu(e)?t:e,i=n.filters.map((e=>Sd(e,r)));return cu.create(i,"or")}(e,t),Cd(n)}function kd(e,t){if(uu(t))return mu(t,e.getFilters());{const n=t.filters.map((t=>Sd(e,t)));return cu.create(n,"or")}}function Cd(e){if(Oo(e instanceof au||e instanceof cu),e instanceof au)return e;const t=e.getFilters();if(1===t.length)return Cd(t[0]);if(du(e))return e;const n=t.map((e=>Cd(e))),r=[];return n.forEach((t=>{t instanceof au?r.push(t):t instanceof cu&&(t.op===e.op?r.push(...t.filters):r.push(t))})),1===r.length?r[0]:cu.create(r,e.op)}class Ad{constructor(){this._n=new Nd}addToCollectionParentIndex(e,t){return this._n.add(t),ya.resolve()}getCollectionParents(e,t){return ya.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return ya.resolve()}deleteFieldIndex(e,t){return ya.resolve()}deleteAllFieldIndexes(e){return ya.resolve()}createTargetIndexes(e,t){return ya.resolve()}getDocumentsMatchingTarget(e,t){return ya.resolve(null)}getIndexType(e,t){return ya.resolve(0)}getFieldIndexes(e,t){return ya.resolve([])}getNextCollectionGroupToUpdate(e){return ya.resolve(null)}getMinOffset(e,t){return ya.resolve(da.min())}getMinOffsetFromCollectionGroup(e,t){return ya.resolve(da.min())}updateCollectionGroup(e,t,n){return ya.resolve()}updateIndexEntries(e,t){return ya.resolve()}}class Nd{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new gc(ta.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new gc(ta.comparator)).toArray()}}const Dd=new Uint8Array(0);class Rd{constructor(e,t){this.databaseId=t,this.an=new Nd,this.un=new Qu((e=>Cu(e)),((e,t)=>Au(e,t))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.an.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.an.add(t)}));const i={collectionId:n,parent:Oa(r)};return xd(e).put(i)}return ya.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[Yo(t),""],!1,!0);return xd(e).U(r).next((e=>{for(const r of e){if(r.collectionId!==t)break;n.push(Fa(r.parent))}return n}))}addFieldIndex(e,t){const n=Od(e),r=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map((e=>[e.fieldPath.canonicalString(),e.kind]))}}(t);delete r.indexId;const i=n.add(r);if(t.indexState){const n=Ld(e);return i.next((e=>{n.put(nd(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}deleteFieldIndex(e,t){const n=Od(e),r=Ld(e),i=Pd(e);return n.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=Od(e),n=Pd(e),r=Ld(e);return t.j().next((()=>n.j())).next((()=>r.j()))}createTargetIndexes(e,t){return ya.forEach(this.cn(t),(t=>this.getIndexType(e,t).next((n=>{if(0===n||1===n){const n=new vd(t).on();if(null!=n)return this.addFieldIndex(e,n)}}))))}getDocumentsMatchingTarget(e,t){const n=Pd(e);let r=!0;const i=new Map;return ya.forEach(this.cn(t),(t=>this.ln(e,t).next((e=>{r&&(r=!!e),i.set(t,e)})))).next((()=>{if(r){let e=ol();const r=[];return ya.forEach(i,((i,s)=>{No("IndexedDbIndexManager",`Using index ${function(e){return`id=${e.indexId}|cg=${e.collectionGroup}|f=${e.fields.map((e=>`${e.fieldPath}:${e.kind}`)).join(",")}`}(i)} to execute ${Cu(t)}`);const o=function(e,t){const n=oa(t);if(void 0===n)return null;for(const t of Du(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),a=function(e,t){const n=new Map;for(const r of aa(t))for(const t of Du(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),c=function(e,t){const n=[];let r=!0;for(const i of aa(t)){const t=0===i.kind?Ru(e,i.fieldPath,e.startAt):xu(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new tu(n,r)}(s,i),u=function(e,t){const n=[];let r=!0;for(const i of aa(t)){const t=0===i.kind?xu(e,i.fieldPath,e.endAt):Ru(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new tu(n,r)}(s,i),l=this.hn(i,s,c),h=this.hn(i,s,u),d=this.Pn(i,s,a),f=this.In(i.indexId,o,l,c.inclusive,h,u.inclusive,d);return ya.forEach(f,(i=>n.G(i,t.limit).next((t=>{t.forEach((t=>{const n=ia.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))}))}))))})).next((()=>r))}return ya.resolve(null)}))}cn(e){let t=this.un.get(e);return t||(t=0===e.filters.length?[e]:_d(cu.create(e.filters,"and")).map((t=>ku(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt))),this.un.set(e,t),t)}In(e,t,n,r,i,s,o){const a=(null!=t?t.length:1)*Math.max(n.length,i.length),c=a/(null!=t?t.length:1),u=[];for(let l=0;l<a;++l){const a=t?this.Tn(t[l/c]):Dd,h=this.En(e,a,n[l%c],r),d=this.dn(e,a,i[l%c],s),f=o.map((t=>this.En(e,a,t,!0)));u.push(...this.createRange(h,d,f))}return u}En(e,t,n,r){const i=new md(e,ia.empty(),t,n);return r?i:i.Jt()}dn(e,t,n,r){const i=new md(e,ia.empty(),t,n);return r?i.Jt():i}ln(e,t){const n=new vd(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((e=>{let t=null;for(const r of e)n.tn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t}))}getIndexType(e,t){let n=2;const r=this.cn(t);return ya.forEach(r,(t=>this.ln(e,t).next((e=>{e?0!==n&&e.fields.length<function(e){let t=new gc(ra.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})))).next((()=>function(e){return null!==e.limit}(t)&&r.length>1&&2===n?1:n))}An(e,t){const n=new pd;for(const r of aa(e)){const e=t.data.field(r.fieldPath);if(null==e)return null;const i=n.Ht(r.kind);cd.bt.Pt(e,i)}return n.Wt()}Tn(e){const t=new pd;return cd.bt.Pt(e,t.Ht(0)),t.Wt()}Rn(e,t){const n=new pd;return cd.bt.Pt(qc(this.databaseId,t),n.Ht(function(e){const t=aa(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Wt()}Pn(e,t,n){if(null===n)return[];let r=[];r.push(new pd);let i=0;for(const s of aa(e)){const e=n[i++];for(const n of r)if(this.Vn(t,s.fieldPath)&&jc(e))r=this.mn(r,s,e);else{const t=n.Ht(s.kind);cd.bt.Pt(e,t)}}return this.fn(r)}hn(e,t,n){return this.Pn(e,t,n.position)}fn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Wt();return t}mn(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new pd;r.seed(n.Wt()),cd.bt.Pt(e,r.Ht(t.kind)),i.push(r)}return i}Vn(e,t){return!!e.filters.find((e=>e instanceof au&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)))}getFieldIndexes(e,t){const n=Od(e),r=Ld(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next((e=>{const t=[];return ya.forEach(e,(e=>r.get([e.indexId,this.uid]).next((n=>{t.push(function(e,t){const n=t?new ua(t.sequenceNumber,new da(Qh(t.readTime),new ia(Fa(t.documentKey)),t.largestBatchId)):ua.empty(),r=e.fields.map((([e,t])=>new ca(ra.fromServerFormat(e),t)));return new sa(e.indexId,e.collectionGroup,r,n)}(e,n))})))).next((()=>t))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((e=>0===e.length?null:(e.sort(((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:Qo(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(e,t,n){const r=Od(e),i=Ld(e);return this.gn(e).next((e=>r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next((t=>ya.forEach(t,(t=>i.put(nd(t.indexId,this.uid,e,n))))))))}updateIndexEntries(e,t){const n=new Map;return ya.forEach(t,((t,r)=>{const i=n.get(t.collectionGroup);return(i?ya.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next((i=>(n.set(t.collectionGroup,i),ya.forEach(i,(n=>this.pn(e,t,n).next((t=>{const i=this.yn(r,n);return t.isEqual(i)?ya.resolve():this.wn(e,r,n,t,i)})))))))}))}Sn(e,t,n,r){return Pd(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.Rn(n,t.key),documentKey:t.key.path.toArray()})}bn(e,t,n,r){return Pd(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.Rn(n,t.key),t.key.path.toArray()])}pn(e,t,n){const r=Pd(e);let i=new gc(gd);return r.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.Rn(n,t)])},((e,r)=>{i=i.add(new md(n.indexId,t,r.arrayValue,r.directionalValue))})).next((()=>i))}yn(e,t){let n=new gc(gd);const r=this.An(t,e);if(null==r)return n;const i=oa(t);if(null!=i){const s=e.data.field(i.fieldPath);if(jc(s))for(const i of s.arrayValue.values||[])n=n.add(new md(t.indexId,e.key,this.Tn(i),r))}else n=n.add(new md(t.indexId,e.key,Dd,r));return n}wn(e,t,n,r,i){No("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const s=[];return function(e,t,n,r,i){const s=e.getIterator(),o=t.getIterator();let a=vc(s),c=vc(o);for(;a||c;){let e=!1,t=!1;if(a&&c){const r=n(a,c);r<0?t=!0:r>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(c),c=vc(o)):t?(i(a),a=vc(s)):(a=vc(s),c=vc(o))}}(r,i,gd,(r=>{s.push(this.Sn(e,t,n,r))}),(r=>{s.push(this.bn(e,t,n,r))})),ya.waitFor(s)}gn(e){let t=1;return Ld(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((e,n,r)=>{r.done(),t=n.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((e,t)=>gd(e,t))).filter(((e,t,n)=>!t||0!==gd(e,n[t-1])));const r=[];r.push(e);for(const i of n){const n=gd(i,e),s=gd(i,t);if(0===n)r[0]=e.Jt();else if(n>0&&s<0)r.push(i),r.push(i.Jt());else if(s>0)break}r.push(t);const i=[];for(let e=0;e<r.length;e+=2){if(this.Dn(r[e],r[e+1]))return[];const t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,Dd,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,Dd,[]];i.push(IDBKeyRange.bound(t,n))}return i}Dn(e,t){return gd(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Md)}getMinOffset(e,t){return ya.mapArray(this.cn(t),(t=>this.ln(e,t).next((e=>e||Po())))).next(Md)}}function xd(e){return uc(e,"collectionParents")}function Pd(e){return uc(e,"indexEntries")}function Od(e){return uc(e,"indexConfiguration")}function Ld(e){return uc(e,"indexState")}function Md(e){Oo(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){const i=e[r].indexState.offset;fa(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new da(t.readTime,t.documentKey,n)}const Fd={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Ud{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Ud(e,Ud.DEFAULT_COLLECTION_PERCENTILE,Ud.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Vd(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.J({range:o},((e,t,n)=>(a++,n.delete())));s.push(c.next((()=>{Oo(1===a)})));const u=[];for(const e of n.mutations){const r=qa(t,e.key.path,n.batchId);s.push(i.delete(r)),u.push(e.key)}return ya.waitFor(s).next((()=>u))}function qd(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw Po();t=e.noDocument}return JSON.stringify(t).length}Ud.DEFAULT_COLLECTION_PERCENTILE=10,Ud.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ud.DEFAULT=new Ud(41943040,Ud.DEFAULT_COLLECTION_PERCENTILE,Ud.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ud.DISABLED=new Ud(-1,0,0);class Bd{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Cn={}}static lt(e,t,n,r){Oo(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new Bd(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return zd(e).J({index:"userMutationsIndex",range:n},((e,n,r)=>{t=!1,r.done()})).next((()=>t))}addMutationBatch(e,t,n,r){const i=Gd(e),s=zd(e);return s.add({}).next((o=>{Oo("number"==typeof o);const a=new Bl(o,t,n,r),c=function(e,t,n){const r=n.baseMutations.map((t=>Dh(e.ct,t))),i=n.mutations.map((t=>Dh(e.ct,t)));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.serializer,this.userId,a),u=[];let l=new gc(((e,t)=>Qo(e.canonicalString(),t.canonicalString())));for(const e of r){const t=qa(this.userId,e.key.path,o);l=l.add(e.key.path.popLast()),u.push(s.put(c)),u.push(i.put(t,Ba))}return l.forEach((t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.Cn[o]=a.keys()})),ya.waitFor(u).next((()=>a))}))}lookupMutationBatch(e,t){return zd(e).get(t).next((e=>e?(Oo(e.userId===this.userId),Jh(this.serializer,e)):null))}vn(e,t){return this.Cn[t]?ya.resolve(this.Cn[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){const n=e.keys();return this.Cn[t]=n,n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return zd(e).J({index:"userMutationsIndex",range:r},((e,t,r)=>{t.userId===this.userId&&(Oo(t.batchId>=n),i=Jh(this.serializer,t)),r.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return zd(e).J({index:"userMutationsIndex",range:t,reverse:!0},((e,t,r)=>{n=t.batchId,r.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return zd(e).U("userMutationsIndex",t).next((e=>e.map((e=>Jh(this.serializer,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=Va(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return Gd(e).J({range:r},((n,r,s)=>{const[o,a,c]=n,u=Fa(a);if(o===this.userId&&t.path.isEqual(u))return zd(e).get(c).next((e=>{if(!e)throw Po();Oo(e.userId===this.userId),i.push(Jh(this.serializer,e))}));s.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new gc(Qo);const r=[];return t.forEach((t=>{const i=Va(this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=Gd(e).J({range:s},((e,r,i)=>{const[s,o,a]=e,c=Fa(o);s===this.userId&&t.path.isEqual(c)?n=n.add(a):i.done()}));r.push(o)})),ya.waitFor(r).next((()=>this.Fn(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=Va(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new gc(Qo);return Gd(e).J({range:s},((e,t,i)=>{const[s,a,c]=e,u=Fa(a);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):i.done()})).next((()=>this.Fn(e,o)))}Fn(e,t){const n=[],r=[];return t.forEach((t=>{r.push(zd(e).get(t).next((e=>{if(null===e)throw Po();Oo(e.userId===this.userId),n.push(Jh(this.serializer,e))})))})),ya.waitFor(r).next((()=>n))}removeMutationBatch(e,t){return Vd(e._e,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.Mn(t.batchId)})),ya.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}Mn(e){delete this.Cn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return ya.resolve();const n=IDBKeyRange.lowerBound(function(e){return[e]}(this.userId)),r=[];return Gd(e).J({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=Fa(e[1]);r.push(t)}else n.done()})).next((()=>{Oo(0===r.length)}))}))}containsKey(e,t){return jd(e,this.userId,t)}xn(e){return Kd(e).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function jd(e,t,n){const r=Va(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return Gd(e).J({range:s,H:!0},((e,n,r)=>{const[s,a,c]=e;s===t&&a===i&&(o=!0),r.done()})).next((()=>o))}function zd(e){return uc(e,"mutations")}function Gd(e){return uc(e,"documentMutations")}function Kd(e){return uc(e,"mutationQueues")}class $d{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new $d(0)}static Ln(){return new $d(-1)}}class Hd{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Bn(e).next((t=>{const n=new $d(t.highestTargetId);return t.highestTargetId=n.next(),this.kn(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.Bn(e).next((e=>Zo.fromTimestamp(new Xo(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.Bn(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.Bn(e).next((r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.kn(e,r))))}addTargetData(e,t){return this.qn(e,t).next((()=>this.Bn(e).next((n=>(n.targetCount+=1,this.Qn(t,n),this.kn(e,n))))))}updateTargetData(e,t){return this.qn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>Wd(e).delete(t.targetId))).next((()=>this.Bn(e))).next((t=>(Oo(t.targetCount>0),t.targetCount-=1,this.kn(e,t))))}removeTargets(e,t,n){let r=0;const i=[];return Wd(e).J(((s,o)=>{const a=Yh(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(e,a)))})).next((()=>ya.waitFor(i))).next((()=>r))}forEachTarget(e,t){return Wd(e).J(((e,n)=>{const r=Yh(n);t(r)}))}Bn(e){return Qd(e).get("targetGlobalKey").next((e=>(Oo(null!==e),e)))}kn(e,t){return Qd(e).put("targetGlobalKey",t)}qn(e,t){return Wd(e).put(Xh(this.serializer,t))}Qn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Bn(e).next((e=>e.targetCount))}getTargetData(e,t){const n=Cu(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return Wd(e).J({range:r,index:"queryTargetsIndex"},((e,n,r)=>{const s=Yh(n);Au(t,s.target)&&(i=s,r.done())})).next((()=>i))}addMatchingKeys(e,t,n){const r=[],i=Jd(e);return t.forEach((t=>{const s=Oa(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))})),ya.waitFor(r)}removeMatchingKeys(e,t,n){const r=Jd(e);return ya.forEach(t,(t=>{const i=Oa(t.path);return ya.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=Jd(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Jd(e);let i=ol();return r.J({range:n,H:!0},((e,t,n)=>{const r=Fa(e[1]),s=new ia(r);i=i.add(s)})).next((()=>i))}containsKey(e,t){const n=Oa(t.path),r=IDBKeyRange.bound([n],[Yo(n)],!1,!0);let i=0;return Jd(e).J({index:"documentTargetsIndex",H:!0,range:r},(([e,t],n,r)=>{0!==e&&(i++,r.done())})).next((()=>i>0))}ot(e,t){return Wd(e).get(t).next((e=>e?Yh(e):null))}}function Wd(e){return uc(e,"targets")}function Qd(e){return uc(e,"targetGlobal")}function Jd(e){return uc(e,"targetDocuments")}function Yd([e,t],[n,r]){const i=Qo(e,n);return 0===i?Qo(t,r):i}class Xd{constructor(e){this.Kn=e,this.buffer=new gc(Yd),this.$n=0}Un(){return++this.$n}Wn(e){const t=[e,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Yd(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Zd{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}zn(e){No("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Gn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Ta(e)?No("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await ga(e)}await this.zn(3e5)}))}}class ef{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.Hn(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return ya.resolve(Da.oe);const n=new Xd(t);return this.jn.forEachTarget(e,(e=>n.Wn(e.sequenceNumber))).next((()=>this.jn.Jn(e,(e=>n.Wn(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(No("LruGarbageCollector","Garbage collection skipped; disabled"),ya.resolve(Fd)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(No("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Fd):this.Yn(e,t)))}getCacheSize(e){return this.jn.getCacheSize(e)}Yn(e,t){let n,r,i,s,o,a,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(No("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,a=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(c=Date.now(),Ao()<=q.DEBUG&&No("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-u}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${e} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),ya.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e}))))}}class tf{constructor(e,t){this.db=e,this.garbageCollector=function(e,t){return new ef(e,t)}(this,t)}Hn(e){const t=this.Zn(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}Zn(e){let t=0;return this.Jn(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Jn(e,t){return this.Xn(e,((e,n)=>t(n)))}addReference(e,t,n){return nf(e,n)}removeReference(e,t,n){return nf(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return nf(e,t)}er(e,t){return function(e,t){let n=!1;return Kd(e).Y((r=>jd(e,r,t).next((e=>(e&&(n=!0),ya.resolve(!e)))))).next((()=>n))}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Xn(e,((s,o)=>{if(o<=t){const t=this.er(e,s).next((t=>{if(!t)return i++,n.getEntry(e,s).next((()=>(n.removeEntry(s,Zo.min()),Jd(e).delete(function(e){return[0,Oa(e.path)]}(s)))))}));r.push(t)}})).next((()=>ya.waitFor(r))).next((()=>n.apply(e))).next((()=>i))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return nf(e,t)}Xn(e,t){const n=Jd(e);let r,i=Da.oe;return n.J({index:"documentTargetsIndex"},(([e,n],{path:s,sequenceNumber:o})=>{0===e?(i!==Da.oe&&t(new ia(Fa(r)),i),i=o,r=s):i=Da.oe})).next((()=>{i!==Da.oe&&t(new ia(Fa(r)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function nf(e,t){return Jd(e).put(function(e,t){return{targetId:0,path:Oa(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}class rf{constructor(){this.changes=new Qu((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,eu.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?ya.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class sf{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return uf(e).put(n)}removeEntry(e,t,n){return uf(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],Hh(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.tr(e,n))))}getEntry(e,t){let n=eu.newInvalidDocument(t);return uf(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(lf(t))},((e,r)=>{n=this.nr(t,r)})).next((()=>n))}rr(e,t){let n={size:0,document:eu.newInvalidDocument(t)};return uf(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(lf(t))},((e,r)=>{n={document:this.nr(t,r),size:qd(r)}})).next((()=>n))}getEntries(e,t){let n=Yu();return this.ir(e,t,((e,t)=>{const r=this.nr(e,t);n=n.insert(e,r)})).next((()=>n))}sr(e,t){let n=Yu(),r=new fc(ia.comparator);return this.ir(e,t,((e,t)=>{const i=this.nr(e,t);n=n.insert(e,i),r=r.insert(e,qd(t))})).next((()=>({documents:n,_r:r})))}ir(e,t,n){if(t.isEmpty())return ya.resolve();let r=new gc(df);t.forEach((e=>r=r.add(e)));const i=IDBKeyRange.bound(lf(r.first()),lf(r.last())),s=r.getIterator();let o=s.getNext();return uf(e).J({index:"documentKeyIndex",range:i},((e,t,r)=>{const i=ia.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&df(o,i)<0;)n(o,null),o=s.getNext();o&&o.isEqual(i)&&(n(o,t),o=s.hasNext()?s.getNext():null),o?r.$(lf(o)):r.done()})).next((()=>{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null}))}getDocumentsMatchingQuery(e,t,n,r,i){const s=t.path,o=[s.popLast().toArray(),s.lastSegment(),Hh(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],a=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return uf(e).U(IDBKeyRange.bound(o,a,!0)).next((e=>{null==i||i.incrementDocumentReadCount(e.length);let n=Yu();for(const i of e){const e=this.nr(ia.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(Ku(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n}))}getAllFromCollectionGroup(e,t,n,r){let i=Yu();const s=hf(t,n),o=hf(t,da.max());return uf(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,o,!0)},((e,t,n)=>{const s=this.nr(ia.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(s.key,s),i.size===r&&n.done()})).next((()=>i))}newChangeBuffer(e){return new af(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return cf(e).get("remoteDocumentGlobalKey").next((e=>(Oo(!!e),e)))}tr(e,t){return cf(e).put("remoteDocumentGlobalKey",t)}nr(e,t){if(t){const e=function(e,t){let n;if(t.document)n=Nh(e.ct,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=ia.fromSegments(t.noDocument.path),r=Qh(t.noDocument.readTime);n=eu.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return Po();{const e=ia.fromSegments(t.unknownDocument.path),r=Qh(t.unknownDocument.version);n=eu.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){const t=new Xo(e[0],e[1]);return Zo.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(Zo.min()))return e}return eu.newInvalidDocument(e)}}function of(e){return new sf(e)}class af extends rf{constructor(e,t){super(),this.ar=e,this.trackRemovals=t,this.ur=new Qu((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,r=new gc(((e,t)=>Qo(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((i,s)=>{const o=this.ur.get(i);if(t.push(this.ar.removeEntry(e,i,o.readTime)),s.isValidDocument()){const a=$h(this.ar.serializer,s);r=r.add(i.path.popLast());const c=qd(a);n+=c-o.size,t.push(this.ar.addEntry(e,i,a))}else if(n-=o.size,this.trackRemovals){const n=$h(this.ar.serializer,s.convertToNoDocument(Zo.min()));t.push(this.ar.addEntry(e,i,n))}})),r.forEach((n=>{t.push(this.ar.indexManager.addToCollectionParentIndex(e,n))})),t.push(this.ar.updateMetadata(e,n)),ya.waitFor(t)}getFromCache(e,t){return this.ar.rr(e,t).next((e=>(this.ur.set(t,{size:e.size,readTime:e.document.readTime}),e.document)))}getAllFromCache(e,t){return this.ar.sr(e,t).next((({documents:e,_r:t})=>(t.forEach(((t,n)=>{this.ur.set(t,{size:n,readTime:e.get(t).readTime})})),e)))}}function cf(e){return uc(e,"remoteDocumentGlobal")}function uf(e){return uc(e,"remoteDocumentsV14")}function lf(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function hf(e,t){const n=t.documentKey.path.toArray();return[e,Hh(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function df(e,t){const n=e.path.toArray(),r=t.path.toArray();let i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=Qo(n[e],r[e]),i)return i;return i=Qo(n.length,r.length),i||(i=Qo(n[n.length-2],r[r.length-2]),i||Qo(n[n.length-1],r[r.length-1]))}class ff{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class pf{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&Rl(n.mutation,e,wc.empty(),Xo.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,ol()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=ol()){const r=tl();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=Zu();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=tl();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,ol())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=Yu();const s=rl(),o=rl();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof Ll)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),Rl(o.mutation,t,o.mutation.getFieldMask(),Xo.now())):s.set(t.key,wc.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new ff(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=rl();let r=new fc(((e,t)=>e-t)),i=ol();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||wc.empty();o=i.applyToLocalView(s,o),n.set(e,o);const a=(r.get(i.batchId)||ol()).add(e);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=nl();c.forEach((e=>{if(!i.has(e)){const r=Nl(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,a,u))}return ya.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return ia.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Fu(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):ya.resolve(tl());let o=-1,a=i;return s.next((t=>ya.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?ya.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,a,t,ol()))).next((e=>({batchId:o,changes:el(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ia(t)).next((e=>{let t=Zu();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let s=Zu();return this.indexManager.getCollectionParents(e,i).next((o=>ya.forEach(o,(o=>{const a=function(e,t){return new Pu(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(i));return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next((e=>{e.forEach(((e,t)=>{s=s.insert(e,t)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r)))).next((e=>{i.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,eu.newInvalidDocument(r)))}));let n=Zu();return e.forEach(((e,r)=>{const s=i.get(e);void 0!==s&&Rl(s.mutation,r,wc.empty(),Xo.now()),Ku(t,r)&&(n=n.insert(e,r))})),n}))}}class mf{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return ya.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:vh(e.createTime)}}(t)),ya.resolve()}getNamedQuery(e,t){return ya.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,function(e){return{name:e.name,query:Zh(e.bundledQuery),readTime:vh(e.readTime)}}(t)),ya.resolve()}}class gf{constructor(){this.overlays=new fc(ia.comparator),this.hr=new Map}getOverlay(e,t){return ya.resolve(this.overlays.get(t))}getOverlays(e,t){const n=tl();return ya.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.ht(e,t,r)})),ya.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.hr.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.hr.delete(n)),ya.resolve()}getOverlaysForCollection(e,t,n){const r=tl(),i=t.length+1,s=new ia(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return ya.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new fc(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=tl(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=tl(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return ya.resolve(o)}ht(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new zl(t,n));let i=this.hr.get(t);void 0===i&&(i=ol(),this.hr.set(t,i)),this.hr.set(t,i.add(n.key))}}class yf{constructor(){this.Pr=new gc(vf.Ir),this.Tr=new gc(vf.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){const n=new vf(e,t);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Ar(new vf(e,t))}Rr(e,t){e.forEach((e=>this.removeReference(e,t)))}Vr(e){const t=new ia(new ta([])),n=new vf(t,e),r=new vf(t,e+1),i=[];return this.Tr.forEachInRange([n,r],(e=>{this.Ar(e),i.push(e.key)})),i}mr(){this.Pr.forEach((e=>this.Ar(e)))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const t=new ia(new ta([])),n=new vf(t,e),r=new vf(t,e+1);let i=ol();return this.Tr.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new vf(e,0),n=this.Pr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class vf{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return ia.comparator(e.key,t.key)||Qo(e.pr,t.pr)}static Er(e,t){return Qo(e.pr,t.pr)||ia.comparator(e.key,t.key)}}class wf{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new gc(vf.Ir)}checkEmpty(e){return ya.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Bl(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.wr=this.wr.add(new vf(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return ya.resolve(s)}lookupMutationBatch(e,t){return ya.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.br(n),i=r<0?0:r;return ya.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return ya.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return ya.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new vf(t,0),r=new vf(t,Number.POSITIVE_INFINITY),i=[];return this.wr.forEachInRange([n,r],(e=>{const t=this.Sr(e.pr);i.push(t)})),ya.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new gc(Qo);return t.forEach((e=>{const t=new vf(e,0),r=new vf(e,Number.POSITIVE_INFINITY);this.wr.forEachInRange([t,r],(e=>{n=n.add(e.pr)}))})),ya.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;ia.isDocumentKey(i)||(i=i.child(""));const s=new vf(new ia(i),0);let o=new gc(Qo);return this.wr.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.pr)),!0)}),s),ya.resolve(this.Dr(o))}Dr(e){const t=[];return e.forEach((e=>{const n=this.Sr(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){Oo(0===this.Cr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return ya.forEach(t.mutations,(r=>{const i=new vf(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.wr=n}))}Mn(e){}containsKey(e,t){const n=new vf(t,0),r=this.wr.firstAfterOrEqual(n);return ya.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,ya.resolve()}Cr(e,t){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){const t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class _f{constructor(e){this.vr=e,this.docs=new fc(ia.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.vr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return ya.resolve(n?n.document.mutableCopy():eu.newInvalidDocument(t))}getEntries(e,t){let n=Yu();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():eu.newInvalidDocument(e))})),ya.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=Yu();const s=t.path,o=new ia(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||fa(ha(o),n)<=0||(r.has(o.key)||Ku(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return ya.resolve(i)}getAllFromCollectionGroup(e,t,n,r){Po()}Fr(e,t){return ya.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new If(this)}getSize(e){return ya.resolve(this.size)}}class If extends rf{constructor(e){super(),this.ar=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.ar.addEntry(e,r)):this.ar.removeEntry(n)})),ya.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}}class bf{constructor(e){this.persistence=e,this.Mr=new Qu((e=>Cu(e)),Au),this.lastRemoteSnapshotVersion=Zo.min(),this.highestTargetId=0,this.Or=0,this.Nr=new yf,this.targetCount=0,this.Lr=$d.Nn()}forEachTarget(e,t){return this.Mr.forEach(((e,n)=>t(n))),ya.resolve()}getLastRemoteSnapshotVersion(e){return ya.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ya.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),ya.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Or&&(this.Or=t),ya.resolve()}qn(e){this.Mr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Lr=new $d(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,ya.resolve()}updateTargetData(e,t){return this.qn(t),ya.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,ya.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Mr.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Mr.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),ya.waitFor(i).next((()=>r))}getTargetCount(e){return ya.resolve(this.targetCount)}getTargetData(e,t){const n=this.Mr.get(t)||null;return ya.resolve(n)}addMatchingKeys(e,t,n){return this.Nr.dr(t,n),ya.resolve()}removeMatchingKeys(e,t,n){this.Nr.Rr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),ya.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),ya.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Nr.gr(t);return ya.resolve(n)}containsKey(e,t){return ya.resolve(this.Nr.containsKey(t))}}class Tf{constructor(e,t){this.Br={},this.overlays={},this.kr=new Da(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new bf(this),this.indexManager=new Ad,this.remoteDocumentCache=function(e){return new _f(e)}((e=>this.referenceDelegate.Kr(e))),this.serializer=new Kh(t),this.$r=new mf(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new gf,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Br[e.toKey()];return n||(n=new wf(t,this.referenceDelegate),this.Br[e.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,n){No("MemoryPersistence","Starting transaction:",e);const r=new Ef(this.kr.next());return this.referenceDelegate.Ur(),n(r).next((e=>this.referenceDelegate.Wr(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Gr(e,t){return ya.or(Object.values(this.Br).map((n=>()=>n.containsKey(e,t))))}}class Ef extends ma{constructor(e){super(),this.currentSequenceNumber=e}}class Sf{constructor(e){this.persistence=e,this.zr=new yf,this.jr=null}static Hr(e){return new Sf(e)}get Jr(){if(this.jr)return this.jr;throw Po()}addReference(e,t,n){return this.zr.addReference(n,t),this.Jr.delete(n.toString()),ya.resolve()}removeReference(e,t,n){return this.zr.removeReference(n,t),this.Jr.add(n.toString()),ya.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),ya.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach((e=>this.Jr.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Jr.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Ur(){this.jr=new Set}Wr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ya.forEach(this.Jr,(n=>{const r=ia.fromPath(n);return this.Yr(e,r).next((e=>{e||t.removeEntry(r,Zo.min())}))})).next((()=>(this.jr=null,t.apply(e))))}updateLimboDocument(e,t){return this.Yr(e,t).next((e=>{e?this.Jr.delete(t.toString()):this.Jr.add(t.toString())}))}Kr(e){return 0}Yr(e,t){return ya.or([()=>ya.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}}class kf{constructor(e){this.serializer=e}O(e,t,n,r){const i=new va("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore("owner")}(e),function(e){e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Ua,{unique:!0}),e.createObjectStore("documentMutations")}(e),Cf(e),function(e){e.createObjectStore("remoteDocuments")}(e));let s=ya.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),Cf(e)),s=s.next((()=>function(e){const t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Zo.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(i)))),n<4&&r>=4&&(0!==n&&(s=s.next((()=>function(e,t){return t.store("mutations").U().next((n=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Ua,{unique:!0});const r=t.store("mutations"),i=n.map((e=>r.put(e)));return ya.waitFor(i)}))}(e,i)))),s=s.next((()=>{!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)}))),n<5&&r>=5&&(s=s.next((()=>this.Xr(i)))),n<6&&r>=6&&(s=s.next((()=>(function(e){e.createObjectStore("remoteDocumentGlobal")}(e),this.ei(i))))),n<7&&r>=7&&(s=s.next((()=>this.ti(i)))),n<8&&r>=8&&(s=s.next((()=>this.ni(e,i)))),n<9&&r>=9&&(s=s.next((()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&r>=10&&(s=s.next((()=>this.ri(i)))),n<11&&r>=11&&(s=s.next((()=>{!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)}))),n<12&&r>=12&&(s=s.next((()=>{!function(e){const t=e.createObjectStore("documentOverlays",{keyPath:Za});t.createIndex("collectionPathOverlayIndex",ec,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",tc,{unique:!1})}(e)}))),n<13&&r>=13&&(s=s.next((()=>function(e){const t=e.createObjectStore("remoteDocumentsV14",{keyPath:ja});t.createIndex("documentKeyIndex",za),t.createIndex("collectionGroupIndex",Ga)}(e))).next((()=>this.ii(e,i))).next((()=>e.deleteObjectStore("remoteDocuments")))),n<14&&r>=14&&(s=s.next((()=>this.si(e,i)))),n<15&&r>=15&&(s=s.next((()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:Qa}).createIndex("sequenceNumberIndex",Ja,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:Ya}).createIndex("documentKeyIndex",Xa,{unique:!1})}(e)))),n<16&&r>=16&&(s=s.next((()=>{t.objectStore("indexState").clear()})).next((()=>{t.objectStore("indexEntries").clear()}))),s}ei(e){let t=0;return e.store("remoteDocuments").J(((e,n)=>{t+=qd(n)})).next((()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}Xr(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next((t=>ya.forEach(t,(t=>{const r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",r).next((n=>ya.forEach(n,(n=>{Oo(n.userId===t.userId);const r=Jh(this.serializer,n);return Vd(e,t.userId,r).next((()=>{}))}))))}))))}ti(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next((e=>{const r=[];return n.J(((n,i)=>{const s=new ta(n),o=function(e){return[0,Oa(e)]}(s);r.push(t.get(o).next((n=>n?ya.resolve():(n=>t.put({targetId:0,path:Oa(n),sequenceNumber:e.highestListenSequenceNumber}))(s))))})).next((()=>ya.waitFor(r)))}))}ni(e,t){e.createObjectStore("collectionParents",{keyPath:Wa});const n=t.store("collectionParents"),r=new Nd,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:Oa(r)})}};return t.store("remoteDocuments").J({H:!0},((e,t)=>{const n=new ta(e);return i(n.popLast())})).next((()=>t.store("documentMutations").J({H:!0},(([e,t,n],r)=>{const s=Fa(t);return i(s.popLast())}))))}ri(e){const t=e.store("targets");return t.J(((e,n)=>{const r=Yh(n),i=Xh(this.serializer,r);return t.put(i)}))}ii(e,t){const n=t.store("remoteDocuments"),r=[];return n.J(((e,n)=>{const i=t.store("remoteDocumentsV14"),s=function(e){return e.document?new ia(ta.fromString(e.document.name).popFirst(5)):e.noDocument?ia.fromSegments(e.noDocument.path):e.unknownDocument?ia.fromSegments(e.unknownDocument.path):Po()}(n).path.toArray(),o={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(o))})).next((()=>ya.waitFor(r)))}si(e,t){const n=t.store("mutations"),r=of(this.serializer),i=new Tf(Sf.Hr,this.serializer.ct);return n.U().next((e=>{const n=new Map;return e.forEach((e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:ol();Jh(this.serializer,e).keys().forEach((e=>r=r.add(e))),n.set(e.userId,r)})),ya.forEach(n,((e,n)=>{const s=new So(n),o=od.lt(this.serializer,s),a=i.getIndexManager(s),c=Bd.lt(s,this.serializer,a,i.referenceDelegate);return new pf(r,c,o,a).recalculateAndSaveOverlaysForDocumentKeys(new cc(t,Da.oe),e).next()}))}))}}function Cf(e){e.createObjectStore("targetDocuments",{keyPath:$a}).createIndex("documentTargetsIndex",Ha,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Ka,{unique:!0}),e.createObjectStore("targetGlobal")}const Af="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Nf{constructor(e,t,n,r,i,s,o,a,c,u,l=16){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.oi=i,this.window=s,this.document=o,this._i=c,this.ai=u,this.ui=l,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=e=>Promise.resolve(),!Nf.D())throw new Fo(Mo.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new tf(this,r),this.Ti=t+"main",this.serializer=new Kh(a),this.Ei=new wa(this.Ti,this.ui,new kf(this.serializer)),this.Qr=new Hd(this.referenceDelegate,this.serializer),this.remoteDocumentCache=of(this.serializer),this.$r=new rd,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,!1===u&&Do("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Fo(Mo.FAILED_PRECONDITION,Af);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Qr.getHighestSequenceNumber(e)))})).then((e=>{this.kr=new Da(e,this._i)})).then((()=>{this.qr=!0})).catch((e=>(this.Ei&&this.Ei.close(),Promise.reject(e))))}fi(e){return this.Ii=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ei.L((async t=>{null===t.newVersion&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.oi.enqueueAndForget((async()=>{this.started&&await this.Ai()})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>Rf(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.gi(e).next((e=>{e||(this.isPrimary=!1,this.oi.enqueueRetryable((()=>this.Ii(!1))))}))})).next((()=>this.pi(e))).next((t=>this.isPrimary&&!t?this.yi(e).next((()=>!1)):!!t&&this.wi(e).next((()=>!0)))))).catch((e=>{if(Ta(e))return No("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return No("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.oi.enqueueRetryable((()=>this.Ii(e))),this.isPrimary=e}))}gi(e){return Df(e).get("owner").next((e=>ya.resolve(this.Si(e))))}bi(e){return Rf(e).delete(this.clientId)}async Di(){if(this.isPrimary&&!this.Ci(this.Pi,18e5)){this.Pi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=uc(e,"clientMetadata");return t.U().next((e=>{const n=this.vi(e,18e5),r=e.filter((e=>-1===n.indexOf(e)));return ya.forEach(r,(e=>t.delete(e.clientId))).next((()=>r))}))})).catch((()=>[]));if(this.di)for(const t of e)this.di.removeItem(this.Fi(t.clientId))}}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Ai().then((()=>this.Di())).then((()=>this.mi()))))}Si(e){return!!e&&e.ownerId===this.clientId}pi(e){return this.ai?ya.resolve(!0):Df(e).get("owner").next((t=>{if(null!==t&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)){if(this.Si(t)&&this.networkEnabled)return!0;if(!this.Si(t)){if(!t.allowTabSynchronization)throw new Fo(Mo.FAILED_PRECONDITION,Af);return!1}}return!(!this.networkEnabled||!this.inForeground)||Rf(e).U().next((e=>void 0===this.vi(e,5e3).find((e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&No("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.qr=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Oi(),this.Ni(),await this.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(e=>{const t=new cc(e,Da.oe);return this.yi(t).next((()=>this.bi(t)))})),this.Ei.close(),this.Li()}vi(e,t){return e.filter((e=>this.Ci(e.updateTimeMs,t)&&!this.Mi(e.clientId)))}Bi(){return this.runTransaction("getActiveClients","readonly",(e=>Rf(e).U().next((e=>this.vi(e,18e5).map((e=>e.clientId))))))}get started(){return this.qr}getMutationQueue(e,t){return Bd.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Rd(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return od.lt(this.serializer,e)}getBundleCache(){return this.$r}runTransaction(e,t,n){No("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",i=function(e){return 16===e?ac:15===e?oc:14===e?sc:13===e?ic:12===e?rc:11===e?nc:void Po()}(this.ui);let s;return this.Ei.runTransaction(e,r,i,(r=>(s=new cc(r,this.kr?this.kr.next():Da.oe),"readwrite-primary"===t?this.gi(s).next((e=>!!e||this.pi(s))).next((t=>{if(!t)throw Do(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.oi.enqueueRetryable((()=>this.Ii(!1))),new Fo(Mo.FAILED_PRECONDITION,pa);return n(s)})).next((e=>this.wi(s).next((()=>e)))):this.ki(s).next((()=>n(s)))))).then((e=>(s.raiseOnCommittedEvent(),e)))}ki(e){return Df(e).get("owner").next((e=>{if(null!==e&&this.Ci(e.leaseTimestampMs,5e3)&&!this.Mi(e.ownerId)&&!this.Si(e)&&!(this.ai||this.allowTabSynchronization&&e.allowTabSynchronization))throw new Fo(Mo.FAILED_PRECONDITION,Af)}))}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Df(e).put("owner",t)}static D(){return wa.D()}yi(e){const t=Df(e);return t.get("owner").next((e=>this.Si(e)?(No("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):ya.resolve()))}Ci(e,t){const n=Date.now();return!(e<n-t||e>n&&(Do(`Detected an update time that is in the future: ${e} > ${n}`),1))}Ri(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.li=()=>{this.oi.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.Ai())))},this.document.addEventListener("visibilitychange",this.li),this.inForeground="visible"===this.document.visibilityState)}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ci=()=>{this.xi();const e=/(?:Version|Mobile)\/1[456]/;_()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(e){var t;try{const n=null!==(null===(t=this.di)||void 0===t?void 0:t.getItem(this.Fi(e)));return No("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return Do("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(e){Do("Failed to set zombie client id.",e)}}Li(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch(e){}}Fi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Df(e){return uc(e,"owner")}function Rf(e){return uc(e,"clientMetadata")}function xf(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class Pf{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.qi=n,this.Qi=r}static Ki(e,t){let n=ol(),r=ol();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new Pf(e,t.fromCache,n,r)}}class Of{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Lf{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=_()?8:_a(f())>0?6:4}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.ji(e,t).next((e=>{i.result=e})).next((()=>{if(!i.result)return this.Hi(e,t,r,n).next((e=>{i.result=e}))})).next((()=>{if(i.result)return;const n=new Of;return this.Ji(e,t,n).next((r=>{if(i.result=r,this.Ui)return this.Yi(e,t,n,r.size)}))})).next((()=>i.result))}Yi(e,t,n,r){return n.documentReadCount<this.Wi?(Ao()<=q.DEBUG&&No("QueryEngine","SDK will not create cache indexes for query:",Gu(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),ya.resolve()):(Ao()<=q.DEBUG&&No("QueryEngine","Query:",Gu(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(Ao()<=q.DEBUG&&No("QueryEngine","The SDK decides to create cache indexes for query:",Gu(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Vu(t))):ya.resolve())}ji(e,t){if(Mu(t))return ya.resolve(null);let n=Vu(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=Bu(t,null,"F"),n=Vu(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=ol(...r);return this.zi.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.Zi(t,r);return this.Xi(t,s,i,n.readTime)?this.ji(e,Bu(t,null,"F")):this.es(e,s,t,n)}))))})))))}Hi(e,t,n,r){return Mu(t)||r.isEqual(Zo.min())?ya.resolve(null):this.zi.getDocuments(e,n).next((i=>{const s=this.Zi(t,i);return this.Xi(t,s,n,r)?ya.resolve(null):(Ao()<=q.DEBUG&&No("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Gu(t)),this.es(e,s,t,la(r,-1)).next((e=>e)))}))}Zi(e,t){let n=new gc(Hu(e));return t.forEach(((t,r)=>{Ku(e,r)&&(n=n.add(r))})),n}Xi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ji(e,t,n){return Ao()<=q.DEBUG&&No("QueryEngine","Using full collection scan to execute query:",Gu(t)),this.zi.getDocumentsMatchingQuery(e,t,da.min(),n)}es(e,t,n,r){return this.zi.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class Mf{constructor(e,t,n,r){this.persistence=e,this.ts=t,this.serializer=r,this.ns=new fc(Qo),this.rs=new Qu((e=>Cu(e)),Au),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(n)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new pf(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.ns)))}}function Ff(e,t,n,r){return new Mf(e,t,n,r)}async function Uf(e,t){const n=Lo(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n._s(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let o=ol();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({us:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function Vf(e){const t=Lo(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Qr.getLastRemoteSnapshotVersion(e)))}function qf(e,t,n){let r=ol(),i=ol();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=Yu();return n.forEach(((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(Zo.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):No("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{cs:r,ls:i}}))}function Bf(e,t){const n=Lo(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function jf(e,t){const n=Lo(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Qr.getTargetData(e,t).next((i=>i?(r=i,ya.resolve(r)):n.Qr.allocateTargetId(e).next((i=>(r=new Gh(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Qr.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.ns.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ns=n.ns.insert(e.targetId,e),n.rs.set(t,e.targetId)),e}))}async function zf(e,t,n){const r=Lo(e),i=r.ns.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!Ta(e))throw e;No("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.ns=r.ns.remove(t),r.rs.delete(i.target)}function Gf(e,t,n){const r=Lo(e);let i=Zo.min(),s=ol();return r.persistence.runTransaction("Execute query","readwrite",(e=>function(e,t,n){const r=Lo(e),i=r.rs.get(n);return void 0!==i?ya.resolve(r.ns.get(i)):r.Qr.getTargetData(t,n)}(r,e,Vu(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.ts.getDocumentsMatchingQuery(e,t,n?i:Zo.min(),n?s:ol()))).next((e=>(Hf(r,$u(t),e),{documents:e,hs:s})))))}function Kf(e,t){const n=Lo(e),r=Lo(n.Qr),i=n.ns.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(e=>r.ot(e,t).next((e=>e?e.target:null))))}function $f(e,t){const n=Lo(e),r=n.ss.get(t)||Zo.min();return n.persistence.runTransaction("Get new document changes","readonly",(e=>n.os.getAllFromCollectionGroup(e,t,la(r,-1),Number.MAX_SAFE_INTEGER))).then((e=>(Hf(n,t,e),e)))}function Hf(e,t,n){let r=e.ss.get(t)||Zo.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.ss.set(t,r)}async function Wf(e,t,n=ol()){const r=await jf(e,Vu(Zh(t.bundledQuery))),i=Lo(e);return i.persistence.runTransaction("Save named query","readwrite",(e=>{const s=vh(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return i.$r.saveNamedQuery(e,t);const o=r.withResumeToken(Ic.EMPTY_BYTE_STRING,s);return i.ns=i.ns.insert(o.targetId,o),i.Qr.updateTargetData(e,o).next((()=>i.Qr.removeMatchingKeysForTargetId(e,r.targetId))).next((()=>i.Qr.addMatchingKeys(e,n,r.targetId))).next((()=>i.$r.saveNamedQuery(e,t)))}))}function Qf(e,t){return`firestore_clients_${e}_${t}`}function Jf(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function Yf(e,t){return`firestore_targets_${e}_${t}`}class Xf{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Es(e,t,n){const r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new Fo(r.error.code,r.error.message))),s?new Xf(e,t,r.state,i):(Do("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}ds(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Zf{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Es(e,t){const n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new Fo(n.error.code,n.error.message))),i?new Zf(e,n.state,r):(Do("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}ds(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ep{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Es(e,t){const n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=cl();for(let e=0;r&&e<n.activeTargetIds.length;++e)r=Pa(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new ep(e,i):(Do("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class tp{constructor(e,t){this.clientId=e,this.onlineState=t}static Es(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new tp(t.clientId,t.onlineState):(Do("SharedClientState",`Failed to parse online state: ${e}`),null)}}class np{constructor(){this.activeTargetIds=cl()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class rp{constructor(e,t,n,r,i){this.window=e,this.oi=t,this.persistenceKey=n,this.Vs=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new fc(Qo),this.started=!1,this.ys=[];const s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ws=Qf(this.persistenceKey,this.Vs),this.Ss=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.ps=this.ps.insert(this.Vs,new np),this.bs=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.Ds=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.Cs=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.vs=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this.Fs=function(e){return`firestore_bundle_loaded_v2_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Bi();for(const t of e){if(t===this.Vs)continue;const e=this.getItem(Qf(this.persistenceKey,t));if(e){const n=ep.Es(t,e);n&&(this.ps=this.ps.insert(n.clientId,n))}}this.Ms();const t=this.storage.getItem(this.vs);if(t){const e=this.xs(t);e&&this.Os(e)}for(const e of this.ys)this.gs(e);this.ys=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ss,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(e){let t=!1;return this.ps.forEach(((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.Ls(e,"pending")}updateMutationState(e,t,n){this.Ls(e,t,n),this.Bs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(Yf(this.persistenceKey,e));if(n){const r=Zf.Es(e,n);r&&(t=r.state)}}return this.ks.As(e),this.Ms(),t}removeLocalQueryTarget(e){this.ks.Rs(e),this.Ms()}isLocalQueryTarget(e){return this.ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Yf(this.persistenceKey,e))}updateQueryState(e,t,n){this.qs(e,t,n)}handleUserChange(e,t,n){t.forEach((e=>{this.Bs(e)})),this.currentUser=e,n.forEach((e=>{this.addPendingMutation(e)}))}setOnlineState(e){this.Qs(e)}notifyBundleLoaded(e){this.Ks(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return No("SharedClientState","READ",e,t),t}setItem(e,t){No("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){No("SharedClientState","REMOVE",e),this.storage.removeItem(e)}gs(e){const t=e;if(t.storageArea===this.storage){if(No("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ws)return void Do("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable((async()=>{if(this.started){if(null!==t.key)if(this.bs.test(t.key)){if(null==t.newValue){const e=this.$s(t.key);return this.Us(e,null)}{const e=this.Ws(t.key,t.newValue);if(e)return this.Us(e.clientId,e)}}else if(this.Ds.test(t.key)){if(null!==t.newValue){const e=this.Gs(t.key,t.newValue);if(e)return this.zs(e)}}else if(this.Cs.test(t.key)){if(null!==t.newValue){const e=this.js(t.key,t.newValue);if(e)return this.Hs(e)}}else if(t.key===this.vs){if(null!==t.newValue){const e=this.xs(t.newValue);if(e)return this.Os(e)}}else if(t.key===this.Ss){const e=function(e){let t=Da.oe;if(null!=e)try{const n=JSON.parse(e);Oo("number"==typeof n),t=n}catch(e){Do("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(t.newValue);e!==Da.oe&&this.sequenceNumberHandler(e)}else if(t.key===this.Fs){const e=this.Js(t.newValue);await Promise.all(e.map((e=>this.syncEngine.Ys(e))))}}else this.ys.push(t)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Ls(e,t,n){const r=new Xf(this.currentUser,e,t,n),i=Jf(this.persistenceKey,this.currentUser,e);this.setItem(i,r.ds())}Bs(e){const t=Jf(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Qs(e){const t={clientId:this.Vs,onlineState:e};this.storage.setItem(this.vs,JSON.stringify(t))}qs(e,t,n){const r=Yf(this.persistenceKey,e),i=new Zf(e,t,n);this.setItem(r,i.ds())}Ks(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Fs,t)}$s(e){const t=this.bs.exec(e);return t?t[1]:null}Ws(e,t){const n=this.$s(e);return ep.Es(n,t)}Gs(e,t){const n=this.Ds.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Xf.Es(new So(i),r,t)}js(e,t){const n=this.Cs.exec(e),r=Number(n[1]);return Zf.Es(r,t)}xs(e){return tp.Es(e)}Js(e){return JSON.parse(e)}async zs(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Zs(e.batchId,e.state,e.error);No("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Hs(e){return this.syncEngine.Xs(e.targetId,e.state,e.error)}Us(e,t){const n=t?this.ps.insert(e,t):this.ps.remove(e),r=this.Ns(this.ps),i=this.Ns(n),s=[],o=[];return i.forEach((e=>{r.has(e)||s.push(e)})),r.forEach((e=>{i.has(e)||o.push(e)})),this.syncEngine.eo(s,o).then((()=>{this.ps=n}))}Os(e){this.ps.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ns(e){let t=cl();return e.forEach(((e,n)=>{t=t.unionWith(n.activeTargetIds)})),t}}class ip{constructor(){this.no=new np,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,n){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new np,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class sp{io(e){}shutdown(){}}class op{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){No("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.uo)e(0)}ao(){No("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.uo)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let ap=null;function cp(){return null===ap?ap=268435456+Math.round(2147483648*Math.random()):ap++,"0x"+ap.toString(16)}const up={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class lp{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}Ao(e){this.Ro=e}onMessage(e){this.Vo=e}close(){this.ho()}send(e){this.lo(e)}mo(){this.Io()}fo(){this.Eo()}po(e){this.Ro(e)}yo(e){this.Vo(e)}}const hp="WebChannelConnection";class dp extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.wo=t+"://"+e.host,this.So=`projects/${n}/databases/${r}`,this.bo="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get Do(){return!1}Co(e,t,n,r,i){const s=cp(),o=this.vo(e,t.toUriEncodedString());No("RestConnection",`Sending RPC '${e}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.So,"x-goog-request-params":this.bo};return this.Fo(a,r,i),this.Mo(e,o,a,n).then((t=>(No("RestConnection",`Received RPC '${e}' ${s}: `,t),t)),(t=>{throw Ro("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t}))}xo(e,t,n,r,i,s){return this.Co(e,t,n,r,i)}Fo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+ko,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}vo(e,t){const n=up[e];return`${this.wo}/v1/${t}:${n}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Mo(e,t,n,r){const i=cp();return new Promise(((s,o)=>{const a=new fo;a.setWithCredentials(!0),a.listenOnce(go.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case yo.NO_ERROR:const t=a.getResponseJson();No(hp,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case yo.TIMEOUT:No(hp,`RPC '${e}' ${i} timed out`),o(new Fo(Mo.DEADLINE_EXCEEDED,"Request time out"));break;case yo.HTTP_ERROR:const n=a.getStatus();if(No(hp,`RPC '${e}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Mo).indexOf(t)>=0?t:Mo.UNKNOWN}(t.status);o(new Fo(e,t.message))}else o(new Fo(Mo.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Fo(Mo.UNAVAILABLE,"Connection failed."));break;default:Po()}}finally{No(hp,`RPC '${e}' ${i} completed.`)}}));const c=JSON.stringify(r);No(hp,`RPC '${e}' ${i} sending request:`,r),a.send(t,"POST",c,n,15)}))}Oo(e,t,n){const r=cp(),i=[this.wo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=Io(),o=_o(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.xmlHttpFactory=new po({})),this.Fo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const u=i.join("");No(hp,`Creating RPC '${e}' stream ${r}: ${u}`,a);const l=s.createWebChannel(u,a);let h=!1,d=!1;const f=new lp({lo:t=>{d?No(hp,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(h||(No(hp,`Opening RPC '${e}' stream ${r} transport.`),l.open(),h=!0),No(hp,`RPC '${e}' stream ${r} sending:`,t),l.send(t))},ho:()=>l.close()}),p=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return p(l,mo.EventType.OPEN,(()=>{d||(No(hp,`RPC '${e}' stream ${r} transport opened.`),f.mo())})),p(l,mo.EventType.CLOSE,(()=>{d||(d=!0,No(hp,`RPC '${e}' stream ${r} transport closed`),f.po())})),p(l,mo.EventType.ERROR,(t=>{d||(d=!0,Ro(hp,`RPC '${e}' stream ${r} transport errored:`,t),f.po(new Fo(Mo.UNAVAILABLE,"The operation could not be completed")))})),p(l,mo.EventType.MESSAGE,(t=>{var n;if(!d){const i=t.data[0];Oo(!!i);const s=i,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){No(hp,`RPC '${e}' stream ${r} received error:`,o);const t=o.status;let n=function(e){const t=Kl[e];if(void 0!==t)return Wl(t)}(t),i=o.message;void 0===n&&(n=Mo.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),d=!0,f.po(new Fo(n,i)),l.close()}else No(hp,`RPC '${e}' stream ${r} received:`,i),f.yo(i)}})),p(o,wo.STAT_EVENT,(t=>{t.stat===vo.PROXY?No(hp,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===vo.NOPROXY&&No(hp,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.fo()}),0),f}}function fp(){return"undefined"!=typeof window?window:null}function pp(){return"undefined"!=typeof document?document:null}function mp(e){return new fh(e,!0)}class gp{constructor(e,t,n=1e3,r=1.5,i=6e4){this.oi=e,this.timerId=t,this.No=n,this.Lo=r,this.Bo=i,this.ko=0,this.qo=null,this.Qo=Date.now(),this.reset()}reset(){this.ko=0}Ko(){this.ko=this.Bo}$o(e){this.cancel();const t=Math.floor(this.ko+this.Uo()),n=Math.max(0,Date.now()-this.Qo),r=Math.max(0,t-n);r>0&&No("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.qo=this.oi.enqueueAfterDelay(this.timerId,r,(()=>(this.Qo=Date.now(),e()))),this.ko*=this.Lo,this.ko<this.No&&(this.ko=this.No),this.ko>this.Bo&&(this.ko=this.Bo)}Wo(){null!==this.qo&&(this.qo.skipDelay(),this.qo=null)}cancel(){null!==this.qo&&(this.qo.cancel(),this.qo=null)}Uo(){return(Math.random()-.5)*this.ko}}class yp{constructor(e,t,n,r,i,s,o,a){this.oi=e,this.Go=n,this.zo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.jo=0,this.Ho=null,this.Jo=null,this.stream=null,this.Yo=new gp(e,t)}Zo(){return 1===this.state||5===this.state||this.Xo()}Xo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.e_()}async stop(){this.Zo()&&await this.close(0)}t_(){this.state=0,this.Yo.reset()}n_(){this.Xo()&&null===this.Ho&&(this.Ho=this.oi.enqueueAfterDelay(this.Go,6e4,(()=>this.r_())))}i_(e){this.s_(),this.stream.send(e)}async r_(){if(this.Xo())return this.close(0)}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}o_(){this.Jo&&(this.Jo.cancel(),this.Jo=null)}async close(e,t){this.s_(),this.o_(),this.Yo.cancel(),this.jo++,4!==e?this.Yo.reset():t&&t.code===Mo.RESOURCE_EXHAUSTED?(Do(t.toString()),Do("Using maximum backoff delay to prevent overloading the backend."),this.Yo.Ko()):t&&t.code===Mo.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.__(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Ao(t)}__(){}auth(){this.state=1;const e=this.a_(this.jo),t=this.jo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.jo===t&&this.u_(e,n)}),(t=>{e((()=>{const e=new Fo(Mo.UNKNOWN,"Fetching auth token failed: "+t.message);return this.c_(e)}))}))}u_(e,t){const n=this.a_(this.jo);this.stream=this.l_(e,t),this.stream.Po((()=>{n((()=>this.listener.Po()))})),this.stream.To((()=>{n((()=>(this.state=2,this.Jo=this.oi.enqueueAfterDelay(this.zo,1e4,(()=>(this.Xo()&&(this.state=3),Promise.resolve()))),this.listener.To())))})),this.stream.Ao((e=>{n((()=>this.c_(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}e_(){this.state=5,this.Yo.$o((async()=>{this.state=0,this.start()}))}c_(e){return No("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}a_(e){return t=>{this.oi.enqueueAndForget((()=>this.jo===e?t():(No("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class vp extends yp{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}l_(e,t){return this.connection.Oo("Listen",e,t)}onMessage(e){this.Yo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Po()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(Oo(void 0===t||"string"==typeof t),Ic.fromBase64String(t||"")):(Oo(void 0===t||t instanceof Buffer||t instanceof Uint8Array),Ic.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?Mo.UNKNOWN:Wl(e.code);return new Fo(t,e.message||"")}(o);n=new sh(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=Th(e,r.document.name),s=vh(r.document.updateTime),o=r.document.createTime?vh(r.document.createTime):Zo.min(),a=new Xc({mapValue:{fields:r.document.fields}}),c=eu.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new rh(u,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=Th(e,r.document),s=r.readTime?vh(r.readTime):Zo.min(),o=eu.newNoDocument(i,s),a=r.removedTargetIds||[];n=new rh([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=Th(e,r.document),s=r.removedTargetIds||[];n=new rh([],s,i,null)}else{if(!("filter"in t))return Po();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new Gl(r,i),o=e.targetId;n=new ih(o,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return Zo.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Zo.min():t.readTime?vh(t.readTime):Zo.min()}(e);return this.listener.h_(t,n)}P_(e){const t={};t.database=kh(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=Nu(r)?{documents:xh(e,r)}:{query:Ph(e,r)._t},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=gh(e,t.resumeToken);const r=ph(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(Zo.min())>0){n.readTime=mh(e,t.snapshotVersion.toTimestamp());const r=ph(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Po()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.i_(t)}I_(e){const t={};t.database=kh(this.serializer),t.removeTarget=e,this.i_(t)}}class wp extends yp{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i,this.T_=!1}get E_(){return this.T_}start(){this.T_=!1,this.lastStreamToken=void 0,super.start()}__(){this.T_&&this.d_([])}l_(e,t){return this.connection.Oo("Write",e,t)}onMessage(e){if(Oo(!!e.streamToken),this.lastStreamToken=e.streamToken,this.T_){this.Yo.reset();const t=function(e,t){return e&&e.length>0?(Oo(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?vh(e.updateTime):vh(t);return n.isEqual(Zo.min())&&(n=vh(t)),new Sl(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=vh(e.commitTime);return this.listener.A_(n,t)}return Oo(!e.writeResults||0===e.writeResults.length),this.T_=!0,this.listener.R_()}V_(){const e={};e.database=kh(this.serializer),this.i_(e)}d_(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>Dh(this.serializer,e)))};this.i_(t)}}class _p extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.m_=!1}f_(){if(this.m_)throw new Fo(Mo.FAILED_PRECONDITION,"The client has already been terminated.")}Co(e,t,n,r){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.Co(e,_h(t,n),r,i,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Mo.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Fo(Mo.UNKNOWN,e.toString())}))}xo(e,t,n,r,i){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,o])=>this.connection.xo(e,_h(t,n),r,s,o,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Mo.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Fo(Mo.UNKNOWN,e.toString())}))}terminate(){this.m_=!0,this.connection.terminate()}}class Ip{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){0===this.g_&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve()))))}D_(e){"Online"===this.state?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.S_("Offline")))}set(e){this.C_(),this.g_=0,"Online"===e&&(this.y_=!1),this.S_(e)}S_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}b_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(Do(t),this.y_=!1):No("OnlineStateTracker",t)}C_(){null!==this.p_&&(this.p_.cancel(),this.p_=null)}}class bp{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=i,this.O_.io((e=>{n.enqueueAndForget((async()=>{Rp(this)&&(No("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=Lo(e);t.M_.add(4),await Ep(t),t.N_.set("Unknown"),t.M_.delete(4),await Tp(t)}(this))}))})),this.N_=new Ip(n,r)}}async function Tp(e){if(Rp(e))for(const t of e.x_)await t(!0)}async function Ep(e){for(const t of e.x_)await t(!1)}function Sp(e,t){const n=Lo(e);n.F_.has(t.targetId)||(n.F_.set(t.targetId,t),Dp(n)?Np(n):Jp(n).Xo()&&Cp(n,t))}function kp(e,t){const n=Lo(e),r=Jp(n);n.F_.delete(t),r.Xo()&&Ap(n,t),0===n.F_.size&&(r.Xo()?r.n_():Rp(n)&&n.N_.set("Unknown"))}function Cp(e,t){if(e.L_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Zo.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Jp(e).P_(t)}function Ap(e,t){e.L_.xe(t),Jp(e).I_(t)}function Np(e){e.L_=new ah({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>e.F_.get(t)||null,tt:()=>e.datastore.serializer.databaseId}),Jp(e).start(),e.N_.w_()}function Dp(e){return Rp(e)&&!Jp(e).Zo()&&e.F_.size>0}function Rp(e){return 0===Lo(e).M_.size}function xp(e){e.L_=void 0}async function Pp(e){e.N_.set("Online")}async function Op(e){e.F_.forEach(((t,n)=>{Cp(e,t)}))}async function Lp(e,t){xp(e),Dp(e)?(e.N_.D_(t),Np(e)):e.N_.set("Unknown")}async function Mp(e,t,n){if(e.N_.set("Online"),t instanceof sh&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.F_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.F_.delete(r),e.L_.removeTarget(r))}(e,t)}catch(n){No("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await Fp(e,n)}else if(t instanceof rh?e.L_.Ke(t):t instanceof ih?e.L_.He(t):e.L_.We(t),!n.isEqual(Zo.min()))try{const t=await Vf(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.L_.rt(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.F_.get(r);i&&e.F_.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.F_.get(t);if(!r)return;e.F_.set(t,r.withResumeToken(Ic.EMPTY_BYTE_STRING,r.snapshotVersion)),Ap(e,t);const i=new Gh(r.target,t,n,r.sequenceNumber);Cp(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){No("RemoteStore","Failed to raise snapshot:",t),await Fp(e,t)}}async function Fp(e,t,n){if(!Ta(t))throw t;e.M_.add(1),await Ep(e),e.N_.set("Offline"),n||(n=()=>Vf(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{No("RemoteStore","Retrying IndexedDB access"),await n(),e.M_.delete(1),await Tp(e)}))}function Up(e,t){return t().catch((n=>Fp(e,n,t)))}async function Vp(e){const t=Lo(e),n=Yp(t);let r=t.v_.length>0?t.v_[t.v_.length-1].batchId:-1;for(;qp(t);)try{const e=await Bf(t.localStore,r);if(null===e){0===t.v_.length&&n.n_();break}r=e.batchId,Bp(t,e)}catch(e){await Fp(t,e)}jp(t)&&zp(t)}function qp(e){return Rp(e)&&e.v_.length<10}function Bp(e,t){e.v_.push(t);const n=Yp(e);n.Xo()&&n.E_&&n.d_(t.mutations)}function jp(e){return Rp(e)&&!Yp(e).Zo()&&e.v_.length>0}function zp(e){Yp(e).start()}async function Gp(e){Yp(e).V_()}async function Kp(e){const t=Yp(e);for(const n of e.v_)t.d_(n.mutations)}async function $p(e,t,n){const r=e.v_.shift(),i=jl.from(r,t,n);await Up(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await Vp(e)}async function Hp(e,t){t&&Yp(e).E_&&await async function(e,t){if(function(e){return Hl(e)&&e!==Mo.ABORTED}(t.code)){const n=e.v_.shift();Yp(e).t_(),await Up(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await Vp(e)}}(e,t),jp(e)&&zp(e)}async function Wp(e,t){const n=Lo(e);n.asyncQueue.verifyOperationInProgress(),No("RemoteStore","RemoteStore received new credentials");const r=Rp(n);n.M_.add(3),await Ep(n),r&&n.N_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.M_.delete(3),await Tp(n)}async function Qp(e,t){const n=Lo(e);t?(n.M_.delete(2),await Tp(n)):t||(n.M_.add(2),await Ep(n),n.N_.set("Unknown"))}function Jp(e){return e.B_||(e.B_=function(e,t,n){const r=Lo(e);return r.f_(),new vp(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Po:Pp.bind(null,e),To:Op.bind(null,e),Ao:Lp.bind(null,e),h_:Mp.bind(null,e)}),e.x_.push((async t=>{t?(e.B_.t_(),Dp(e)?Np(e):e.N_.set("Unknown")):(await e.B_.stop(),xp(e))}))),e.B_}function Yp(e){return e.k_||(e.k_=function(e,t,n){const r=Lo(e);return r.f_(),new wp(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Po:()=>Promise.resolve(),To:Gp.bind(null,e),Ao:Hp.bind(null,e),R_:Kp.bind(null,e),A_:$p.bind(null,e)}),e.x_.push((async t=>{t?(e.k_.t_(),await Vp(e)):(await e.k_.stop(),e.v_.length>0&&(No("RemoteStore",`Stopping write stream with ${e.v_.length} pending writes`),e.v_=[]))}))),e.k_}class Xp{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Uo,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new Xp(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Fo(Mo.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Zp(e,t){if(Do("AsyncQueue",`${t}: ${e}`),Ta(e))return new Fo(Mo.UNAVAILABLE,`${t}: ${e}`);throw e}class em{constructor(e){this.comparator=e?(t,n)=>e(t,n)||ia.comparator(t.key,n.key):(e,t)=>ia.comparator(e.key,t.key),this.keyedMap=Zu(),this.sortedSet=new fc(this.comparator)}static emptySet(e){return new em(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof em))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new em;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class tm{constructor(){this.q_=new fc(ia.comparator)}track(e){const t=e.doc.key,n=this.q_.get(t);n?0!==e.type&&3===n.type?this.q_=this.q_.insert(t,e):3===e.type&&1!==n.type?this.q_=this.q_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.q_=this.q_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.q_=this.q_.remove(t):1===e.type&&2===n.type?this.q_=this.q_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):Po():this.q_=this.q_.insert(t,e)}Q_(){const e=[];return this.q_.inorderTraversal(((t,n)=>{e.push(n)})),e}}class nm{constructor(e,t,n,r,i,s,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new nm(e,t,em.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ju(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class rm{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some((e=>e.G_()))}}class im{constructor(){this.queries=new Qu((e=>zu(e)),ju),this.onlineState="Unknown",this.z_=new Set}}async function sm(e,t){const n=Lo(e);let r=3;const i=t.query;let s=n.queries.get(i);s?!s.W_()&&t.G_()&&(r=2):(s=new rm,r=t.G_()?0:1);try{switch(r){case 0:s.K_=await n.onListen(i,!0);break;case 1:s.K_=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(e){const n=Zp(e,`Initialization of query '${Gu(t.query)}' failed`);return void t.onError(n)}n.queries.set(i,s),s.U_.push(t),t.j_(n.onlineState),s.K_&&t.H_(s.K_)&&um(n)}async function om(e,t){const n=Lo(e),r=t.query;let i=3;const s=n.queries.get(r);if(s){const e=s.U_.indexOf(t);e>=0&&(s.U_.splice(e,1),0===s.U_.length?i=t.G_()?0:1:!s.W_()&&t.G_()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function am(e,t){const n=Lo(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.U_)t.H_(e)&&(r=!0);i.K_=e}}r&&um(n)}function cm(e,t,n){const r=Lo(e),i=r.queries.get(t);if(i)for(const e of i.U_)e.onError(n);r.queries.delete(t)}function um(e){e.z_.forEach((e=>{e.next()}))}var lm,hm;(hm=lm||(lm={})).J_="default",hm.Cache="cache";class dm{constructor(e,t,n){this.query=e,this.Y_=t,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=n||{}}H_(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new nm(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),t=!0):this.ta(e,this.onlineState)&&(this.na(e),t=!0),this.X_=e,t}onError(e){this.Y_.error(e)}j_(e){this.onlineState=e;let t=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),t=!0),t}ta(e,t){if(!e.fromCache)return!0;if(!this.G_())return!0;const n="Offline"!==t;return(!this.options.ra||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ea(e){if(e.docChanges.length>0)return!0;const t=this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}na(e){e=nm.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}G_(){return this.options.source!==lm.Cache}}class fm{constructor(e,t){this.ia=e,this.byteLength=t}sa(){return"metadata"in this.ia}}class pm{constructor(e){this.serializer=e}Ps(e){return Th(this.serializer,e)}Is(e){return e.metadata.exists?Nh(this.serializer,e.document,!1):eu.newNoDocument(this.Ps(e.metadata.name),this.Ts(e.metadata.readTime))}Ts(e){return vh(e)}}class mm{constructor(e,t,n){this.oa=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=gm(e)}_a(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ia.namedQuery)this.queries.push(e.ia.namedQuery);else if(e.ia.documentMetadata){this.documents.push({metadata:e.ia.documentMetadata}),e.ia.documentMetadata.exists||++t;const n=ta.fromString(e.ia.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.ia.document&&(this.documents[this.documents.length-1].document=e.ia.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}aa(e){const t=new Map,n=new pm(this.serializer);for(const r of e)if(r.metadata.queries){const e=n.Ps(r.metadata.name);for(const n of r.metadata.queries){const r=(t.get(n)||ol()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=Lo(e);let s=ol(),o=Yu();for(const e of n){const n=t.Ps(e.metadata.name);e.document&&(s=s.add(n));const r=t.Is(e);r.setReadTime(t.Ts(e.metadata.readTime)),o=o.insert(n,r)}const a=i.os.newChangeBuffer({trackRemovals:!0}),c=await jf(i,function(e){return Vu(Lu(ta.fromString(`__bundle__/docs/${e}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",(e=>qf(e,a,o).next((t=>(a.apply(e),t))).next((t=>i.Qr.removeMatchingKeysForTargetId(e,c.targetId).next((()=>i.Qr.addMatchingKeys(e,s,c.targetId))).next((()=>i.localDocuments.getLocalViewOfDocuments(e,t.cs,t.ls))).next((()=>t.cs))))))}(this.localStore,new pm(this.serializer),this.documents,this.oa.id),t=this.aa(this.documents);for(const e of this.queries)await Wf(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,ua:this.collectionGroups,ca:e}}}function gm(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class ym{constructor(e){this.key=e}}class vm{constructor(e){this.key=e}}class wm{constructor(e,t){this.query=e,this.la=t,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=ol(),this.mutatedKeys=ol(),this.Ia=Hu(e),this.Ta=new em(this.Ia)}get Ea(){return this.la}da(e,t){const n=t?t.Aa:new tm,r=t?t.Ta:this.Ta;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),l=Ku(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.Ra(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.Ia(l,a)>0||c&&this.Ia(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Ta:s,Aa:n,Xi:o,mutatedKeys:i}}Ra(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;const s=e.Aa.Q_();s.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Po()}};return n(e)-n(t)}(e.type,t.type)||this.Ia(e.doc,t.doc))),this.Va(n),r=null!=r&&r;const o=t&&!r?this.ma():[],a=0===this.Pa.size&&this.current&&!r?1:0,c=a!==this.ha;return this.ha=a,0!==s.length||c?{snapshot:new nm(this.query,e.Ta,i,s,e.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),fa:o}:{fa:o}}j_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new tm,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{fa:[]}}ga(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}Va(e){e&&(e.addedDocuments.forEach((e=>this.la=this.la.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.la=this.la.delete(e))),this.current=e.current)}ma(){if(!this.current)return[];const e=this.Pa;this.Pa=ol(),this.Ta.forEach((e=>{this.ga(e.key)&&(this.Pa=this.Pa.add(e.key))}));const t=[];return e.forEach((e=>{this.Pa.has(e)||t.push(new vm(e))})),this.Pa.forEach((n=>{e.has(n)||t.push(new ym(n))})),t}pa(e){this.la=e.hs,this.Pa=ol();const t=this.da(e.documents);return this.applyChanges(t,!0)}ya(){return nm.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,0===this.ha,this.hasCachedResults)}}class _m{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Im{constructor(e){this.key=e,this.wa=!1}}class bm{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Sa={},this.ba=new Qu((e=>zu(e)),ju),this.Da=new Map,this.Ca=new Set,this.va=new fc(ia.comparator),this.Fa=new Map,this.Ma=new yf,this.xa={},this.Oa=new Map,this.Na=$d.Ln(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return!0===this.La}}async function Tm(e,t,n=!0){const r=Xm(e);let i;const s=r.ba.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ya()):i=await Sm(r,t,n,!0),i}async function Em(e,t){const n=Xm(e);await Sm(n,t,!0,!1)}async function Sm(e,t,n,r){const i=await jf(e.localStore,Vu(t)),s=i.targetId,o=n?e.sharedClientState.addLocalQueryTarget(s):"not-current";let a;return r&&(a=await km(e,t,s,"current"===o,i.resumeToken)),e.isPrimaryClient&&n&&Sp(e.remoteStore,i),a}async function km(e,t,n,r,i){e.Ba=(t,n,r)=>async function(e,t,n,r){let i=t.view.da(n);i.Xi&&(i=await Gf(e.localStore,t.query,!1).then((({documents:e})=>t.view.da(e,i))));const s=r&&r.targetChanges.get(t.targetId),o=r&&null!=r.targetMismatches.get(t.targetId),a=t.view.applyChanges(i,e.isPrimaryClient,s,o);return Um(e,t.targetId,a.fa),a.snapshot}(e,t,n,r);const s=await Gf(e.localStore,t,!0),o=new wm(t,s.hs),a=o.da(s.documents),c=nh.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(a,e.isPrimaryClient,c);Um(e,n,u.fa);const l=new _m(t,n,o);return e.ba.set(t,l),e.Da.has(n)?e.Da.get(n).push(t):e.Da.set(n,[t]),u.snapshot}async function Cm(e,t,n){const r=Lo(e),i=r.ba.get(t),s=r.Da.get(i.targetId);if(s.length>1)return r.Da.set(i.targetId,s.filter((e=>!ju(e,t)))),void r.ba.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await zf(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&kp(r.remoteStore,i.targetId),Mm(r,i.targetId)})).catch(ga)):(Mm(r,i.targetId),await zf(r.localStore,i.targetId,!0))}async function Am(e,t){const n=Lo(e),r=n.ba.get(t),i=n.Da.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),kp(n.remoteStore,r.targetId))}async function Nm(e,t){const n=Lo(e);try{const e=await function(e,t){const n=Lo(e),r=t.snapshotVersion;let i=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.os.newChangeBuffer({trackRemovals:!0});i=n.ns;const o=[];t.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Qr.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.Qr.addMatchingKeys(e,s.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(Ic.EMPTY_BYTE_STRING,Zo.min()).withLastLimboFreeSnapshotVersion(Zo.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Qr.updateTargetData(e,u))}));let a=Yu(),c=ol();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(qf(e,s,t.documentUpdates).next((e=>{a=e.cs,c=e.ls}))),!r.isEqual(Zo.min())){const t=n.Qr.getLastRemoteSnapshotVersion(e).next((t=>n.Qr.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return ya.waitFor(o).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.ns=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.Fa.get(t);r&&(Oo(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.wa=!0:e.modifiedDocuments.size>0?Oo(r.wa):e.removedDocuments.size>0&&(Oo(r.wa),r.wa=!1))})),await Bm(n,e,t)}catch(e){await ga(e)}}function Dm(e,t,n){const r=Lo(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.ba.forEach(((n,r)=>{const i=r.view.j_(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=Lo(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.U_)e.j_(t)&&(r=!0)})),r&&um(n)}(r.eventManager,t),e.length&&r.Sa.h_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Rm(e,t,n){const r=Lo(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Fa.get(t),s=i&&i.key;if(s){let e=new fc(ia.comparator);e=e.insert(s,eu.newNoDocument(s,Zo.min()));const n=ol().add(s),i=new th(Zo.min(),new Map,new fc(Qo),e,n);await Nm(r,i),r.va=r.va.remove(s),r.Fa.delete(t),qm(r)}else await zf(r.localStore,t,!1).then((()=>Mm(r,t,n))).catch(ga)}async function xm(e,t){const n=Lo(e),r=t.batch.batchId;try{const e=await function(e,t){const n=Lo(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.os.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=ya.resolve();return s.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);Oo(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=ol();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);Lm(n,r,null),Om(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Bm(n,e)}catch(e){await ga(e)}}async function Pm(e,t,n){const r=Lo(e);try{const e=await function(e,t){const n=Lo(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(Oo(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);Lm(r,t,n),Om(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Bm(r,e)}catch(n){await ga(n)}}function Om(e,t){(e.Oa.get(t)||[]).forEach((e=>{e.resolve()})),e.Oa.delete(t)}function Lm(e,t,n){const r=Lo(e);let i=r.xa[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.xa[r.currentUser.toKey()]=i}}function Mm(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Da.get(t))e.ba.delete(r),n&&e.Sa.ka(r,n);e.Da.delete(t),e.isPrimaryClient&&e.Ma.Vr(t).forEach((t=>{e.Ma.containsKey(t)||Fm(e,t)}))}function Fm(e,t){e.Ca.delete(t.path.canonicalString());const n=e.va.get(t);null!==n&&(kp(e.remoteStore,n),e.va=e.va.remove(t),e.Fa.delete(n),qm(e))}function Um(e,t,n){for(const r of n)r instanceof ym?(e.Ma.addReference(r.key,t),Vm(e,r)):r instanceof vm?(No("SyncEngine","Document no longer in limbo: "+r.key),e.Ma.removeReference(r.key,t),e.Ma.containsKey(r.key)||Fm(e,r.key)):Po()}function Vm(e,t){const n=t.key,r=n.path.canonicalString();e.va.get(n)||e.Ca.has(r)||(No("SyncEngine","New document in limbo: "+n),e.Ca.add(r),qm(e))}function qm(e){for(;e.Ca.size>0&&e.va.size<e.maxConcurrentLimboResolutions;){const t=e.Ca.values().next().value;e.Ca.delete(t);const n=new ia(ta.fromString(t)),r=e.Na.next();e.Fa.set(r,new Im(n)),e.va=e.va.insert(n,r),Sp(e.remoteStore,new Gh(Vu(Lu(n.path)),r,"TargetPurposeLimboResolution",Da.oe))}}async function Bm(e,t,n){const r=Lo(e),i=[],s=[],o=[];r.ba.isEmpty()||(r.ba.forEach(((e,a)=>{o.push(r.Ba(a,t,n).then((e=>{var t;if((e||n)&&r.isPrimaryClient){const i=e?!e.fromCache:null===(t=null==n?void 0:n.targetChanges.get(a.targetId))||void 0===t?void 0:t.current;r.sharedClientState.updateQueryState(a.targetId,i?"current":"not-current")}if(e){i.push(e);const t=Pf.Ki(a.targetId,e);s.push(t)}})))})),await Promise.all(o),r.Sa.h_(i),await async function(e,t){const n=Lo(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>ya.forEach(t,(t=>ya.forEach(t.qi,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>ya.forEach(t.Qi,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!Ta(e))throw e;No("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.ns.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.ns=n.ns.insert(t,i)}}}(r.localStore,s))}async function jm(e,t){const n=Lo(e);if(!n.currentUser.isEqual(t)){No("SyncEngine","User change. New user:",t.toKey());const e=await Uf(n.localStore,t);n.currentUser=t,function(e,t){e.Oa.forEach((e=>{e.forEach((e=>{e.reject(new Fo(Mo.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.Oa.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Bm(n,e.us)}}function zm(e,t){const n=Lo(e),r=n.Fa.get(t);if(r&&r.wa)return ol().add(r.key);{let e=ol();const r=n.Da.get(t);if(!r)return e;for(const t of r){const r=n.ba.get(t);e=e.unionWith(r.view.Ea)}return e}}async function Gm(e,t){const n=Lo(e),r=await Gf(n.localStore,t.query,!0),i=t.view.pa(r);return n.isPrimaryClient&&Um(n,t.targetId,i.fa),i}async function Km(e,t){const n=Lo(e);return $f(n.localStore,t).then((e=>Bm(n,e)))}async function $m(e,t,n,r){const i=Lo(e),s=await function(e,t){const n=Lo(e),r=Lo(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(e=>r.vn(e,t).next((t=>t?n.localDocuments.getDocuments(e,t):ya.resolve(null)))))}(i.localStore,t);null!==s?("pending"===n?await Vp(i.remoteStore):"acknowledged"===n||"rejected"===n?(Lm(i,t,r||null),Om(i,t),function(e,t){Lo(Lo(e).mutationQueue).Mn(t)}(i.localStore,t)):Po(),await Bm(i,s)):No("SyncEngine","Cannot apply mutation batch with id: "+t)}async function Hm(e,t,n){const r=Lo(e),i=[],s=[];for(const e of t){let t;const n=r.Da.get(e);if(n&&0!==n.length){t=await jf(r.localStore,Vu(n[0]));for(const e of n){const t=r.ba.get(e),n=await Gm(r,t);n.snapshot&&s.push(n.snapshot)}}else{const n=await Kf(r.localStore,e);t=await jf(r.localStore,n),await km(r,Wm(n),e,!1,t.resumeToken)}i.push(t)}return r.Sa.h_(s),i}function Wm(e){return Ou(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function Qm(e){return function(e){return Lo(Lo(e).persistence).Bi()}(Lo(e).localStore)}async function Jm(e,t,n,r){const i=Lo(e);if(i.La)return void No("SyncEngine","Ignoring unexpected query state notification.");const s=i.Da.get(t);if(s&&s.length>0)switch(n){case"current":case"not-current":{const e=await $f(i.localStore,$u(s[0])),r=th.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,Ic.EMPTY_BYTE_STRING);await Bm(i,e,r);break}case"rejected":await zf(i.localStore,t,!0),Mm(i,t,r);break;default:Po()}}async function Ym(e,t,n){const r=Xm(e);if(r.La){for(const e of t){if(r.Da.has(e)&&r.sharedClientState.isActiveQueryTarget(e)){No("SyncEngine","Adding an already active target "+e);continue}const t=await Kf(r.localStore,e),n=await jf(r.localStore,t);await km(r,Wm(t),n.targetId,!1,n.resumeToken),Sp(r.remoteStore,n)}for(const e of n)r.Da.has(e)&&await zf(r.localStore,e,!1).then((()=>{kp(r.remoteStore,e),Mm(r,e)})).catch(ga)}}function Xm(e){const t=Lo(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Nm.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=zm.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Rm.bind(null,t),t.Sa.h_=am.bind(null,t.eventManager),t.Sa.ka=cm.bind(null,t.eventManager),t}function Zm(e){const t=Lo(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=xm.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Pm.bind(null,t),t}class eg{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=mp(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return Ff(this.persistence,new Lf,e.initialUser,this.serializer)}createPersistence(e){return new Tf(Sf.Hr,this.serializer)}createSharedClientState(e){return new ip}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class tg extends eg{constructor(e,t,n){super(),this.Qa=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Qa.initialize(this,e),await Zm(this.Qa.syncEngine),await Vp(this.Qa.remoteStore),await this.persistence.fi((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}createLocalStore(e){return Ff(this.persistence,new Lf,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new Zd(n,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const n=new Na(t,this.persistence);return new Aa(e.asyncQueue,n)}createPersistence(e){const t=xf(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Ud.withCacheSize(this.cacheSizeBytes):Ud.DEFAULT;return new Nf(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,fp(),pp(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new ip}}class ng extends tg{constructor(e,t){super(e,t,!1),this.Qa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Qa.syncEngine;this.sharedClientState instanceof rp&&(this.sharedClientState.syncEngine={Zs:$m.bind(null,t),Xs:Jm.bind(null,t),eo:Ym.bind(null,t),Bi:Qm.bind(null,t),Ys:Km.bind(null,t)},await this.sharedClientState.start()),await this.persistence.fi((async e=>{await async function(e,t){const n=Lo(e);if(Xm(n),Zm(n),!0===t&&!0!==n.La){const e=n.sharedClientState.getAllActiveQueryTargets(),t=await Hm(n,e.toArray());n.La=!0,await Qp(n.remoteStore,!0);for(const e of t)Sp(n.remoteStore,e)}else if(!1===t&&!1!==n.La){const e=[];let t=Promise.resolve();n.Da.forEach(((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then((()=>(Mm(n,i),zf(n.localStore,i,!0)))),kp(n.remoteStore,i)})),await t,await Hm(n,e),function(e){const t=Lo(e);t.Fa.forEach(((e,n)=>{kp(t.remoteStore,n)})),t.Ma.mr(),t.Fa=new Map,t.va=new fc(ia.comparator)}(n),n.La=!1,await Qp(n.remoteStore,!1)}}(this.Qa.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())}))}createSharedClientState(e){const t=fp();if(!rp.D(t))throw new Fo(Mo.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=xf(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new rp(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class rg{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Dm(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=jm.bind(null,this.syncEngine),await Qp(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new im}createDatastore(e){const t=mp(e.databaseInfo.databaseId),n=function(e){return new dp(e)}(e.databaseInfo);return function(e,t,n,r){return new _p(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,i){return new bp(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,(e=>Dm(this.syncEngine,e,0)),op.D()?new op:new sp)}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new bm(e,t,n,r,i,s);return o&&(a.La=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e;await async function(e){const t=Lo(e);No("RemoteStore","RemoteStore shutting down."),t.M_.add(5),await Ep(t),t.O_.shutdown(),t.N_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate()}}function ig(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){const r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class sg{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ka(this.observer.next,e)}error(e){this.observer.error?this.Ka(this.observer.error,e):Do("Uncaught Error in snapshot listener:",e.toString())}$a(){this.muted=!0}Ka(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class og{constructor(e,t){this.Ua=e,this.serializer=t,this.metadata=new Uo,this.buffer=new Uint8Array,this.Wa=new TextDecoder("utf-8"),this.Ga().then((e=>{e&&e.sa()?this.metadata.resolve(e.ia.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.ia)}`))}),(e=>this.metadata.reject(e)))}close(){return this.Ua.cancel()}async getMetadata(){return this.metadata.promise}async qa(){return await this.getMetadata(),this.Ga()}async Ga(){const e=await this.za();if(null===e)return null;const t=this.Wa.decode(e),n=Number(t);isNaN(n)&&this.ja(`length string (${t}) is not valid number`);const r=await this.Ha(n);return new fm(JSON.parse(r),e.length+n)}Ja(){return this.buffer.findIndex((e=>e==="{".charCodeAt(0)))}async za(){for(;this.Ja()<0&&!await this.Ya(););if(0===this.buffer.length)return null;const e=this.Ja();e<0&&this.ja("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Ha(e){for(;this.buffer.length<e;)await this.Ya()&&this.ja("Reached the end of bundle when more is expected.");const t=this.Wa.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ja(e){throw this.Ua.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ya(){const e=await this.Ua.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class ag{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new Fo(Mo.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(e,t){const n=Lo(e),r={documents:t.map((e=>bh(n.serializer,e)))},i=await n.xo("BatchGetDocuments",n.serializer.databaseId,ta.emptyPath(),r,t.length),s=new Map;i.forEach((e=>{const t=function(e,t){return"found"in t?function(e,t){Oo(!!t.found),t.found.name,t.found.updateTime;const n=Th(e,t.found.name),r=vh(t.found.updateTime),i=t.found.createTime?vh(t.found.createTime):Zo.min(),s=new Xc({mapValue:{fields:t.found.fields}});return eu.newFoundDocument(n,r,i,s)}(e,t):"missing"in t?function(e,t){Oo(!!t.missing),Oo(!!t.readTime);const n=Th(e,t.missing),r=vh(t.readTime);return eu.newNoDocument(n,r)}(e,t):Po()}(n.serializer,e);s.set(t.key.toString(),t)}));const o=[];return t.forEach((e=>{const t=s.get(e.toString());Oo(!!t),o.push(t)})),o}(this.datastore,e);return t.forEach((e=>this.recordVersion(e))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new Vl(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((e,t)=>{const n=ia.fromPath(t);this.mutations.push(new ql(n,this.precondition(n)))})),await async function(e,t){const n=Lo(e),r={writes:t.map((e=>Dh(n.serializer,e)))};await n.Co("Commit",n.serializer.databaseId,ta.emptyPath(),r)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Po();t=Zo.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new Fo(Mo.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Zo.min())?kl.exists(!1):kl.updateTime(t):kl.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Zo.min()))throw new Fo(Mo.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return kl.updateTime(t)}return kl.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class cg{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.Za=n.maxAttempts,this.Yo=new gp(this.asyncQueue,"transaction_retry")}Xa(){this.Za-=1,this.eu()}eu(){this.Yo.$o((async()=>{const e=new ag(this.datastore),t=this.tu(e);t&&t.then((t=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(t)})).catch((e=>{this.nu(e)}))))})).catch((e=>{this.nu(e)}))}))}tu(e){try{const t=this.updateFunction(e);return!Ra(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}nu(e){this.Za>0&&this.ru(e)?(this.Za-=1,this.asyncQueue.enqueueAndForget((()=>(this.eu(),Promise.resolve())))):this.deferred.reject(e)}ru(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Hl(t)}return!1}}class ug{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=So.UNAUTHENTICATED,this.clientId=Wo.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{No("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(No("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Fo(Mo.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Uo;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Zp(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function lg(e,t){e.asyncQueue.verifyOperationInProgress(),No("FirestoreClient","Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await Uf(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function hg(e,t){e.asyncQueue.verifyOperationInProgress();const n=await fg(e);No("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>Wp(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>Wp(t.remoteStore,n))),e._onlineComponents=t}function dg(e){return"FirebaseError"===e.name?e.code===Mo.FAILED_PRECONDITION||e.code===Mo.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function fg(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){No("FirestoreClient","Using user provided OfflineComponentProvider");try{await lg(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!dg(n))throw n;Ro("Error using user provided cache. Falling back to memory cache: "+n),await lg(e,new eg)}}else No("FirestoreClient","Using default OfflineComponentProvider"),await lg(e,new eg);return e._offlineComponents}async function pg(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(No("FirestoreClient","Using user provided OnlineComponentProvider"),await hg(e,e._uninitializedComponentsProvider._online)):(No("FirestoreClient","Using default OnlineComponentProvider"),await hg(e,new rg))),e._onlineComponents}function mg(e){return fg(e).then((e=>e.persistence))}function gg(e){return fg(e).then((e=>e.localStore))}function yg(e){return pg(e).then((e=>e.remoteStore))}function vg(e){return pg(e).then((e=>e.syncEngine))}async function wg(e){const t=await pg(e),n=t.eventManager;return n.onListen=Tm.bind(null,t.syncEngine),n.onUnlisten=Cm.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=Em.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=Am.bind(null,t.syncEngine),n}function _g(e,t,n={}){const r=new Uo;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new sg({next:s=>{t.enqueueAndForget((()=>om(e,o)));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new Fo(Mo.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new Fo(Mo.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new dm(Lu(n.path),s,{includeMetadataChanges:!0,ra:!0});return sm(e,o)}(await wg(e),e.asyncQueue,t,n,r))),r.promise}function Ig(e,t,n={}){const r=new Uo;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new sg({next:n=>{t.enqueueAndForget((()=>om(e,o))),n.fromCache&&"server"===r.source?i.reject(new Fo(Mo.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new dm(n,s,{includeMetadataChanges:!0,ra:!0});return sm(e,o)}(await wg(e),e.asyncQueue,t,n,r))),r.promise}function bg(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Tg=new Map;function Eg(e,t,n){if(!n)throw new Fo(Mo.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Sg(e,t,n,r){if(!0===t&&!0===r)throw new Fo(Mo.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function kg(e){if(!ia.isDocumentKey(e))throw new Fo(Mo.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Cg(e){if(ia.isDocumentKey(e))throw new Fo(Mo.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Ag(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Po()}function Ng(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Fo(Mo.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Ag(e);throw new Fo(Mo.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function Dg(e,t){if(t<=0)throw new Fo(Mo.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class Rg{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new Fo(Mo.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Fo(Mo.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Sg("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=bg(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new Fo(Mo.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new Fo(Mo.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new Fo(Mo.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class xg{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Rg({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Fo(Mo.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Fo(Mo.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Rg(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new qo;switch(e.type){case"firstParty":return new Go(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new Fo(Mo.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Tg.get(e);t&&(No("ComponentProvider","Removing Datastore"),Tg.delete(e),t.terminate())}(this),Promise.resolve()}}class Pg{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Pg(this.firestore,e,this._query)}}class Og{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Lg(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Og(this.firestore,e,this._key)}}class Lg extends Pg{constructor(e,t,n){super(e,t,Lu(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Og(this.firestore,null,new ia(e))}withConverter(e){return new Lg(this.firestore,e,this._path)}}function Mg(e,t,...n){if(e=O(e),Eg("collection","path",t),e instanceof xg){const r=ta.fromString(t,...n);return Cg(r),new Lg(e,null,r)}{if(!(e instanceof Og||e instanceof Lg))throw new Fo(Mo.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(ta.fromString(t,...n));return Cg(r),new Lg(e.firestore,null,r)}}function Fg(e,t,...n){if(e=O(e),1===arguments.length&&(t=Wo.newId()),Eg("doc","path",t),e instanceof xg){const r=ta.fromString(t,...n);return kg(r),new Og(e,null,new ia(r))}{if(!(e instanceof Og||e instanceof Lg))throw new Fo(Mo.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(ta.fromString(t,...n));return kg(r),new Og(e.firestore,e instanceof Lg?e.converter:null,new ia(r))}}function Ug(e,t){return e=O(e),t=O(t),(e instanceof Og||e instanceof Lg)&&(t instanceof Og||t instanceof Lg)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function Vg(e,t){return e=O(e),t=O(t),e instanceof Pg&&t instanceof Pg&&e.firestore===t.firestore&&ju(e._query,t._query)&&e.converter===t.converter}class qg{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Yo=new gp(this,"async_queue_retry"),this.hu=()=>{const e=pp();e&&No("AsyncQueue","Visibility state changed to "+e.visibilityState),this.Yo.Wo()};const e=pp();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;const t=pp();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise((()=>{}));const t=new Uo;return this.Iu((()=>this.ou&&this.cu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.su.push(e),this.Tu())))}async Tu(){if(0!==this.su.length){try{await this.su[0](),this.su.shift(),this.Yo.reset()}catch(e){if(!Ta(e))throw e;No("AsyncQueue","Operation failed with retryable error: "+e)}this.su.length>0&&this.Yo.$o((()=>this.Tu()))}}Iu(e){const t=this.iu.then((()=>(this.uu=!0,e().catch((e=>{this.au=e,this.uu=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Do("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.uu=!1,e))))));return this.iu=t,t}enqueueAfterDelay(e,t,n){this.Pu(),this.lu.indexOf(e)>-1&&(t=0);const r=Xp.createAndSchedule(this,e,t,n,(e=>this.Eu(e)));return this._u.push(r),r}Pu(){this.au&&Po()}verifyOperationInProgress(){}async du(){let e;do{e=this.iu,await e}while(e!==this.iu)}Au(e){for(const t of this._u)if(t.timerId===e)return!0;return!1}Ru(e){return this.du().then((()=>{this._u.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this._u)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.du()}))}Vu(e){this.lu.push(e)}Eu(e){const t=this._u.indexOf(e);this._u.splice(t,1)}}function Bg(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of["next","error","complete"])if(e in n&&"function"==typeof n[e])return!0;return!1}(e)}class jg{constructor(){this._progressObserver={},this._taskCompletionResolver=new Uo,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class zg extends xg{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new qg,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Kg(this),this._firestoreClient.terminate()}}function Gg(e){return e._firestoreClient||Kg(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Kg(e){var t,n,r;const i=e._freezeSettings(),s=function(e,t,n,r){return new Nc(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,bg(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new ug(e._authCredentials,e._appCheckCredentials,e._queue,s),(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function $g(e,t,n){const r=new Uo;return e.asyncQueue.enqueue((async()=>{try{await lg(e,n),await hg(e,t),r.resolve()}catch(e){const t=e;if(!dg(t))throw t;Ro("Error enabling indexeddb cache. Falling back to memory cache: "+t),r.reject(t)}})).then((()=>r.promise))}function Hg(e){if(e._initialized||e._terminated)throw new Fo(Mo.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Wg{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Wg(Ic.fromBase64String(e))}catch(e){throw new Fo(Mo.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Wg(Ic.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Qg{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Fo(Mo.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ra(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Jg{constructor(e){this._methodName=e}}class Yg{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Fo(Mo.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Fo(Mo.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Qo(this._lat,e._lat)||Qo(this._long,e._long)}}const Xg=/^__.*__$/;class Zg{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Ll(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ol(e,this.data,t,this.fieldTransforms)}}class ey{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Ll(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function ty(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Po()}}class ny{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.mu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(e){return new ny(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.gu({path:n,yu:!1});return r.wu(e),r}Su(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.gu({path:n,yu:!1});return r.mu(),r}bu(e){return this.gu({path:void 0,yu:!0})}Du(e){return by(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}mu(){if(this.path)for(let e=0;e<this.path.length;e++)this.wu(this.path.get(e))}wu(e){if(0===e.length)throw this.Du("Document fields must not be empty");if(ty(this.fu)&&Xg.test(e))throw this.Du('Document fields cannot begin and end with "__"')}}class ry{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||mp(e)}Fu(e,t,n,r=!1){return new ny({fu:e,methodName:t,vu:n,path:ra.emptyPath(),yu:!1,Cu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function iy(e){const t=e._freezeSettings(),n=mp(e._databaseId);return new ry(e._databaseId,!!t.ignoreUndefinedProperties,n)}function sy(e,t,n,r,i,s={}){const o=e.Fu(s.merge||s.mergeFields?2:0,t,n,i);vy("Data must be an object, but it was:",o,r);const a=gy(r,o);let c,u;if(s.merge)c=new wc(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=wy(t,r,n);if(!o.contains(i))throw new Fo(Mo.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Ty(e,i)||e.push(i)}c=new wc(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new Zg(new Xc(a),c,u)}class oy extends Jg{_toFieldTransform(e){if(2!==e.fu)throw 1===e.fu?e.Du(`${this._methodName}() can only appear at the top level of your update data`):e.Du(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof oy}}function ay(e,t,n){return new ny({fu:3,vu:t.settings.vu,methodName:e._methodName,yu:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class cy extends Jg{_toFieldTransform(e){return new El(e.path,new gl)}isEqual(e){return e instanceof cy}}class uy extends Jg{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){const t=ay(this,e,!0),n=this.Mu.map((e=>my(e,t))),r=new yl(n);return new El(e.path,r)}isEqual(e){return e instanceof uy&&k(this.Mu,e.Mu)}}class ly extends Jg{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){const t=ay(this,e,!0),n=this.Mu.map((e=>my(e,t))),r=new wl(n);return new El(e.path,r)}isEqual(e){return e instanceof ly&&k(this.Mu,e.Mu)}}class hy extends Jg{constructor(e,t){super(e),this.xu=t}_toFieldTransform(e){const t=new Il(e.serializer,hl(e.serializer,this.xu));return new El(e.path,t)}isEqual(e){return e instanceof hy&&this.xu===e.xu}}function dy(e,t,n,r){const i=e.Fu(1,t,n);vy("Data must be an object, but it was:",i,r);const s=[],o=Xc.empty();hc(r,((e,r)=>{const a=Iy(t,e,n);r=O(r);const c=i.Su(a);if(r instanceof oy)s.push(a);else{const e=my(r,c);null!=e&&(s.push(a),o.set(a,e))}}));const a=new wc(s);return new ey(o,a,i.fieldTransforms)}function fy(e,t,n,r,i,s){const o=e.Fu(1,t,n),a=[wy(t,r,n)],c=[i];if(s.length%2!=0)throw new Fo(Mo.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)a.push(wy(t,s[e])),c.push(s[e+1]);const u=[],l=Xc.empty();for(let e=a.length-1;e>=0;--e)if(!Ty(u,a[e])){const t=a[e];let n=c[e];n=O(n);const r=o.Su(t);if(n instanceof oy)u.push(t);else{const e=my(n,r);null!=e&&(u.push(t),l.set(t,e))}}const h=new wc(u);return new ey(l,h,o.fieldTransforms)}function py(e,t,n,r=!1){return my(n,e.Fu(r?4:3,t))}function my(e,t){if(yy(e=O(e)))return vy("Unsupported field value:",t,e),gy(e,t);if(e instanceof Jg)return function(e,t){if(!ty(t.fu))throw t.Du(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Du(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.yu&&4!==t.fu)throw t.Du("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=my(i,t.bu(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=O(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return hl(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Xo.fromDate(e);return{timestampValue:mh(t.serializer,n)}}if(e instanceof Xo){const n=new Xo(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:mh(t.serializer,n)}}if(e instanceof Yg)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Wg)return{bytesValue:gh(t.serializer,e._byteString)};if(e instanceof Og){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Du(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:wh(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Du(`Unsupported field value: ${Ag(e)}`)}(e,t)}function gy(e,t){const n={};return dc(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):hc(e,((e,r)=>{const i=my(r,t.pu(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function yy(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Xo||e instanceof Yg||e instanceof Wg||e instanceof Og||e instanceof Jg)}function vy(e,t,n){if(!yy(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=Ag(n);throw"an object"===r?t.Du(e+" a custom object"):t.Du(e+" "+r)}}function wy(e,t,n){if((t=O(t))instanceof Qg)return t._internalPath;if("string"==typeof t)return Iy(e,t);throw by("Field path arguments must be of type string or ",e,!1,void 0,n)}const _y=new RegExp("[~\\*/\\[\\]]");function Iy(e,t,n){if(t.search(_y)>=0)throw by(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Qg(...t.split("."))._internalPath}catch(r){throw by(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function by(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new Fo(Mo.INVALID_ARGUMENT,a+e+c)}function Ty(e,t){return e.some((e=>e.isEqual(t)))}class Ey{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Og(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Sy(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(ky("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Sy extends Ey{data(){return super.data()}}function ky(e,t){return"string"==typeof t?Iy(e,t):t instanceof Qg?t._internalPath:t._delegate._internalPath}function Cy(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new Fo(Mo.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Ay{}class Ny extends Ay{}function Dy(e,t,...n){let r=[];t instanceof Ay&&r.push(t),r=r.concat(n),function(e){const t=e.filter((e=>e instanceof xy)).length,n=e.filter((e=>e instanceof Ry)).length;if(t>1||t>0&&n>0)throw new Fo(Mo.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class Ry extends Ny{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Ry(e,t,n)}_apply(e){const t=this._parse(e);return qy(e._query,t),new Pg(e.firestore,e.converter,qu(e._query,t))}_parse(e){const t=iy(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new Fo(Mo.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){Vy(o,s);const t=[];for(const n of o)t.push(Uy(r,e,n));a={arrayValue:{values:t}}}else a=Uy(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||Vy(o,s),a=py(n,"where",o,"in"===s||"not-in"===s);return au.create(i,s,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}class xy extends Ay{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new xy(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:cu.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const e of r)qy(n,e),n=qu(n,e)}(e._query,t),new Pg(e.firestore,e.converter,qu(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Py extends Ny{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Py(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new Fo(Mo.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Fo(Mo.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new iu(t,n)}(e._query,this._field,this._direction);return new Pg(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new Pu(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class Oy extends Ny{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Oy(e,t,n)}_apply(e){return new Pg(e.firestore,e.converter,Bu(e._query,this._limit,this._limitType))}}class Ly extends Ny{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Ly(e,t,n)}_apply(e){const t=Fy(e,this.type,this._docOrFields,this._inclusive);return new Pg(e.firestore,e.converter,function(e,t){return new Pu(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}class My extends Ny{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new My(e,t,n)}_apply(e){const t=Fy(e,this.type,this._docOrFields,this._inclusive);return new Pg(e.firestore,e.converter,function(e,t){return new Pu(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function Fy(e,t,n,r){if(n[0]=O(n[0]),n[0]instanceof Ey)return function(e,t,n,r,i){if(!r)throw new Fo(Mo.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of Uu(e))if(n.field.isKeyField())s.push(qc(t,r.key));else{const e=r.data.field(n.field);if(kc(e))throw new Fo(Mo.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new Fo(Mo.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new tu(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const i=iy(e.firestore);return function(e,t,n,r,i,s){const o=e.explicitOrderBy;if(i.length>o.length)throw new Fo(Mo.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let s=0;s<i.length;s++){const c=i[s];if(o[s].field.isKeyField()){if("string"!=typeof c)throw new Fo(Mo.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!Fu(e)&&-1!==c.indexOf("/"))throw new Fo(Mo.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=e.path.child(ta.fromString(c));if(!ia.isDocumentKey(n))throw new Fo(Mo.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new ia(n);a.push(qc(t,i))}else{const e=py(n,r,c);a.push(e)}}return new tu(a,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function Uy(e,t,n){if("string"==typeof(n=O(n))){if(""===n)throw new Fo(Mo.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Fu(t)&&-1!==n.indexOf("/"))throw new Fo(Mo.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(ta.fromString(n));if(!ia.isDocumentKey(r))throw new Fo(Mo.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return qc(e,new ia(r))}if(n instanceof Og)return qc(e,n._key);throw new Fo(Mo.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ag(n)}.`)}function Vy(e,t){if(!Array.isArray(e)||0===e.length)throw new Fo(Mo.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function qy(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new Fo(Mo.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new Fo(Mo.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class By{convertValue(e,t="none"){switch(Pc(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ec(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Sc(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Po()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return hc(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new Yg(Ec(e.latitude),Ec(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Cc(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Ac(e));default:return null}}convertTimestamp(e){const t=Tc(e);return new Xo(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ta.fromString(e);Oo(zh(n));const r=new Dc(n.get(1),n.get(3)),i=new ia(n.popFirst(5));return r.isEqual(t)||Do(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function jy(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class zy extends By{constructor(e){super(),this.firestore=e}convertBytes(e){return new Wg(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Og(this.firestore,null,t)}}class Gy{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Ky extends Ey{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new $y(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(ky("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class $y extends Ky{data(e={}){return super.data(e)}}class Hy{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Gy(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new $y(this._firestore,this._userDataWriter,n.key,n,new Gy(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Fo(Mo.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new $y(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Gy(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new $y(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Gy(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:Wy(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Wy(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Po()}}function Qy(e,t){return e instanceof Ky&&t instanceof Ky?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof Hy&&t instanceof Hy&&e._firestore===t._firestore&&Vg(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}class Jy extends By{constructor(e){super(),this.firestore=e}convertBytes(e){return new Wg(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Og(this.firestore,null,t)}}function Yy(e,t,n){e=Ng(e,Og);const r=Ng(e.firestore,zg),i=jy(e.converter,t,n);return ev(r,[sy(iy(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,kl.none())])}function Xy(e,t,n,...r){e=Ng(e,Og);const i=Ng(e.firestore,zg),s=iy(i);let o;return o="string"==typeof(t=O(t))||t instanceof Qg?fy(s,"updateDoc",e._key,t,n,r):dy(s,"updateDoc",e._key,t),ev(i,[o.toMutation(e._key,kl.exists(!0))])}function Zy(e,...t){var n,r,i;e=O(e);let s={includeMetadataChanges:!1,source:"default"},o=0;"object"!=typeof t[o]||Bg(t[o])||(s=t[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Bg(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let c,u,l;if(e instanceof Og)u=Ng(e.firestore,zg),l=Lu(e._key.path),c={next:n=>{t[o]&&t[o](tv(u,e,n))},error:t[o+1],complete:t[o+2]};else{const n=Ng(e,Pg);u=Ng(n.firestore,zg),l=n._query;const r=new Jy(u);c={next:e=>{t[o]&&t[o](new Hy(u,r,n,e))},error:t[o+1],complete:t[o+2]},Cy(e._query)}return function(e,t,n,r){const i=new sg(r),s=new dm(t,i,n);return e.asyncQueue.enqueueAndForget((async()=>sm(await wg(e),s))),()=>{i.$a(),e.asyncQueue.enqueueAndForget((async()=>om(await wg(e),s)))}}(Gg(u),l,a,c)}function ev(e,t){return function(e,t){const n=new Uo;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=Zm(e);try{const e=await function(e,t){const n=Lo(e),r=Xo.now(),i=t.reduce(((e,t)=>e.add(t.key)),ol());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=Yu(),c=ol();return n.os.getEntries(e,i).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((i=>{s=i;const o=[];for(const e of t){const t=xl(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new Ll(e.key,t,Zc(t.value.mapValue),kl.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;const r=t.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:el(s)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.xa[e.currentUser.toKey()];r||(r=new fc(Qo)),r=r.insert(t,n),e.xa[e.currentUser.toKey()]=r}(r,e.batchId,n),await Bm(r,e.changes),await Vp(r.remoteStore)}catch(e){const t=Zp(e,"Failed to persist write");n.reject(t)}}(await vg(e),t,n))),n.promise}(Gg(e),t)}function tv(e,t,n){const r=n.docs.get(t._key),i=new Jy(e);return new Ky(e,i,t._key,r,new Gy(n.hasPendingWrites,n.fromCache),t.converter)}const nv={maxAttempts:5};class rv{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=iy(e)}set(e,t,n){this._verifyNotCommitted();const r=iv(e,this._firestore),i=jy(r.converter,t,n),s=sy(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,kl.none())),this}update(e,t,n,...r){this._verifyNotCommitted();const i=iv(e,this._firestore);let s;return s="string"==typeof(t=O(t))||t instanceof Qg?fy(this._dataReader,"WriteBatch.update",i._key,t,n,r):dy(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,kl.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=iv(e,this._firestore);return this._mutations=this._mutations.concat(new Vl(t._key,kl.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Fo(Mo.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function iv(e,t){if((e=O(e)).firestore!==t)throw new Fo(Mo.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class sv extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=iy(e)}get(e){const t=iv(e,this._firestore),n=new zy(this._firestore);return this._transaction.lookup([t._key]).then((e=>{if(!e||1!==e.length)return Po();const r=e[0];if(r.isFoundDocument())return new Ey(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new Ey(this._firestore,n,t._key,null,t.converter);throw Po()}))}set(e,t,n){const r=iv(e,this._firestore),i=jy(r.converter,t,n),s=sy(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){const i=iv(e,this._firestore);let s;return s="string"==typeof(t=O(t))||t instanceof Qg?fy(this._dataReader,"Transaction.update",i._key,t,n,r):dy(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,s),this}delete(e){const t=iv(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=iv(e,this._firestore),n=new Jy(this._firestore);return super.get(e).then((e=>new Ky(this._firestore,n,t._key,e._document,new Gy(!1,!1),t.converter)))}}function ov(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new Fo("invalid-argument",`Invalid options passed to function ${e}(): You cannot specify both "merge" and "mergeFields".`);return t}function av(){if("undefined"==typeof Uint8Array)throw new Fo("unimplemented","Uint8Arrays are not available in this environment.")}function cv(){if("undefined"==typeof atob)throw new Fo("unimplemented","Blobs are unavailable in Firestore in this environment.")}new WeakMap,function(e,t=!0){!function(e){ko=e}(et),Ke(new L("firestore",((e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new zg(new jo(e.getProvider("auth-internal")),new $o(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Fo(Mo.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Dc(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),ot(Eo,"4.6.4",e),ot(Eo,"4.6.4","esm2017")}();class uv{constructor(e){this._delegate=e}static fromBase64String(e){return cv(),new uv(Wg.fromBase64String(e))}static fromUint8Array(e){return av(),new uv(Wg.fromUint8Array(e))}toBase64(){return cv(),this._delegate.toBase64()}toUint8Array(){return av(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function lv(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of["next","error","complete"])if(e in n&&"function"==typeof n[e])return!0;return!1}(e)}class hv{enableIndexedDbPersistence(e,t){return function(e,t){Hg(e=Ng(e,zg));const n=Gg(e);if(n._uninitializedComponentsProvider)throw new Fo(Mo.FAILED_PRECONDITION,"SDK cache is already specified.");Ro("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=e._freezeSettings(),i=new rg;return $g(n,i,new tg(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){Hg(e=Ng(e,zg));const t=Gg(e);if(t._uninitializedComponentsProvider)throw new Fo(Mo.FAILED_PRECONDITION,"SDK cache is already specified.");Ro("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=e._freezeSettings(),r=new rg;return $g(t,r,new ng(r,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new Fo(Mo.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new Uo;return e._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(e){if(!wa.D())return Promise.resolve();const t=e+"main";await wa.delete(t)}(xf(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}(e._delegate)}}class dv{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Dc||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();e.merge||t.host===e.host||Ro("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function(e,t,n,r={}){var i;const s=(e=Ng(e,xg))._getSettings(),o=`${t}:${n}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&Ro("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=So.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[a(JSON.stringify({alg:"none",type:"JWT"})),a(JSON.stringify(s)),""].join(".")}(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new Fo(Mo.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new So(s)}e._authCredentials=new Bo(new Vo(t,n))}}(this._delegate,e,t,n)}enableNetwork(){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await mg(e),n=await yg(e);return t.setNetworkEnabled(!0),function(e){const t=Lo(e);return t.M_.delete(0),Tp(t)}(n)}))}(Gg(Ng(this._delegate,zg)))}disableNetwork(){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await mg(e),n=await yg(e);return t.setNetworkEnabled(!1),async function(e){const t=Lo(e);t.M_.add(0),await Ep(t),t.N_.set("Offline")}(n)}))}(Gg(Ng(this._delegate,zg)))}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Sg("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function(e){const t=new Uo;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t){const n=Lo(e);Rp(n.remoteStore)||No("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(e){const t=Lo(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e)))}(n.localStore);if(-1===e)return void t.resolve();const r=n.Oa.get(e)||[];r.push(t),n.Oa.set(e,r)}catch(e){const n=Zp(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await vg(e),t))),t.promise}(Gg(Ng(this._delegate,zg)))}onSnapshotsInSync(e){return t=this._delegate,n=e,function(e,t){const n=new sg(t);return e.asyncQueue.enqueueAndForget((async()=>function(e,t){Lo(e).z_.add(t),t.next()}(await wg(e),n))),()=>{n.$a(),e.asyncQueue.enqueueAndForget((async()=>function(e,t){Lo(e).z_.delete(t)}(await wg(e),n)))}}(Gg(t=Ng(t,zg)),Bg(n)?n:{next:n});var t,n}get app(){if(!this._appCompat)throw new Fo("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new kv(this,Mg(this._delegate,e))}catch(e){throw vv(e,"collection()","Firestore.collection()")}}doc(e){try{return new yv(this,Fg(this._delegate,e))}catch(e){throw vv(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Tv(this,function(e,t){if(e=Ng(e,xg),Eg("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new Fo(Mo.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Pg(e,null,function(e){return new Pu(ta.emptyPath(),e)}(t))}(this._delegate,e))}catch(e){throw vv(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function(e,t,n){e=Ng(e,zg);const r=Object.assign(Object.assign({},nv),void 0);return function(e){if(e.maxAttempts<1)throw new Fo(Mo.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(e,t,n){const r=new Uo;return e.asyncQueue.enqueueAndForget((async()=>{const i=await function(e){return pg(e).then((e=>e.datastore))}(e);new cg(e.asyncQueue,i,n,t,r).Xa()})),r.promise}(Gg(e),(n=>t(new sv(e,n))),r)}(this._delegate,(t=>e(new pv(this,t))))}batch(){return Gg(this._delegate),new mv(new rv(this._delegate,(e=>ev(this._delegate,e))))}loadBundle(e){return function(e,t){const n=Gg(e=Ng(e,zg)),r=new jg;return function(e,t,n,r){const i=function(e,t){let n;return n="string"==typeof e?Ql().encode(e):e,function(e,t){return new og(e,t)}(function(e,t){if(e instanceof Uint8Array)return ig(e,t);if(e instanceof ArrayBuffer)return ig(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),t)}(n,mp(t));e.asyncQueue.enqueueAndForget((async()=>{!function(e,t,n){const r=Lo(e);(async function(e,t,n){try{const r=await t.getMetadata();if(await function(e,t){const n=Lo(e),r=vh(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(e=>n.$r.getBundleMetadata(e,t.id))).then((e=>!!e&&e.createTime.compareTo(r)>=0))}(e.localStore,r))return await t.close(),n._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(r)),Promise.resolve(new Set);n._updateProgress(gm(r));const i=new mm(r,e.localStore,t.serializer);let s=await t.qa();for(;s;){const e=await i._a(s);e&&n._updateProgress(e),s=await t.qa()}const o=await i.complete();return await Bm(e,o.ca,void 0),await function(e,t){const n=Lo(e);return n.persistence.runTransaction("Save bundle","readwrite",(e=>n.$r.saveBundleMetadata(e,t)))}(e.localStore,r),n._completeWith(o.progress),Promise.resolve(o.ua)}catch(e){return Ro("SyncEngine",`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}})(r,t,n).then((e=>{r.sharedClientState.notifyBundleLoaded(e)}))}(await vg(e),i,r)}))}(n,e._databaseId,t,r),r}(this._delegate,e)}namedQuery(e){return(t=this._delegate,n=e,function(e,t){return e.asyncQueue.enqueue((async()=>function(e,t){const n=Lo(e);return n.persistence.runTransaction("Get named query","readonly",(e=>n.$r.getNamedQuery(e,t)))}(await gg(e),t)))}(Gg(t=Ng(t,zg)),n).then((e=>e?new Pg(t,null,e.query):null))).then((e=>e?new Tv(this,e):null));var t,n}}class fv extends By{constructor(e){super(),this.firestore=e}convertBytes(e){return new uv(new Wg(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return yv.forKey(t,this.firestore,null)}}class pv{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new fv(e)}get(e){const t=Cv(e);return this._delegate.get(t).then((e=>new Iv(this._firestore,new Ky(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter))))}set(e,t,n){const r=Cv(e);return n?(ov("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=Cv(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=Cv(e);return this._delegate.delete(t),this}}class mv{constructor(e){this._delegate=e}set(e,t,n){const r=Cv(e);return n?(ov("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=Cv(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=Cv(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class gv{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new $y(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new bv(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=gv.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new gv(e,new fv(e),t),r.set(t,i)),i}}gv.INSTANCES=new WeakMap;class yv{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new fv(e)}static forPath(e,t,n){if(e.length%2!=0)throw new Fo("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new yv(t,new Og(t._delegate,n,new ia(e)))}static forKey(e,t,n){return new yv(t,new Og(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new kv(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new kv(this.firestore,Mg(this._delegate,e))}catch(e){throw vv(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=O(e))instanceof Og&&Ug(this._delegate,e)}set(e,t){t=ov("DocumentReference.set",t);try{return t?Yy(this._delegate,e,t):Yy(this._delegate,e)}catch(e){throw vv(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?Xy(this._delegate,e):Xy(this._delegate,e,t,...n)}catch(e){throw vv(e,"updateDoc()","DocumentReference.update()")}}delete(){return ev(Ng((e=this._delegate).firestore,zg),[new Vl(e._key,kl.none())]);var e}onSnapshot(...e){const t=wv(e),n=_v(e,(e=>new Iv(this.firestore,new Ky(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))));return Zy(this._delegate,t,n)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function(e){e=Ng(e,Og);const t=Ng(e.firestore,zg),n=Gg(t),r=new Jy(t);return function(e,t){const n=new Uo;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await function(e,t){const n=Lo(e);return n.persistence.runTransaction("read document","readonly",(e=>n.localDocuments.getDocument(e,t)))}(e,t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new Fo(Mo.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){const r=Zp(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await gg(e),t,n))),n.promise}(n,e._key).then((n=>new Ky(t,r,e._key,n,new Gy(null!==n&&n.hasLocalMutations,!0),e.converter)))}(this._delegate):"server"===(null==e?void 0:e.source)?function(e){e=Ng(e,Og);const t=Ng(e.firestore,zg);return _g(Gg(t),e._key,{source:"server"}).then((n=>tv(t,e,n)))}(this._delegate):function(e){e=Ng(e,Og);const t=Ng(e.firestore,zg);return _g(Gg(t),e._key).then((n=>tv(t,e,n)))}(this._delegate),t.then((e=>new Iv(this.firestore,new Ky(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))))}withConverter(e){return new yv(this.firestore,e?this._delegate.withConverter(gv.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function vv(e,t,n){return e.message=e.message.replace(t,n),e}function wv(e){for(const t of e)if("object"==typeof t&&!lv(t))return t;return{}}function _v(e,t){var n,r;let i;return i=lv(e[0])?e[0]:lv(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{i.next&&i.next(t(e))},error:null===(n=i.error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class Iv{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new yv(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Qy(this._delegate,e._delegate)}}class bv extends Iv{data(e){const t=this._delegate.data(e);return this._delegate._converter||void 0!==t||Po(),t}}class Tv{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new fv(e)}where(e,t,n){try{return new Tv(this.firestore,Dy(this._delegate,function(e,t,n){const r=t,i=ky("where",e);return Ry._create(i,r,n)}(e,t,n)))}catch(e){throw vv(e,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Tv(this.firestore,Dy(this._delegate,function(e,t="asc"){const n=t,r=ky("orderBy",e);return Py._create(r,n)}(e,t)))}catch(e){throw vv(e,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Tv(this.firestore,Dy(this._delegate,(Dg("limit",t=e),Oy._create("limit",t,"F"))))}catch(t){throw vv(t,"limit()","Query.limit()")}var t}limitToLast(e){try{return new Tv(this.firestore,Dy(this._delegate,(Dg("limitToLast",t=e),Oy._create("limitToLast",t,"L"))))}catch(t){throw vv(t,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new Tv(this.firestore,Dy(this._delegate,function(...e){return Ly._create("startAt",e,!0)}(...e)))}catch(e){throw vv(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Tv(this.firestore,Dy(this._delegate,function(...e){return Ly._create("startAfter",e,!1)}(...e)))}catch(e){throw vv(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Tv(this.firestore,Dy(this._delegate,function(...e){return My._create("endBefore",e,!1)}(...e)))}catch(e){throw vv(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Tv(this.firestore,Dy(this._delegate,function(...e){return My._create("endAt",e,!0)}(...e)))}catch(e){throw vv(e,"endAt()","Query.endAt()")}}isEqual(e){return Vg(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function(e){e=Ng(e,Pg);const t=Ng(e.firestore,zg),n=Gg(t),r=new Jy(t);return function(e,t){const n=new Uo;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await Gf(e,t,!0),i=new wm(t,r.hs),s=i.da(r.documents),o=i.applyChanges(s,!1);n.resolve(o.snapshot)}catch(e){const r=Zp(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await gg(e),t,n))),n.promise}(n,e._query).then((n=>new Hy(t,r,e,n)))}(this._delegate):"server"===(null==e?void 0:e.source)?function(e){e=Ng(e,Pg);const t=Ng(e.firestore,zg),n=Gg(t),r=new Jy(t);return Ig(n,e._query,{source:"server"}).then((n=>new Hy(t,r,e,n)))}(this._delegate):function(e){e=Ng(e,Pg);const t=Ng(e.firestore,zg),n=Gg(t),r=new Jy(t);return Cy(e._query),Ig(n,e._query).then((n=>new Hy(t,r,e,n)))}(this._delegate),t.then((e=>new Sv(this.firestore,new Hy(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))))}onSnapshot(...e){const t=wv(e),n=_v(e,(e=>new Sv(this.firestore,new Hy(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))));return Zy(this._delegate,t,n)}withConverter(e){return new Tv(this.firestore,e?this._delegate.withConverter(gv.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class Ev{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new bv(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Sv{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Tv(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map((e=>new bv(this._firestore,e)))}docChanges(e){return this._delegate.docChanges(e).map((e=>new Ev(this._firestore,e)))}forEach(e,t){this._delegate.forEach((n=>{e.call(t,new bv(this._firestore,n))}))}isEqual(e){return Qy(this._delegate,e._delegate)}}class kv extends Tv{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new yv(this.firestore,e):null}doc(e){try{return new yv(this.firestore,void 0===e?Fg(this._delegate):Fg(this._delegate,e))}catch(e){throw vv(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=Ng(e.firestore,zg),r=Fg(e),i=jy(e.converter,t);return ev(n,[sy(iy(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,kl.exists(!1))]).then((()=>r))}(this._delegate,e).then((e=>new yv(this.firestore,e)))}isEqual(e){return Ug(this._delegate,e._delegate)}withConverter(e){return new kv(this.firestore,e?this._delegate.withConverter(gv.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Cv(e){return Ng(e,Og)}class Av{constructor(...e){this._delegate=new Qg(...e)}static documentId(){return new Av(ra.keyField().canonicalString())}isEqual(e){return(e=O(e))instanceof Qg&&this._delegate._internalPath.isEqual(e._internalPath)}}class Nv{constructor(e){this._delegate=e}static serverTimestamp(){const e=new cy("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new Nv(e)}static delete(){const e=new oy("deleteField");return e._methodName="FieldValue.delete",new Nv(e)}static arrayUnion(...e){const t=function(...e){return new uy("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new Nv(t)}static arrayRemove(...e){const t=function(...e){return new ly("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new Nv(t)}static increment(e){const t=new hy("increment",e);return t._methodName="FieldValue.increment",new Nv(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const Dv={Firestore:dv,GeoPoint:Yg,Timestamp:Xo,Blob:uv,Transaction:pv,WriteBatch:mv,DocumentReference:yv,DocumentSnapshot:Iv,Query:Tv,QueryDocumentSnapshot:bv,QuerySnapshot:Sv,CollectionReference:kv,FieldPath:Av,FieldValue:Nv,setLogLevel:function(e){var t;t=e,Co.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};!function(e){!function(e,t){e.INTERNAL.registerComponent(new L("firestore-compat",(e=>((e,t)=>new dv(e,t,new hv))(e.getProvider("app-compat").getImmediate(),e.getProvider("firestore").getImmediate())),"PUBLIC").setServiceProps(Object.assign({},Dv)))}(e),e.registerVersion("@firebase/firestore-compat","0.3.33")}(Et),Et.initializeApp({apiKey:"AIzaSyC1pq4VorsisWdqzDT5M3XQ-E6MtCHPqxU",authDomain:"fit-f7f49.firebaseapp.com",projectId:"fit-f7f49",storageBucket:"fit-f7f49.appspot.com",messagingSenderId:"161201752814",appId:"1:161201752814:web:dd3bb14a98e9f8fde041ff",measurementId:"G-JVQMLQWD1J"});const Rv=Et.auth(),xv=Et.firestore(),Pv="test@example.com",Ov="password123";(async(e,t)=>{const i=document.getElementById("signUpForm"),s=document.getElementById("error-message");i.addEventListener("submit",(async function(e){e.preventDefault();const t=document.getElementById("signUpEmail").value,i=document.getElementById("signUpPassword").value,o=document.getElementById("confirmPassword").value;if(s.textContent="",!(i.length<6)&&/[A-Z]/.test(i)&&/[a-z]/.test(i)&&/[0-9]/.test(i))if(i===o)try{const e=(await(0,n.createUserWithEmailAndPassword)(Rv,t,i)).user;await(0,r.setDoc)((0,r.doc)(xv,"users",e.uid),{email:e.email,name:t.split("@")[0],calorieGoal:0,googleFitLinked:!1,createdAt:(0,r.serverTimestamp)(),updatedAt:(0,r.serverTimestamp)()}),console.log("User signed up and saved in Firestore:",e),window.location.href="homepage.html"}catch(e){console.error("Error signing up:",e),s.textContent="Error signing up: "+e.message}else s.textContent="Passwords do not match";else s.textContent="Password must be at least 6 characters long, contain at least one uppercase letter, one lowercase letter, and one number"}))})().then((e=>{console.log("Sign-up successful:",e)})).catch((e=>{console.error("Sign-up error:",e.message)})),(async(e,t)=>{try{const n=(await Rv.signInWithEmailAndPassword(e,t)).user;return console.log("User signed in:",n),n}catch(e){throw console.error("Error signing in:",e.message),e}})(Pv,Ov).then((e=>{console.log("Sign-in successful:",e)})).catch((e=>{console.error("Sign-in error:",e.message)}))})();